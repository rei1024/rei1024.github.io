var c=(e,t)=>{let r=document.querySelector(e);if(r==null)throw Error(`can't found a element for "${e}"`);if(r instanceof t)return r;throw Error(`"${e}" is not a ${t.name}`)};function f(e,t=void 0){let r=document.createElement(e);if(typeof t=="string")r.textContent=t;else if(t!=null&&typeof t=="object"&&(t.text&&(r.textContent=t.text),t.classes&&r.classList.add(...t.classes),t.fn&&(t.fn(r),t.fn=void 0),t.children&&r.append(...t.children),t.style))for(let[n,s]of Object.entries(t.style))n in r.style?r.style[n]=s:r.style.setProperty(n,s);return r}var Dt=class{#e=0;#n=-1;constructor(t,{frequency:r,signal:n}){this._frequency=r,this._enabled=!1,this._id=0;let s=requestAnimationFrame,i=o=>{if(this._enabled&&this.#n!==-1){let a=o-this.#n,u=this.#e,p=u+a/1e3*this._frequency,l=Math.floor(p)-Math.floor(u);this.#e=p,t(l)}this.#n=o,this._id=s(i)};this._id=s(i),n?.addEventListener("abort",()=>{this.abort()})}abort(){this._id!==0&&cancelAnimationFrame(this._id)}get frequency(){return this._frequency}set frequency(t){this._frequency=t}get disabled(){return!this._enabled}set disabled(t){this._enabled=!t}reset(){this.#e=0}};var le=e=>e instanceof Error?e.message:"Unknown error is occurred.";function*Je(e,t){if(!Number.isInteger(t))throw RangeError("size is not an integer");let r=[];for(let n of e)r.push(n),t<=r.length&&(yield r,r=[]);r.length!==0&&(yield r)}var Qe=()=>{let e=document.createElement("span");return e.classList.add("spinner-border","spinner-border-sm"),e.setAttribute("role","status"),e.setAttribute("aria-hidden","true"),e};var d=()=>{throw Error("internal error")},m=class{pretty(){return""}doesReturnValue(){return!1}isSameComponent(t){return!0}};var At="INC",me="TDEC",Ct="READ",Lt="SET",he="B2DX",ge="B2DY",xe="B2D",dn="DEC",tr="SQX",er="SQY",rr="SQ";function nr(e){switch(e){case At:return 0;case me:return 1;case Ct:return 2;case Lt:return 3}}function ln(e){switch(e){case 0:return At;case 1:return me;case 2:return Ct;case 3:return Lt}}function sr(e){switch(e){case he:return 4;case ge:return 5;case xe:return 6}}function mn(e){switch(e){case 4:return he;case 5:return ge;case 6:return xe}}var W=class e extends m{constructor(t,r){super(),this.op=t,this.axis=r}pretty(){return`${ln(this.op)} ${mn(this.axis)}`}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==2)return;let[n,s]=r;if(!(n===void 0||s===void 0)){if(n===At||n===me){if(s===he||s===ge)return new e(nr(n),sr(s))}else if((n===Ct||n===Lt)&&s===xe)return new e(nr(n),sr(s));switch(n){case At:switch(s){case tr:return new e(0,4);case er:return new e(0,5);default:return}case dn:switch(s){case tr:return new e(1,4);case er:return new e(1,5);default:return}case Ct:switch(s){case rr:return new e(2,6);default:return}case Lt:switch(s){case rr:return new e(3,6);default:return}}}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0;case 3:return!1}}isSameComponent(t){if(t instanceof e){let r=this.axis,n=t.axis;return r===4&&n===5?!1:!(r===5&&n===4)}return!1}};function be(e,t){let r=[];for(let n=0;n<e;n++)r.push(t(n));return r}var Mt=class{constructor(t=0,r=0){if(t<0||r<0)throw RangeError("B2D constructor: negative");this.x=t,this.y=r,this.maxX=t,this.maxY=r,this.array=be(this.maxY+1,()=>be(this.maxX+1,()=>0))}getArray(){return this.array}getMaxX(){return this.maxX}getMaxY(){return this.maxY}action(t){switch(t.op){case 0:{switch(t.axis){case 4:return this.incB2DX();case 5:return this.incB2DY();case 6:d()}break}case 1:{switch(t.axis){case 4:return this.tdecB2DX();case 5:return this.tdecB2DY();case 6:d()}break}case 2:{switch(t.axis){case 6:return this.read();default:d()}break}case 3:{switch(t.axis){case 6:return this.set();default:d()}break}default:d()}}incB2DX(){if(this.x++,this.maxX<this.x){for(let t of this.array)t.push(0);this.maxX=this.x}}incB2DY(){this.y++,this.maxY<this.y&&(this.array.push(be(this.maxX+1,()=>0)),this.maxY=this.y)}tdecB2DX(){return this.x===0?0:(this.x--,1)}tdecB2DY(){return this.y===0?0:(this.y--,1)}read(){let t=this.array[this.y];t===void 0&&d();let r=t[this.x];return r===void 0&&d(),t[this.x]=0,r}set(){let t=this.array[this.y];if(t===void 0&&d(),t[this.x]===1)throw Error(`SET B2D: Tried to set when it was already 1. x = ${this.x}, y = ${this.y}`);t[this.x]=1}};var ir=(e,t,r,n)=>{let s=e.canvas.width,i=e.canvas.height;s!==i&&(e.canvas.height=s),e.reset?e.reset():(e.clearRect(0,0,s,s),e.resetTransform(),e.beginPath());let o=t.getMaxX(),a=t.getMaxY(),u=Math.max(o,a)+1,p=s/u;n&&(e.scale(1,-1),e.translate(0,-s));let l=t.getArray();e.fillStyle="#212529";for(let E=0;E<=a;E++){let R=l[E];if(R===void 0)throw Error("renderB2D: internal error");let F=E*p;for(let U=0;U<=o;U++)R[U]===1&&e.rect(U*p,F,p,p)}e.fill(),r||(e.strokeStyle="#03A9F4",e.lineWidth=4,e.strokeRect(t.x*p,t.y*p,p,p))};var ye="INC",Se="TDEC",or="U",hn="R";function gn(e){switch(e){case 0:return ye;case 1:return Se}}function xn(e){switch(e){case ye:return 0;case Se:return 1}}var b=class e extends m{constructor(t,r){super(),this.op=t,this.regNumber=r,this.registerCache=void 0}pretty(){return`${gn(this.op)} ${or}${this.regNumber}`}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==2)return;let[n,s]=r;if(!(n===void 0||s===void 0)&&(n===ye||n===Se)&&(s.startsWith(or)||s.startsWith(hn))){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new e(xn(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0}}isSameComponent(t){return t instanceof e?this.regNumber===t.regNumber:!1}};var kt=class{constructor(){this.value=0}action(t){switch(t.op){case 1:return this.value===0?0:(this.value--,1);case 0:this.value++}}actionN(t,r){switch(t.op){case 1:{this.value-=r;break}case 0:{this.value+=r;break}}}getValue(){return this.value}setValue(t){this.value=t}inc(){this.action(new b(0,0))}tdec(){let t=this.action(new b(1,0));return t===void 0&&d(),t}setByRegistersInit(t,r){(typeof r!="number"||r<0||!Number.isInteger(r))&&bn(t,r),this.setValue(r)}};function bn(e,t){let r=`"${e}": ${JSON.stringify(t)}`;throw Error(`Invalid #REGISTERS ${r}`)}var yn=e=>{if(window.innerWidth<768)return 8+1===e?e:8;let r=12;return r+1<=e&&e<=r+2?e:r},Sn=e=>f("th",`U${e}`),En=(e,t)=>f("td",{text:t.getValue().toString(),fn:r=>{r.dataset.test=`U${e}`}}),_n=e=>{let t=[],r=[],n=yn(e.size);for(let i of Je(e,n)){let o=f("tr"),a=f("tr");for(let[u,p]of i){o.append(Sn(u));let l=En(u,p);t.push(l),a.append(l)}r.push({header:o,data:a})}let s=f("table");for(let i of r)s.append(i.header,i.data);return s.classList.add("table"),s.style.tableLayout="fixed",s.style.marginBottom="0",{table:s,cells:t}},Ut=class{constructor(t){this.root=t,this.cells=[]}initialize(t){let{table:r,cells:n}=_n(t);this.root.replaceChildren(r),this.cells=n}clear(){this.cells=[],this.root.innerHTML=""}render(t){let r=0,n=this.cells;for(let s of t.values()){let i=n[r];if(i===void 0)throw Error("internal error");i.textContent=s.getValue().toString(),r++}}};var Ee="INC",_e="TDEC",$e="READ",Te="SET",ar="B";function $n(e){switch(e){case 0:return Ee;case 1:return _e;case 2:return $e;case 3:return Te}}function Tn(e){switch(e){case Ee:return 0;case _e:return 1;case $e:return 2;case Te:return 3}}var g=class e extends m{constructor(t,r){super(),this.op=t,this.regNumber=r,this.registerCache=void 0}pretty(){return`${$n(this.op)} ${ar}${this.regNumber}`}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==2)return;let[n,s]=r;if(!(n===void 0||s===void 0)&&(n===Ee||n===_e||n===$e||n===Te)&&s.startsWith(ar)){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new e(Tn(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0;case 3:return!1}}isSameComponent(t){return t instanceof e?this.regNumber===t.regNumber:!1}};function cr(e){return[...e].map(t=>{if(t==="0")return 0;if(t==="1")return 1;throw Error(`Invalid #REGISTERS: "${e}"`)})}var wn=typeof BigInt<"u";function zt(e){let t="";for(let r=e.length-1;r>=0;r--)t+=e[r]===0?"0":"1";return t}function we(e){let t="",r=e.length;for(let n=0;n<r;n++)t+=e[n]===0?"0":"1";return t}var Ht=class{constructor(){this.pointer=0,this.bits=[0]}action(t){switch(t.op){case 1:return this.pointer===0?0:(this.pointer--,1);case 0:{this.pointer++;let r=this.bits;this.pointer===r.length&&r.push(0);break}case 2:{let r=this.pointer,n=this.bits;if(r<n.length){let s=n[r]??d();return n[r]=0,s}else return 0}case 3:{let r=this.bits,n=this.pointer;if(n>=r.length&&this.extend(),r[n]===1)throw Error(`The bit of the binary register B${t.regNumber} is already 1`);r[n]=1;break}default:throw Error("BReg action: "+t.op)}}actionN(t,r){switch(t.op){case 0:{this.pointer+=r,this.extend();break}case 1:{this.pointer-=r;break}default:throw Error("todo")}}getBits(){return this.bits}setBits(t){this.bits=t}inc(){let t=this.action(new g(0,0));return t!==void 0&&d(),t}tdec(){let t=this.action(new g(1,0));return t===void 0&&d(),t}read(){let t=this.action(new g(2,0));return t===void 0&&d(),t}set(){let t=this.action(new g(3,0));return t!==void 0&&d(),t}extend(){let t=this.pointer,r=this.bits,n=r.length;if(t>=n)if(t===n)r.push(0);else{let s=Array(t-n+1).fill(0).map(()=>0);this.bits=this.bits.concat(s)}}toNumberString(t=10){return(wn?BigInt:Number)("0b"+zt(this.bits)).toString(t)}toObject(){this.extend();let t=this.bits,r=this.pointer;return{prefix:t.slice(0,r),head:t[r]??d(),suffix:t.slice(r+1)}}setByRegistersInit(t,r){let n=i=>{throw Error(`Invalid #REGISTERS ${i}`)},s=`"${t}": ${JSON.stringify(r)}`;if(typeof r=="number")this.setBits(cr(r.toString(2)).reverse()),this.extend();else if(!Array.isArray(r)||r.length!==2)n(s);else{let i=r[0],o=r[1];if(typeof i!="number"||typeof o!="string")n(s);else if(i<0||!Number.isInteger(i))n(s);else{let a=cr(o);this.pointer=i,this.setBits(a),this.extend()}}}};var Bn=()=>{throw Error("error")},Rn=()=>{let e=f("span",{classes:["decimal"]}),t=f("span",{classes:["hex"]}),r=f("span",{classes:["max_pointer"]}),n=f("span",{classes:["pointer"]});return{metaData:f("code",{classes:["binary_info","word-break-all"],children:[e,t,r,n]}),$decimal:e,$hex:t,$maxPointer:r,$pointer:n}},In=()=>{let e=f("span",{classes:["prefix"]}),t=f("span",{classes:["binary-head"]}),r=f("span",{classes:["suffix"]});return{binaryBits:f("code",{classes:["word-break-all"],children:[e,t,r]}),$prefix:e,$head:t,$suffix:r}},Ot=class{constructor(t){this.root=t,this.cells=[]}initialize(t){this.clear();let r=[],n=f("table");for(let s of t.keys()){let i=f("td");i.dataset.test=`B${s}`;let{metaData:o,$decimal:a,$hex:u,$maxPointer:p,$pointer:l}=Rn();i.append(o,f("br"));let{binaryBits:E,$prefix:R,$head:F,$suffix:U}=In();i.append(E);let de=f("tr",{children:[f("th",`B${s}`),i]});n.append(de),r.push({$decimal:a,$hex:u,$maxPointer:p,$pointer:l,$prefix:R,$head:F,$suffix:U})}this.root.append(n),this.cells=r}clear(){this.cells=[],this.root.innerHTML=""}render(t,r,n,s,i){let o=0,a=this.cells;for(let u of t.values()){let{$prefix:p,$head:l,$suffix:E,$decimal:R,$hex:F,$maxPointer:U,$pointer:de}=a[o]??Bn();if(r)p.innerHTML="",l.innerHTML="",E.innerHTML="";else{let ct=u.toObject();p.textContent=n?zt(ct.suffix):we(ct.prefix),l.textContent=ct.head.toString(),E.textContent=n?zt(ct.prefix):we(ct.suffix)}s?R.textContent="value = "+u.toNumberString(10)+", ":R.innerHTML="",i?F.textContent="hex = "+u.toNumberString(16)+", ":F.innerHTML="",U.textContent="max_pointer = "+(u.getBits().length-1)+", ",de.textContent="pointer = "+u.pointer.toString(),o++}}};var $=e=>e.toLocaleString();var ur="stats_current_state",Nn=(e,{z:t,nz:r})=>{let n=f("td",{fn:p=>{p.colSpan=2},children:[f("code",e)]}),s="num",i=f("td",{text:$(t+r),classes:[s]}),o=f("td",{text:$(t),classes:[s]}),a=f("td",{text:$(r),classes:[s]});return{$tr:f("tr",{children:[n,i,o,a]}),$sum:i,$z:o,$nz:a}},Gt=class{#e;constructor(t,r){this.root=t,this.#e=r,this.cells=[]}initialize(t,r){this.#e.textContent=$(r.length),this.cells=[],this.root.innerHTML="";for(let[n,s]of t.entries()){let i=r[n]??"",{$tr:o,$sum:a,$z:u,$nz:p}=Nn(i,s);this.root.append(o),this.cells.push({$sum:a,$z:u,$nz:p,$tr:o})}}clear(){this.#e.innerHTML="",this.cells=[],this.root.innerHTML=""}render(t,r){let n=t,s=this.cells,i=s.length;for(let o=0;o<i;o++){let a=s[o]??pr();r===o?a.$tr.classList.add(ur):a.$tr.classList.remove(ur);let{z:u,nz:p}=n[o]??pr();a.$sum.textContent=$(u+p),a.$z.textContent=$(u),a.$nz.textContent=$(p)}}};function pr(){throw Error("error")}function fr(e,t){if(e.innerHTML="",t===void 0)return;let r=f("option","None");r.value="-1",r.selected=!0,e.append(r);for(let[n,s]of t.getStateMap()){let i=f("option",n);i.value=s.toString(),e.append(i)}}function dr(e){switch(e.value){case"*":return-1;case"Z":return 0;default:return 1}}var vn="Start",Dn="Stop",lr="btn-primary",mr="btn-danger",hr=e=>`<svg width="16" height="16" viewBox="0 0 16 16">${e}</svg>`,An=()=>{let e=f("div");return e.innerHTML=hr('<path stroke="currentColor" stroke-width="1" d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>')+vn,e},Cn=An(),Ln=()=>{let e=f("div");return e.innerHTML=hr('<path stroke="currentColor" stroke-width="1" d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>')+Dn,e},Mn=Ln();function ut(e){e.disabled=!1,e.replaceChildren(Cn),e.classList.add(lr),e.classList.remove(mr)}function gr(e){e.disabled=!1,e.replaceChildren(Mn),e.classList.remove(lr),e.classList.add(mr)}function xr(e,t,r){if(e.replaceChildren(),t==="RuntimeError"||t==="ParseError"){let n=r.split(`
`);for(let s of n)e.append(f("span","- "+s),f("br"));e.classList.remove("d-none")}else e.classList.add("d-none")}var pt=40,Vt=window.innerWidth;Vt>=1200?pt=120:Vt>=992?pt=100:Vt>=768?pt=70:Vt>=576&&(pt=50);var br=(e,t)=>{if(t=t??"",e.value===t)return;e.value=t;let r=t.length,s=Math.min(6,Math.max(1,Math.ceil(r/pt)));e.rows=s};var kn=()=>{let e=[];for(let r=0;r<=6;r++)for(let n=1;n<=9;n++)e.push(n*10**r);return e.push(1e7,15e6),e};function yr(e,t){let r=kn();e.min="0",e.max=(r.length-1).toString(),e.addEventListener("input",()=>{let n=parseInt(e.value,10),s=r[n];if(s===void 0)throw Error("internal error");e.ariaValueText=`(${s.toString()}Hz)`,t.setFrequency(s)})}var Sr=(e,t)=>{e.setCustomValidity(t),e.reportValidity(),e.classList.add("is-invalid")},Er=e=>{e.setCustomValidity(""),e.reportValidity(),e.classList.remove("is-invalid")};function _r(e,t){e.addEventListener("input",()=>{let r=e.files?.item(0);r?.text().then(t)})}var Yt=window.requestIdleCallback??(e=>{setTimeout(()=>{e({didTimeout:!1,timeRemaining(){return 0}})},0)});function ft(e,t){try{localStorage.setItem(e,t)}catch{}}function Be(e){try{localStorage.removeItem(e)}catch{}}function dt(e){try{return localStorage.getItem(e)}catch{return null}}var Un=new Set(["textarea","input","summary","details","button","audio","video","select","option","a","area","modal"]),$r=()=>{let e=document.activeElement?.tagName.toLowerCase()??"";return Un.has(e)};var y=HTMLElement,Tr=c("#error",y),I=c("#input",HTMLTextAreaElement),wr=c("#output",HTMLTextAreaElement),Br=c("#steps",y),T=c("#toggle",HTMLButtonElement),k=c("#reset",HTMLButtonElement),w=c("#step",HTMLButtonElement),Zt=c("#step-text",y),Rr=c("#config_button",HTMLButtonElement),J=c("#stats_button",HTMLButtonElement),Ir=c("#current_state",y),Nr=c("#previous_output",y),vr=c("#frequency_input",HTMLInputElement),Dr=c("#frequency_output",y),Ar=c("#command",y),Pt=c("#canvas",HTMLCanvasElement),Ft=Pt.getContext("2d")??(()=>{throw Error("context is null")})(),lt={x:c("#b2dx",y),y:c("#b2dy",y)},mt=c("#b2d_detail",HTMLDetailsElement),Cr=c("#unary_register",y),qt=c("#unary_register_detail",HTMLDetailsElement),Lr=c("#binary_register",y),Xt=c("#binary_register_detail",HTMLDetailsElement),Mr=c("#add_sub_mul",y),kr=c("#import_file",HTMLInputElement),Wt=c("#examples",HTMLButtonElement),Ur=document.querySelectorAll(".js_example"),Re=c("#config_modal_content",y),ht=c("#step_input",HTMLInputElement),_={$hideBits:c("#hide_bits",HTMLInputElement),$reverseBits:c("#reverse_bits",HTMLInputElement),$showBinaryValueInDecimal:c("#show_binary_value_in_decimal",HTMLInputElement),$showBinaryValueInHex:c("#show_binary_value_in_hex",HTMLInputElement)},Ie=c("#breakpoint_select",HTMLSelectElement),Hr=c("#breakpoint_input_select",HTMLSelectElement),gt=c("#dark_mode",HTMLInputElement),Ne=c("#dark_mode_label",y),jt=c("#b2d_hide_pointer",HTMLInputElement),xt=c("#b2d_flip_upside_down",HTMLInputElement),Kt=c("#stats_modal",y),zr=c("#stats_body",HTMLTableSectionElement),Or=c("#stats_number_of_states",y),Gr=c("#view-state-diagram",HTMLButtonElement);var ve="A1",De="B0",Ae="B1",Vr="ADD";function Hn(e){switch(e){case 0:return ve;case 1:return De;case 2:return Ae}}function zn(e){switch(e){case ve:return 0;case De:return 1;case Ae:return 2}}var N=class e extends m{constructor(t){super(),this.op=t}pretty(){return`${Vr} ${Hn(this.op)}`}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==2)return;let[n,s]=r;if(n===Vr&&(s===ve||s===De||s===Ae))return new e(zn(s))}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0}}isSameComponent(t){return t instanceof e}};var Yr="HALT_OUT",S=class e extends m{constructor(){super()}pretty(){return Yr}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==1)return;let[n]=r;if(n===Yr)return new e}doesReturnValue(){return!1}isSameComponent(t){return t instanceof e}};var Ce="0",Le="1",Zr="MUL";function On(e){switch(e){case Ce:return 0;case Le:return 1}}function Gn(e){switch(e){case 0:return Ce;case 1:return Le}}var rt=class e extends m{constructor(t){super(),this.op=t}pretty(){return`${Zr} ${Gn(this.op)}`}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==2)return;let[n,s]=r;if(n===Zr&&(s===Ce||s===Le))return new e(On(s))}doesReturnValue(){return!0}isSameComponent(t){return t instanceof e}};var Pr="NOP",Z=class e extends m{constructor(){super()}pretty(){return Pr}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==1)return;let[n]=r;if(n===Pr)return new e}doesReturnValue(){return!0}isSameComponent(t){return t instanceof e}};var Fr="OUTPUT",nt=class e extends m{constructor(t){super(),this.digit=t}pretty(){return`${Fr} ${this.digit}`}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==2)return;let[n,s]=r;if(n===Fr&&s!==void 0)return new e(s)}doesReturnValue(){return!1}isSameComponent(t){return t instanceof e}};var Me="A1",ke="B0",Ue="B1",qr="SUB";function Vn(e){switch(e){case 0:return Me;case 1:return ke;case 2:return Ue}}function Yn(e){switch(e){case Me:return 0;case ke:return 1;case Ue:return 2}}var st=class e extends m{constructor(t){super(),this.op=t}pretty(){return`${qr} ${Vn(this.op)}`}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==2)return;let[n,s]=r;if(n===qr&&(s===Me||s===ke||s===Ue))return new e(Yn(s))}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0}}isSameComponent(t){return t instanceof e}};var He="INC",ze="DEC",Oe="READ",Ge="SET",Ve="RESET";function Zn(e){switch(e){case 0:return He;case 1:return ze;case 2:return Oe;case 3:return Ge;case 4:return Ve}}function Pn(e){switch(e){case He:return 0;case ze:return 1;case Oe:return 2;case Ge:return 3;case Ve:return 4}}var H=class e extends m{constructor(t,r){super(),this.op=t,this.regNumber=r}pretty(){return`${Zn(this.op)} T${this.regNumber}`}static parse(t){let r=t.trim().split(/\s+/u);if(r.length!==2)return;let[n,s]=r;if(!(n===void 0||s===void 0)&&(n===He||n===ze||n===Oe||n===Ge||n===Ve)&&s.startsWith("T")){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new e(Pn(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case 0:return!0;case 1:return!0;case 2:return!0;case 3:return!1;case 4:return!1}}isSameComponent(t){return t instanceof e?this.regNumber===t.regNumber:!1}};var te=class{constructor(){this.value=0}action(t){switch(t.op){case 1:{let r=this.value,n=r%2;return this.value=[0,0,0,0,0,0,9,9,0,0,9,9,9,9,9,9][r]??d(),n}case 2:{let r=this.value,n=1-r%2;return this.value=[0,0,0,0,9,9,0,0,9,9,0,0,9,9,9,9][r]??d(),n}case 0:{this.value=[5,4,7,6,1,0,3,2,13,12,15,14,9,8,11,10][this.value]??d();return}default:d()}}getValue(){return this.value}a1(){this.action(new N(0))}b0(){let t=this.action(new N(1));return t===void 0&&d(),t}b1(){let t=this.action(new N(2));return t===void 0&&d(),t}toString(){return this.value.toString(2).padStart(4,"0")}toStringDetail(){let t=this.toString();return`${t.slice(0,3)} bit${t.slice(3)}`}};var ee=class{constructor(){this.value=0}action(t){switch(t.op){case 0:return this.mul0();case 1:return this.mul1();default:throw Error("MUL: action")}}getValue(){return this.value}mul0(){let t=this.value,r=t%2;return this.value=t>>1,r}mul1(){let t=this.value,r=t%2;return t<=21?this.value=(t>>1)+5:this.value=t-22>>1,r}toString(){return this.value.toString(2).padStart(5,"0")}};var re=class{constructor(){}action(){return 0}};var ne=class{#e="";constructor(){}action(t){this.output(t.digit)}getString(){return this.#e}output(t){this.#e+=t}};var se=class{constructor(){this.value=0}action(t){switch(t.op){case 1:return this.b0();case 0:return this.a1();case 2:return this.b1();default:d()}}getValue(){return this.value}a1(){let r=[3,2,-1,-1,7,6,-1,-1,11,10,-1,-1,15,14,-1,-1,19,18,-1,-1,23,22,-1,-1,27,26,-1,-1,31,30,-1,-1][this.value]??d();if(r===-1)throw Error("SUB error: A1");this.value=r}b0(){let t=this.value%2,r=[0,0,0,0,17,17,0,0,0,0,0,0,0,0,17,17,17,17,0,0,17,17,17,17,0,0,17,17,17,17,17,17];return this.value=r[this.value]??d(),t}b1(){let t=1-this.value%2,r=[17,17,0,0,0,0,0,0,0,0,17,17,0,0,0,0,17,17,17,17,17,17,0,0,17,17,17,17,0,0,17,17];return this.value=r[this.value]??d(),t}toString(){return this.value.toString(2).padStart(5,"0")}toStringDetail(){let t=this.toString();return t.slice(0,3)+" stopper"+t.slice(3,4)+" bit"+t.slice(4)}};var ie=class{constructor(){this.pointer=0,this.bits=[0]}action(t){switch(t.op){case 0:return this.inc();case 2:return this.read();case 1:return this.dec();case 3:return this.set();case 4:return this.reset();default:d()}}getPointer(){return this.pointer}getBits(){return this.bits}inc(){let t=this.bits;return this.pointer===t.length-1?(t.push(0),this.pointer++,0):(this.pointer++,1)}dec(){return this.pointer===0?0:(this.pointer--,1)}read(){let t=this.pointer,r=this.bits[t];if(r===0)return this.bits[t]=-1,0;if(r===1)return this.bits[t]=-1,1;if(r===-1)throw Error("Error: reading empty space of T register");d()}set(){if(this.bits[this.pointer]===-1)this.bits[this.pointer]=1;else throw Error("Error: SET to nonempty bit")}reset(){if(this.bits[this.pointer]===-1)this.bits[this.pointer]=0;else throw Error("Error: RESET to nonempty bit")}};function Bt(e,t){throw Error(`Register ${e}${t} is not found.`)}var Xr=Number.parseInt,Wr=Number.isNaN,oe=class{constructor({unaryRegisterNumbers:t,binaryRegisterNumbers:r,legacyTRegisterNumbers:n}){this.uRegMap=new Map(t.map(s=>[s,new kt])),this.bRegMap=new Map(r.map(s=>[s,new Ht])),this.legecyTRegMap=new Map(n.map(s=>[s,new ie])),this.add=new te,this.sub=new se,this.mul=new ee,this.b2d=new Mt,this.output=new ne,this.nop=new re}setByRegistersInit(t){for(let[r,n]of Object.entries(t))this.#e(r,n)}setCache(t){t instanceof g?t.registerCache=this.getBReg(t.regNumber):t instanceof b&&(t.registerCache=this.getUReg(t.regNumber))}#e(t,r){if(t.startsWith("U")){let n=Xr(t.slice(1),10);Wr(n)&&Ye(t,r);let s=this.getUReg(n);if(s===void 0)throw Error(`Invalid #REGISTERS: U${n} isn't used in the program`);s.setByRegistersInit(t,r)}else if(t.startsWith("B")){let n=Xr(t.slice(1),10);Wr(n)&&Ye(t,r);let s=this.getBReg(n);if(s===void 0)throw Error(`Invalid #REGISTERS: B${n} isn't used in the program`);s.setByRegistersInit(t,r)}else Ye(t,r)}execAction(t){if(t instanceof g)return(t.registerCache??this.bRegMap.get(t.regNumber)??Bt("B",t.regNumber)).action(t);if(t instanceof b)return(t.registerCache??this.uRegMap.get(t.regNumber)??Bt("U",t.regNumber)).action(t);if(t instanceof N)return this.add.action(t);if(t instanceof Z)return this.nop.action();if(t instanceof st)return this.sub.action(t);if(t instanceof rt)return this.mul.action(t);if(t instanceof W)return this.b2d.action(t);if(t instanceof nt)return this.output.action(t);if(t instanceof S)return-1;if(t instanceof H)return(this.legecyTRegMap.get(t.regNumber)??Bt("T",t.regNumber)).action(t);throw Error(`execAction: unknown action ${t.pretty()}`)}execActionN(t,r){if(t instanceof b)return(t.registerCache??this.uRegMap.get(t.regNumber)??Bt("U",t.regNumber)).actionN(t,r);if(t instanceof g)return(t.registerCache??this.bRegMap.get(t.regNumber)??Bt("B",t.regNumber)).actionN(t,r);if(t instanceof S)return-1;throw Error(`execActionN: ${t.pretty()}`)}getUReg(t){return this.uRegMap.get(t)}getBReg(t){return this.bRegMap.get(t)}addSubMulToUIString(){return`
        ADD = ${this.add.toStringDetail()},
        SUB = ${this.sub.toStringDetail()},
        MUL = ${this.mul.toString()}
        `}};function Ye(e,t){let r=`"${e}": ${JSON.stringify(t)}`;throw Error(`Invalid #REGISTERS ${r}`)}function Ze(e){let t=[g.parse,b.parse,W.parse,Z.parse,N.parse,rt.parse,st.parse,nt.parse,S.parse,H.parse];for(let r of t){let n=r(e);if(n!==void 0)return n}}var Rt="INITIAL",P=class{pretty(){return""}},z=class e extends P{constructor(t){super(),this.content=t}static get key(){return"#COMPONENTS"}pretty(){return e.key+" "+this.content}},O=class e extends P{constructor(t){super(),this.content=t}static get key(){return"#REGISTERS"}pretty(){return e.key+" "+this.content}},Pe=class extends P{constructor(t){super(),this.str=t}getString(){return this.str}pretty(){return this.getString()}},Fe=class extends P{constructor(){super()}pretty(){return""}};function Fn(e){switch(e){case"Z":return e;case"NZ":return e;case"ZZ":return e;case"*":return e;default:return}}var ot=class extends P{constructor({state:t,input:r,nextState:n,actions:s,line:i}){super(),this.state=t,this.input=r,this.nextState=n,this.actions=s,this.line=i,this._string=`${this.state}; ${this.input}; ${this.nextState}; ${this.actions.map(o=>o.pretty()).join(", ")}`}pretty(){return this._string}};function ae(){throw Error("internal error")}function jr(e,t){let r=e.trim();if(r==="")return new Fe;if(r.startsWith("#"))return r.startsWith(z.key)?new z(r.slice(z.key.length).trim()):r.startsWith(O.key)?new O(r.slice(O.key.length).trim()):new Pe(e);let n=r.split(/\s*;\s*/u);if(n.length<4)return`Invalid line "${e}"${it(t)}`;if(n.length>4)return n[4]===""?`Extraneous semicolon "${e}"${it(t)}`:`Invalid line "${e}"${it(t)}`;let s=n[0]??ae(),i=n[1]??ae(),o=n[2]??ae(),u=(n[3]??ae()).trim().split(/\s*,\s*/u).filter(E=>E!==""),p=[];for(let E of u){let R=Ze(E);if(R===void 0)return`Unknown action "${E}" in "${e}"${it(t)}`;p.push(R)}let l=Fn(i);return l===void 0?`Unknown input "${i}" in "${e}"${it(t)}. Expect "Z", "NZ", "ZZ" or "*"`:new ot({state:s,input:l,nextState:o,actions:p,line:t})}function it(e){return e!==void 0?` at line ${e}`:""}function x(e){return it(e.line)}function Kr(e){let t=e.actions;if(t.some(n=>n instanceof S))return;let r=t.filter(n=>n.doesReturnValue());if(r.length!==1)return r.length===0?`Does not produce the return value in "${e.pretty()}"${x(e)}`:`Does not contain exactly one action that produces a return value in "${e.pretty()}": Actions that produce value are ${r.map(n=>`"${n.pretty()}"`).join(", ")}${x(e)}`}var Jr=e=>{if(e.nextState===Rt)return`Return to initial state in "${e.pretty()}"${x(e)}`};function Qr(e){let t=e.actions;if(t.length<=1)return;let r=t.map(s=>s.pretty());r.sort();let n=r.length-1;for(let s=0;s<n;s++){let i=r[s],o=r[s+1];if(i===o)return`Duplicated actions "${i}" in "${e.pretty()}"${x(e)}`}}var tn=()=>{throw Error("internal error")};function en(e){let t=e.actions;if(t.find(n=>n instanceof S)!==void 0)return;let r=t.length;if(!(r<=1))for(let n=0;n<r;n++){let s=t[n]??tn();for(let i=n+1;i<r;i++){let o=t[i]??tn();if(s.isSameComponent(o))return`Actions "${s.pretty()}" and "${o.pretty()}" use same component in "${e.pretty()}"${x(e)}`}}}var rn=()=>{throw Error("internal error")},qn=(e,t)=>e.line!==void 0&&t?.line!==void 0?` at line ${e.line} and ${t.line}`:"",nn=e=>{if(e.length===0)return;let t=(s,i)=>`Need Z line followed by NZ line in "${s.pretty()}"${qn(s,i)}`,r=e.length-1;for(let s=0;s<r;s++){let i=e[s]??rn(),o=e[s+1]??rn(),a=i.input,u=o.input;if(a==="Z"&&u!=="NZ"||u==="NZ"&&a!=="Z"||a==="Z"&&u==="NZ"&&i.state!==o.state)return[t(i,o)]}let n=e[r];if(n?.input==="Z")return[t(n)]};var ce=class e{constructor(t){this.array=t}getArray(){return this.array}pretty(){return this.array.map(t=>t.pretty()).join(`
`)}static parse(t){let n=t.split(/\r\n|\n|\r/u).map((o,a)=>jr(o,a+1)),s=n.flatMap(o=>typeof o=="string"?[o]:[]);if(s.length>0)return s.join(`
`);let i=n.flatMap(o=>typeof o!="string"?[o]:[]);return new e(i)}};function sn(e){let t=[];{let r=[Qr,Kr,en,Jr];for(let n of e)for(let s of r){let i=s(n);typeof i=="string"&&t.push(i)}}{let r=[nn];for(let n of r){let s=n(e);s!==void 0&&(t=t.concat(s))}}if(t.length>0)return t.join(`
`)}var It=class e{constructor({programLines:t}){let r=t.getArray();this.commands=r.flatMap(n=>n instanceof ot?[n]:[]),this.componentsHeader=void 0;for(let n of r)if(n instanceof z){if(this.componentsHeader!==void 0)throw Error(`Multiple ${z.key}`);this.componentsHeader=n}this.registersHeader=void 0;for(let n of r)if(n instanceof O){if(this.registersHeader!==void 0)throw Error(`Multiple ${O.key}`);this.registersHeader=n}this.programLines=t}static parse(t,{noValidate:r}={}){let n=ce.parse(t);if(typeof n=="string")return n;let s=[];for(let i of n.getArray())i instanceof ot&&s.push(i);if(!r){if(s.length===0)return"Program is empty";let i=sn(s);if(typeof i=="string")return i}try{return new e({programLines:n})}catch(i){return i instanceof Error?i.message:"Unknown error is occurred."}}pretty(){return this.programLines.pretty()}},Xn=e=>[...new Set(e)].sort((t,r)=>t-r),on=e=>{let t=e.commands.flatMap(n=>n.actions),r=n=>Xn(t.flatMap(s=>s instanceof n?[s.regNumber]:[]));return{unary:r(b),binary:r(g),legacyT:r(H)}};var Wn=e=>e instanceof g&&e.op===0,jn=e=>e instanceof b&&e.op===1,Kn=e=>{if(e.input==="NZ"&&e.state===e.nextState&&e.actions.every(t=>!(t instanceof S))&&e.actions.every(t=>t instanceof b||Wn(t))){let t=e.actions.find(jn);if(t&&t instanceof b)return{tdecU:t}}},Jn=e=>{if(e.input==="NZ"&&e.state===e.nextState&&e.actions.every(t=>!(t instanceof S))&&e.actions.length===1&&e.actions.every(t=>t instanceof g)){let t=e.actions.find(r=>r instanceof g&&r.op===1);if(t&&t instanceof g)return{tdecB:t}}},at=class{constructor(t,r){this.command=t,this.nextState=r,this.tdecuOptimize=Kn(t),this.tdecbOptimize=Jn(t)}},Xe=class{constructor(t,r){this.z=t,this.nz=r}},qe=(e,t)=>{throw Error(`Duplicated command: "${e.pretty()}" and "${t.pretty()}"${x(t)}`)},an=e=>{let t=new Map,r=[];for(let n of e)t.has(n.state)||(t.set(n.state,t.size),r.push(new Xe(void 0,void 0)));for(let n of e){let s=r[t.get(n.state)??d()]??d(),i=t.get(n.nextState);if(i===void 0)throw Error(`Unknown state: "${n.nextState}" at "${n.pretty()}"${x(n)}`);switch(n.input){case"Z":{s.z===void 0?s.z=new at(n,i):qe(s.z.command,n);break}case"NZ":{s.nz===void 0?s.nz=new at(n,i):qe(s.nz.command,n);break}case"ZZ":{if(s.nz!==void 0)throw Error(`Invalid input: ZZ with NZ or *: "${n.pretty()}" and "${s.nz.command.pretty()}"${x(n)}`);s.z===void 0?s.z=new at(n,i):qe(s.z.command,n);break}case"*":{if(s.nz!==void 0)throw Error(`Invalid input: * "${n.pretty()}" and "${s.nz.command.pretty()}"${x(n)}`);if(s.z!==void 0)throw Error(`Invalid input: * "${n.pretty()}" and "${s.z.command.pretty()}"${x(n)}`);{let o=new at(n,i);s.z=o,s.nz=o}break}default:d()}}return{states:[...t.keys()],stateMap:t,lookup:r}};var B=(e="error")=>{throw Error(e)},Nt=class e{constructor(t){if(!(t instanceof It))throw TypeError("program is not a Program");this.stepCount=0;let r=on(t);this.actionExecutor=new oe({binaryRegisterNumbers:r.binary,unaryRegisterNumbers:r.unary,legacyTRegisterNumbers:r.legacyT}),this.prevOutput=0,this.program=t;let{states:n,stateMap:s,lookup:i}=an(t.commands);this.states=n,this.stateMap=s,this.lookup=i;for(let a of i){let u=(a.z?.command.actions??[]).concat(a.nz?.command.actions??[]);for(let p of u)this.actionExecutor.setCache(p)}this.currentStateIndex=s.get(Rt)??B(`${Rt} state is not present`),this.stateStatsArray=[];for(let a=0;a<i.length*2;a++)this.stateStatsArray.push(0);let o=t.registersHeader;o&&this.#e(o)}static fromString(t){let r=It.parse(t);if(typeof r=="string")throw Error(r);return new e(r)}getStateStats(){let t=this.stateStatsArray,r=t.length,n=[];for(let s=0;s<r;s+=2)n.push({z:t[s]??B(),nz:t[s+1]??B()});return n}#e(t){let r=t.content.replace(/'/ug,'"'),n={};try{n=JSON.parse(r)}catch{B(`Invalid #REGISTERS: is not a valid JSON: "${r}"`)}(n===null||typeof n!="object")&&B(`Invalid #REGISTERS: "${r}" is not an object`),this.actionExecutor.setByRegistersInit(n)}getCurrentState(){let t=this.states[this.currentStateIndex];return t===void 0&&B("State name is not found"),t}getStateMap(){return this.stateMap}getPreviousOutput(){return this.prevOutput===0?"Z":"NZ"}getNextCommand(){let t=this.currentStateIndex,r=this.lookup[t];if(r===void 0&&B(`Internal Error: Next command is not found: Current state index: ${t}`),this.prevOutput===0){let s=r.z;if(s!==void 0)return s}else{let s=r.nz;if(s!==void 0)return s}B("Next command is not found: Current state = "+this.getCurrentState()+", output = "+this.getPreviousOutput())}_internalExecActionN(t,r){try{let n=this.actionExecutor;for(let s of t.actions)n.execActionN(s,r)}catch(n){if(n instanceof Error)this.#n(n);else throw n}this.stateStatsArray[this.currentStateIndex*2+this.prevOutput]+=r,this.stepCount+=r}exec(t,r,n,s){let i=n!==-1,o=performance.now();for(let a=0;a<t;a++){let u=this.getNextCommand();if(u.tdecuOptimize){let l=u.tdecuOptimize.tdecU.registerCache?.getValue();if(l!==void 0&&l!==0){l=Math.min(l,t-a),this._internalExecActionN(u.command,l),a+=l-1;continue}}else if(u.tdecbOptimize){let l=u.tdecbOptimize.tdecB.registerCache?.pointer;if(l!==void 0&&l!==0){l=Math.min(l,t-a),this._internalExecActionN(u.command,l),a+=l-1;continue}}try{if(this.execCommandFor(u)===-1)return"Halted"}catch(p){if(p instanceof Error)this.#n(p);else throw p}if(i&&this.currentStateIndex===n&&(s===-1||s===this.prevOutput))return"Stop";if(r&&(a+1)%5e5===0&&performance.now()-o>=50)return}}#n(t){let r=this.getNextCommand().command,n=x(r);return B(t.message+` in "${r.pretty()}"`+n)}execCommandFor(t){this.stepCount+=1;{let o=this.currentStateIndex,a=this.prevOutput;this.stateStatsArray[o*2+a]++}let r=-1,n=this.actionExecutor,s=t.command;for(let o of s.actions){let a=n.execAction(o);if(a===-1)return-1;a!==void 0&&(r===-1?r=a:B(`Return value twice: line = ${s.pretty()}${x(s)}`))}r===-1&&B(`No return value: line = ${s.pretty()}${x(s)}`);let i=t.nextState;this.currentStateIndex=i,this.prevOutput=r}execCommand(){return this.execCommandFor(this.getNextCommand())}};var Qn=30,ue=class{#e;#n="";#t;#c;#o=new Ut(Cr);#a=new Ot(Lr);#i=new Gt(zr,Or);#s;#r="Initial";constructor(){this.stepConfig=1,this.#s=new Dt(t=>{this.run(t)},{frequency:Qn})}setFrequency(t){this.#s.frequency=t,this.#u()}start(){switch(this.#r){case"Initial":{this.reset()&&(this.#r="Running");break}case"Stop":{this.#r="Running";break}default:throw Error("start: unreachable")}this.render()}stop(){this.#r="Stop",this.render()}toggle(){this.#r==="Running"?this.stop():this.start()}#p(){this.#t===void 0?this.#o.clear():this.#o.initialize(this.#t.actionExecutor.uRegMap)}#f(){this.#t===void 0?this.#a.clear():this.#a.initialize(this.#t.actionExecutor.bRegMap)}#d(){this.#p(),this.#f(),this.#h(),fr(Ie,this.#t)}doStep(){if(this.#r==="Running"&&this.stop(),this.stepConfig>=5e6){let t=Qe();t.style.position="absolute",w.append(t),Zt.style.color="transparent",w.disabled=!0,k.disabled=!0,T.disabled=!0,setTimeout(()=>{try{this.run(this.stepConfig)}finally{Zt.style.color="",t.remove()}},33)}else this.run(this.stepConfig)}setInputAndReset(t){I.value=t,this.reset()}reset(){this.#n="",this.#t=void 0,this.#s.reset();try{this.#t=Nt.fromString(I.value),this.#d(),this.#r="Stop"}catch(t){return this.#r="ParseError",this.#n=le(t),this.render(),!1}return this.render(),!0}#u(){let t=this.#s.frequency;this.#c!==t&&(Dr.textContent=$(t),this.#c=t)}#l(){try{let t=this.#t?.getNextCommand();Ar.textContent=t?.command.pretty()??""}catch(t){console.error(t)}}renderB2D(){if(!mt.open)return;let t=this.#t;if(t===void 0){lt.x.textContent="0",lt.y.textContent="0",Ft.clearRect(0,0,Pt.width,Pt.height),Ft.resetTransform();return}let r=t.actionExecutor.b2d;lt.x.textContent=r.x.toString(),lt.y.textContent=r.y.toString();let n=performance.now();ir(Ft,r,jt.checked,xt.checked),this.#r==="Running"&&performance.now()-n>=200&&(mt.open=!1)}renderUnary(){this.#t!==void 0&&qt.open&&this.#o.render(this.#t.actionExecutor.uRegMap)}renderBinary(){this.#t!==void 0&&Xt.open&&this.#a.render(this.#t.actionExecutor.bRegMap,_.$hideBits.checked,_.$reverseBits.checked,_.$showBinaryValueInDecimal.checked,_.$showBinaryValueInHex.checked)}#m(){let t=this.#t?.actionExecutor.output.getString();br(wr,t)}#h(){this.#t===void 0?this.#i.clear():this.#i.initialize(this.#t.getStateStats(),this.#t.states)}renderStats(){if(Kt.classList.contains("show")){if(this.#t===void 0){this.#i.clear();return}this.#i.render(this.#t.getStateStats(),this.#t.currentStateIndex)}}#g(){switch(this.#r){case"Initial":{ut(T),w.disabled=!1,k.disabled=!1,J.disabled=!0;break}case"Stop":{ut(T),w.disabled=!1,k.disabled=!1,J.disabled=!1;break}case"Running":{gr(T),w.disabled=!0,k.disabled=!0,J.disabled=!1;break}case"RuntimeError":case"ParseError":{ut(T),T.disabled=!0,w.disabled=!0,k.disabled=!1,J.disabled=!0;break}case"Halted":{ut(T),T.disabled=!0,w.disabled=!0,k.disabled=!1,J.disabled=!1;break}}}render(){let t=this.#r;this.#s.disabled=t!=="Running",(this.#e!==t||t==="Stop")&&(this.#g(),t==="ParseError"?I.classList.add("is-invalid"):I.classList.remove("is-invalid")),xr(Tr,t,this.#n),this.#u();let r=this.#t;Ir.textContent=r?.getCurrentState()??"",Nr.textContent=r?.getPreviousOutput()??"",Br.textContent=r?.stepCount.toLocaleString()??"";let n=this.stepConfig;Zt.textContent=n===1?"Step":`${$(n)} Steps`,this.#l(),this.#m(),this.renderUnary(),this.renderBinary(),Mr.textContent=r?.actionExecutor.addSubMulToUIString()??"",this.renderB2D(),this.renderStats(),this.#e=t}run(t){switch(this.#r){case"Initial":if(!this.reset())return}if(t<=0||isNaN(t))return;let r=this.#t;if(r===void 0)return;let n=this.#r==="Running",s=parseInt(Ie.value,10),i=dr(Hr);try{let o=r.exec(t,n,s,i);o!==void 0&&(this.#r=o)}catch(o){this.#r="RuntimeError",this.#n=le(o)}finally{this.render()}}};var ts="./frontend/data/",h=new ue;k.addEventListener("click",()=>{h.reset()});T.addEventListener("click",()=>{h.toggle()});w.addEventListener("click",()=>{h.doStep()});Ur.forEach(e=>{e.addEventListener("click",async()=>{Wt.style.opacity="0.5";let t=e.dataset.src;try{let r=await fetch(ts+t);if(!r.ok)throw Error("error");h.setInputAndReset(await r.text()),Ke()}catch(r){throw r}finally{Wt.removeAttribute("style")}})});yr(vr,h);mt.addEventListener("toggle",()=>{h.renderB2D()});Xt.addEventListener("toggle",()=>{h.renderBinary()});qt.addEventListener("toggle",()=>{h.renderUnary()});var Ke=()=>{I.scrollTop=0};_r(kr,e=>{h.setInputAndReset(e),Ke()});ht.addEventListener("input",()=>{let e=Number(ht.value);isNaN(e)||e<=0||!Number.isInteger(e)?(Sr(ht,"Enter a positive integer"),h.stepConfig=1):(Er(ht),h.stepConfig=e),h.render()});var vt=(e,t)=>{e.addEventListener("change",()=>{h.render(),ft(t,e.checked.toString())})},cn="hide_binary";vt(_.$hideBits,cn);var un="reverse_binary";vt(_.$reverseBits,un);var pe="show_binary_in_decimal";vt(_.$showBinaryValueInDecimal,pe);var pn="show_binary_in_hex";vt(_.$showBinaryValueInHex,pn);jt.addEventListener("change",()=>{h.renderB2D()});var fn="b2d_flip_upside_down";vt(xt,fn);Kt.addEventListener("shown.bs.modal",()=>{h.renderStats()});Gr.addEventListener("click",()=>{I.value.length>=10**6||(ft("state-diagram-input",I.value),window.open("./tools/diagram/index.html",void 0,"noreferrer=yes,noopener=yes"))});var We="apge_dark",fe="on",je="dark_mode";gt.addEventListener("change",()=>{gt.checked?(ft(je,fe),document.body.setAttribute(We,fe)):(Be(je),document.body.removeAttribute(We)),Ne.textContent=gt.checked?"On":"Off";let e="animate-color-and-background-color";document.body.classList.add(e),Re.classList.add(e),setTimeout(()=>{document.body.classList.remove(e),Re.classList.remove(e)},500)});document.addEventListener("keydown",e=>{if(!($r()||e.isComposing||e.metaKey||e.shiftKey||e.ctrlKey))switch(e.code){case"Enter":{h.toggle();break}case"Space":{w.disabled||(e.preventDefault(),h.doStep());break}}});I.addEventListener("drop",async e=>{e.preventDefault();let t=e.dataTransfer?.files.item(0);t!=null&&(h.setInputAndReset(await t.text()),Ke())});Wt.disabled=!1;Rr.disabled=!1;h.render();Yt(()=>{let e="initial_code",t=dt(e);t!==null&&(Be(e),h.setInputAndReset(t))});Yt(()=>{dt(pe)===null&&ft(pe,"true");let e=[{key:fn,checkbox:xt},{key:un,checkbox:_.$reverseBits},{key:cn,checkbox:_.$hideBits},{key:pe,checkbox:_.$showBinaryValueInDecimal},{key:pn,checkbox:_.$showBinaryValueInHex}];for(let{key:t,checkbox:r}of e)dt(t)==="true"&&(r.checked=!0);dt(je)===fe&&(document.body.setAttribute(We,fe),gt.checked=!0,Ne.textContent="On"),h.render()});"serviceWorker"in navigator&&Yt(async()=>{(await navigator.serviceWorker.getRegistrations()).map(t=>t.unregister())});
