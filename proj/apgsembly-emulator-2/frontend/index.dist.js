function c(r,t){let e=document.querySelector(r);if(e==null)throw Error(`can't found a element for "${r}"`);if(e instanceof t)return e;throw Error(`"${r}" is not a ${t.name}`)}function f(r,t=void 0){let e=document.createElement(r);if(typeof t=="string")e.textContent=t;else if(t!=null&&typeof t=="object"&&(t.text&&(e.textContent=t.text),t.classes&&e.classList.add(...t.classes),t.fn&&(t.fn(e),t.fn=void 0),t.children&&e.append(...t.children),t.style))for(let[n,s]of Object.entries(t.style))n in e.style?e.style.key=s:e.style.setProperty(n,s);return e}var pt=class extends Event{constructor(t){super("emit"),this.value=t}},Nt=class extends EventTarget{#r=0;#n=-1;constructor({frequency:t,signal:e}){super(),this._frequency=t,this._enabled=!1,this._id=0;let n=requestAnimationFrame,s=i=>{if(this._enabled&&this.#n!==-1){let o=i-this.#n,a=this.#r,u=a+o/1e3*this._frequency,p=Math.floor(u)-Math.floor(a);this.#r=u,this.dispatchEvent(new pt(p))}this.#n=i,this._id=n(s)};this._id=n(s),e?.addEventListener("abort",()=>{this.abort()})}abort(){this._id!==0&&cancelAnimationFrame(this._id)}get frequency(){return this._frequency}set frequency(t){this._frequency=t}get disabled(){return!this._enabled}set disabled(t){this._enabled=!t}reset(){this.#r=0}};function oe(r){return r instanceof Error?r.message:"Unknown error is occurred."}function*Ve(r,t){if(!Number.isInteger(t))throw RangeError("size is not an integer");let e=[];for(let n of r)e.push(n),t<=e.length&&(yield e,e=[]);e.length!==0&&(yield e)}function Ye(){let r=document.createElement("span");return r.classList.add("spinner-border","spinner-border-sm"),r.setAttribute("role","status"),r.setAttribute("aria-hidden","true"),r}function l(){throw Error("internal error")}var h=class{pretty(){return"unimplemented"}doesReturnValue(){return!1}isSameComponent(t){return!0}};var j=0,P=1,J=2,Q=3,D=4,A=5,M=6,Ct="INC",ae="TDEC",Lt="READ",Dt="SET",ce="B2DX",ue="B2DY",pe="B2D",tn="DEC",Ze="SQX",Fe="SQY",je="SQ";function Pe(r){switch(r){case Ct:return j;case ae:return P;case Lt:return J;case Dt:return Q}}function en(r){switch(r){case j:return Ct;case P:return ae;case J:return Lt;case Q:return Dt}}function qe(r){switch(r){case ce:return D;case ue:return A;case pe:return M}}function rn(r){switch(r){case D:return ce;case A:return ue;case M:return pe}}var S=class extends h{constructor(t,e){super(),this.op=t,this.axis=e}pretty(){return`${en(this.op)} ${rn(this.axis)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)){if(n===Ct||n===ae){if(s===ce||s===ue)return new S(Pe(n),qe(s))}else if((n===Lt||n===Dt)&&s===pe)return new S(Pe(n),qe(s));switch(n){case Ct:switch(s){case Ze:return new S(j,D);case Fe:return new S(j,A);default:return}case tn:switch(s){case Ze:return new S(P,D);case Fe:return new S(P,A);default:return}case Lt:switch(s){case je:return new S(J,M);default:return}case Dt:switch(s){case je:return new S(Q,M);default:return}}}}doesReturnValue(){switch(this.op){case j:return!1;case P:return!0;case J:return!0;case Q:return!1}}isSameComponent(t){return t instanceof S?this.axis===D&&t.axis===A?!1:!(this.axis===A&&t.axis===D):!1}};function fe(r,t){let e=[];for(let n=0;n<r;n++)e.push(t(n));return e}var At=class{constructor(t=0,e=0){if(t<0||e<0)throw RangeError("B2D constructor: negative");this.x=t,this.y=e,this.maxX=t,this.maxY=e,this.array=fe(this.maxY+1,()=>fe(this.maxX+1,()=>0))}getArray(){return this.array}getMaxX(){return this.maxX}getMaxY(){return this.maxY}action(t){switch(t.op){case j:{switch(t.axis){case D:return this.incB2DX();case A:return this.incB2DY();case M:l()}break}case P:{switch(t.axis){case D:return this.tdecB2DX();case A:return this.tdecB2DY();case M:l()}break}case J:{switch(t.axis){case M:return this.read();default:l()}break}case Q:{switch(t.axis){case M:return this.set();default:l()}break}default:l()}}incB2DX(){if(this.x++,this.maxX<this.x){for(let t of this.array)t.push(0);this.maxX=this.x}}incB2DY(){this.y++,this.maxY<this.y&&(this.array.push(fe(this.maxX+1,()=>0)),this.maxY=this.y)}tdecB2DX(){return this.x===0?0:(this.x--,1)}tdecB2DY(){return this.y===0?0:(this.y--,1)}read(){let t=this.array[this.y];t===void 0&&l();let e=t[this.x];return e===void 0&&l(),t[this.x]=0,e}set(){let t=this.array[this.y];if(t===void 0&&l(),t[this.x]===1)throw Error(`SET B2D: Tried to set when it was already 1. x = ${this.x}, y = ${this.y}.`);t[this.x]=1}toString(){return this.array.map(t=>t.join("")).join(`
`)}};function Xe(r,t,e,n){let s=r.canvas.width,i=r.canvas.height;s!==i&&(r.canvas.height=s),r.clearRect(0,0,s,s),r.resetTransform(),r.beginPath();let o=t.getMaxX(),a=t.getMaxY(),u=Math.max(o,a)+1,p=s/u;n&&(r.scale(1,-1),r.translate(0,-s));let d=t.getArray();r.fillStyle="#212529";for(let E=0;E<=a;E++){let R=d[E];if(R===void 0)throw Error("renderB2D: internal error");let K=E*p;for(let Y=0;Y<=o;Y++)R[Y]===1&&r.rect(Y*p,K,p,p)}r.fill(),e||(r.strokeStyle="#03A9F4",r.lineWidth=4,r.strokeRect(t.x*p,t.y*p,p,p))}var q=0,k=1,le="INC",de="TDEC",We="U",nn="R";function sn(r){switch(r){case q:return le;case k:return de}}function on(r){switch(r){case le:return q;case de:return k}}var g=class extends h{constructor(t,e){super(),this.op=t,this.regNumber=e,this.registerCache=void 0}pretty(){return`${sn(this.op)} ${We}${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===le||n===de)&&(s.startsWith(We)||s.startsWith(nn))){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new g(on(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case q:return!1;case k:return!0}}isSameComponent(t){return t instanceof g?this.regNumber===t.regNumber:!1}};var Mt=class{constructor(){this.value=0}action(t){switch(t.op){case k:return this.value===0?0:(this.value--,1);case q:this.value++}}actionN(t,e){switch(t.op){case k:{this.value-=e;break}case q:{this.value+=e;break}}}getValue(){return this.value}setValue(t){this.value=t}inc(){this.action(new g(q,0))}tdec(){let t=this.action(new g(k,0));return t===void 0&&l(),t}setByRegistersInit(t,e){(typeof e!="number"||e<0||!Number.isInteger(e))&&an(t,e),this.setValue(e)}};function an(r,t){let e=`"${r}": ${JSON.stringify(t)}`;throw Error(`Invalid #REGISTERS ${e}`)}function cn(r){if(window.innerWidth<768)return 8+1===r?r:8;let e=12;return e+1<=r&&r<=e+2?r:e}function un(r){return f("th",`U${r}`)}function pn(r,t){return f("td",{text:t.getValue().toString(),fn:e=>{e.dataset.test=`U${r}`}})}function fn(r){let t=[],e=[],n=cn(r.size);for(let i of Ve(r,n)){let o=f("tr"),a=f("tr");for(let[u,p]of i){o.append(un(u));let d=pn(u,p);t.push(d),a.append(d)}e.push({header:o,data:a})}let s=f("table");for(let i of e)s.append(i.header,i.data);return s.classList.add("table"),s.style.tableLayout="fixed",s.style.marginBottom="0",{table:s,cells:t}}var kt=class{constructor(t){this.root=t,this.cells=[]}initialize(t){let{table:e,cells:n}=fn(t);this.root.replaceChildren(e),this.cells=n}clear(){this.cells=[],this.root.innerHTML=""}render(t){let e=0,n=this.cells;for(let s of t.values()){let i=n[e];if(!i)throw Error("internal error");i.textContent=s.getValue().toString(),e++}}};var H=0,U=1,tt=2,et=3,he="INC",me="TDEC",ge="READ",xe="SET",Ke="B";function ln(r){switch(r){case H:return he;case U:return me;case tt:return ge;case et:return xe}}function dn(r){switch(r){case he:return H;case me:return U;case ge:return tt;case xe:return et}}var m=class extends h{constructor(t,e){super(),this.op=t,this.regNumber=e,this.registerCache=void 0}pretty(){return`${ln(this.op)} ${Ke}${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===he||n===me||n===ge||n===xe)&&s.startsWith(Ke)){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new m(dn(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case H:return!1;case U:return!0;case tt:return!0;case et:return!1}}isSameComponent(t){return t instanceof m?this.regNumber===t.regNumber:!1}};function Je(r){return[...r].map(t=>{if(t==="0")return 0;if(t==="1")return 1;throw Error(`Invalid #REGISTERS: "${r}"`)})}var hn=typeof BigInt<"u",Ht=class{constructor(){this.pointer=0,this.bits=[0]}action(t){switch(t.op){case U:return this.pointer===0?0:(this.pointer--,1);case H:{this.pointer++;let e=this.bits;this.pointer===e.length&&e.push(0);break}case tt:{let e=this.pointer,n=this.bits;if(e<n.length){let s=n[e]??l();return n[e]=0,s}else return 0}case et:{let e=this.bits,n=this.pointer;if(n>=e.length&&this.extend(),e[n]===1)throw Error(`The bit of the binary register B${t.regNumber} is already 1`);e[n]=1;break}default:throw Error("BReg action: "+t.op)}}actionN(t,e){switch(t.op){case H:{this.pointer+=e,this.extend();break}case U:{this.pointer-=e;break}default:throw Error("todo")}}getBits(){return this.bits}setBits(t){this.bits=t}inc(){let t=this.action(new m(H,0));return t!==void 0&&l(),t}tdec(){let t=this.action(new m(U,0));return t===void 0&&l(),t}read(){let t=this.action(new m(tt,0));return t===void 0&&l(),t}set(){let t=this.action(new m(et,0));return t!==void 0&&l(),t}extend(){let t=this.pointer,e=this.bits.length;if(t>=e)if(t===e)this.bits.push(0);else{let n=Array(t-e+1).fill(0).map(()=>0);this.bits=this.bits.concat(n)}}toBinaryString(){return this.bits.slice().reverse().join("")}toNumberString(t=10){return(hn?BigInt:Number)("0b"+this.toBinaryString()).toString(t)}toObject(){this.extend();let t=this.bits,e=this.pointer;return{prefix:t.slice(0,e),head:t[e]??l(),suffix:t.slice(e+1)}}setByRegistersInit(t,e){let n=i=>{throw Error(`Invalid #REGISTERS ${i}`)},s=`"${t}": ${JSON.stringify(e)}`;if(typeof e=="number")this.setBits(Je(e.toString(2)).reverse()),this.extend();else if(!Array.isArray(e)||e.length!==2)n(s);else{let i=e[0],o=e[1];typeof i!="number"||typeof o!="string"||i<0||!Number.isInteger(i)?n(s):(this.pointer=i,this.setBits(Je(o)),this.extend())}}};function mn(){throw Error("error")}function gn(){let r=f("span",{classes:["decimal"]}),t=f("span",{classes:["hex"]}),e=f("span",{classes:["pointer"]});return{metaData:f("code",{classes:["binary_info","word-break-all"],children:[r,t,e]}),$decimal:r,$hex:t,$pointer:e}}function xn(){let r=f("span",{classes:["prefix"]}),t=f("span",{classes:["binary-head"]}),e=f("span",{classes:["suffix"]});return{binaryBits:f("code",{classes:["word-break-all"],children:[r,t,e]}),$prefix:r,$head:t,$suffix:e}}var Ut=class{constructor(t){this.root=t,this.cells=[]}initialize(t){let e=[],n=f("table");for(let s of t.keys()){let i=f("td");i.dataset.test=`B${s}`;let{metaData:o,$decimal:a,$hex:u,$pointer:p}=gn();i.append(o,f("br"));let{binaryBits:d,$prefix:E,$head:R,$suffix:K}=xn();i.append(d);let Y=f("tr",{children:[f("th",`B${s}`),i]});n.append(Y),e.push({$decimal:a,$hex:u,$pointer:p,$prefix:E,$head:R,$suffix:K})}this.root.innerHTML="",this.root.append(n),this.cells=e}clear(){this.cells=[],this.root.innerHTML=""}render(t,e,n,s,i){let o=0,a=this.cells;for(let u of t.values()){let{$prefix:p,$head:d,$suffix:E,$decimal:R,$hex:K,$pointer:Y}=a[o]??mn();if(e)p.innerHTML="",d.innerHTML="",E.innerHTML="";else if(n){let F=u.toObject();p.textContent=F.suffix.reverse().join(""),d.textContent=F.head.toString(),E.textContent=F.prefix.reverse().join("")}else{let F=u.toObject();p.textContent=F.prefix.join(""),d.textContent=F.head.toString(),E.textContent=F.suffix.join("")}s?R.textContent="value = "+u.toNumberString(10)+", ":R.innerHTML="",i?K.textContent="hex = "+u.toNumberString(16)+", ":K.innerHTML="",Y.textContent="pointer = "+u.pointer.toString(),o++}}};var Qe="stats_current_state";function bn(r,{z:t,nz:e}){let n=f("td",{fn:p=>{p.colSpan=2},children:[f("code",r)]}),s="num",i=f("td",{text:(t+e).toLocaleString(),classes:[s]}),o=f("td",{text:t.toLocaleString(),classes:[s]}),a=f("td",{text:e.toLocaleString(),classes:[s]});return{$tr:f("tr",{children:[n,i,o,a]}),$sum:i,$z:o,$nz:a}}var Ot=class{#r;constructor(t,e){this.root=t,this.#r=e,this.cells=[]}initialize(t,e){this.#r.textContent=e.length.toLocaleString(),this.cells=[],this.root.innerHTML="";for(let[n,s]of t.entries()){let i=e[n]??"",{$tr:o,$sum:a,$z:u,$nz:p}=bn(i,s);this.root.append(o),this.cells.push({$sum:a,$z:u,$nz:p,$tr:o})}}clear(){this.#r.innerHTML="",this.cells=[],this.root.innerHTML=""}render(t,e){let n=t,s=this.cells,i=s.length;for(let o=0;o<i;o++){let a=s[o]??tr();e===o?a.$tr.classList.add(Qe):a.$tr.classList.remove(Qe);let{z:u,nz:p}=n[o]??tr();a.$sum.textContent=(u+p).toLocaleString(),a.$z.textContent=u.toLocaleString(),a.$nz.textContent=p.toLocaleString()}}};function tr(){throw Error("error")}function er(r,t){if(r.innerHTML="",t===void 0)return;let e=f("option","None");e.value="-1",e.selected=!0,r.append(e);for(let[n,s]of t.getStateMap()){let i=f("option",n);i.value=s.toString(),r.append(i)}}function rr(r){switch(r.value){case"*":return-1;case"Z":return 0;default:return 1}}var yn="Start",Sn="Stop",nr="btn-primary",sr="btn-danger";function ir(r){return`<svg width="16" height="16" viewBox="0 0 16 16">${r}</svg>`}function En(){let r=f("div");return r.innerHTML=ir('<path stroke="currentColor" stroke-width="1" d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>')+yn,r}var Tn=En();function $n(){let r=f("div");return r.innerHTML=ir('<path stroke="currentColor" stroke-width="1" d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>')+Sn,r}var wn=$n();function ft(r){r.disabled=!1,r.replaceChildren(Tn),r.classList.add(nr),r.classList.remove(sr)}function or(r){r.disabled=!1,r.replaceChildren(wn),r.classList.remove(nr),r.classList.add(sr)}function ar(r,t,e){if(t==="RuntimeError"||t==="ParseError"){let n=e.split(`
`);r.replaceChildren();for(let s of n)r.append(f("span","- "+s),f("br"));r.classList.remove("d-none")}else r.classList.add("d-none")}function cr(r,t){if(t=t??"",r.value===t)return;r.value=t;let e=t.length,s=Math.min(6,Math.max(1,Math.ceil(e/40)));r.rows=s}function ur(r){return r?`
    ADD = ${r.add.toStringDetail()},
    SUB = ${r.sub.toStringDetail()},
    MUL = ${r.mul.toString()}
    `:""}function _n(){let r=[];for(let e=0;e<=6;e++)for(let n=1;n<=9;n++)r.push(n*10**e);return r.push(10*10**6,15*10**6),r}function pr(r,t){let e=_n();r.min="0",r.max=(e.length-1).toString(),r.addEventListener("input",()=>{let n=parseInt(r.value,10),s=e[n];if(s===void 0)throw Error("internal error");r.ariaValueText=`(${s.toString()}Hz)`,t.setFrequency(s)})}function fr(r,t){r.setCustomValidity(t),r.reportValidity(),r.classList.add("is-invalid")}function lr(r){r.setCustomValidity(""),r.reportValidity(),r.classList.remove("is-invalid")}function dr(r,t){r.addEventListener("input",()=>{let e=r.files?.item(0);e?.text().then(t)})}var Gt=window.requestIdleCallback??(r=>{setTimeout(()=>{r({didTimeout:!1,timeRemaining(){return 0}})},0)});function lt(r,t){try{localStorage.setItem(r,t)}catch{}}function dt(r){try{return localStorage.getItem(r)}catch{return null}}var vn=new Set(["textarea","input","summary","details","button","audio","video","select","option","a","area"]);function hr(){let r=document.activeElement?.tagName.toLowerCase()??"";return vn.has(r)}var mr=c("#error",HTMLElement),B=c("#input",HTMLTextAreaElement),gr=c("#output",HTMLTextAreaElement),xr=c("#steps",HTMLElement),w=c("#toggle",HTMLButtonElement),O=c("#reset",HTMLButtonElement),_=c("#step",HTMLButtonElement),be=c("#step-text",HTMLElement),br=c("#config_button",HTMLButtonElement),rt=c("#stats_button",HTMLButtonElement),yr=c("#current_state",HTMLElement),Sr=c("#previous_output",HTMLElement),Er=c("#frequency_input",HTMLInputElement),Tr=c("#frequency_output",HTMLElement),$r=c("#command",HTMLElement),zt=c("#canvas",HTMLCanvasElement),Vt=zt.getContext("2d")??(()=>{throw Error("context is null")})(),ht={x:c("#b2dx",HTMLElement),y:c("#b2dy",HTMLElement)},mt=c("#b2d_detail",HTMLDetailsElement),wr=c("#unary_register",HTMLElement),Yt=c("#unary_register_detail",HTMLDetailsElement),_r=c("#binary_register",HTMLElement),Zt=c("#binary_register_detail",HTMLDetailsElement),vr=c("#add_sub_mul",HTMLElement),Ir=c("#import_file",HTMLInputElement),Ft=c("#examples",HTMLButtonElement),Rr=document.querySelectorAll(".js_example"),ye=c("#config_modal_content",HTMLElement),gt=c("#step_input",HTMLInputElement),T={$hideBits:c("#hide_bits",HTMLInputElement),$reverseBits:c("#reverse_bits",HTMLInputElement),$showBinaryValueInDecimal:c("#show_binary_value_in_decimal",HTMLInputElement),$showBinaryValueInHex:c("#show_binary_value_in_hex",HTMLInputElement)},Se=c("#breakpoint_select",HTMLSelectElement),Br=c("#breakpoint_input_select",HTMLSelectElement),xt=c("#dark_mode",HTMLInputElement),Ee=c("#dark_mode_label",HTMLElement),jt=c("#b2d_hide_pointer",HTMLInputElement),bt=c("#b2d_flip_upside_down",HTMLInputElement),Pt=c("#stats_modal",HTMLElement),Nr=c("#stats_body",HTMLTableSectionElement),Cr=c("#stats_number_of_states",HTMLElement),Lr=c("#view-state-diagram",HTMLButtonElement);var nt=0,st=1,it=2,Te="A1",$e="B0",we="B1",Dr="ADD";function In(r){switch(r){case nt:return Te;case st:return $e;case it:return we}}function Rn(r){switch(r){case Te:return nt;case $e:return st;case we:return it}}var $=class extends h{constructor(t){super(),this.op=t}pretty(){return`${Dr} ${In(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Dr&&(s===Te||s===$e||s===we))return new $(Rn(s))}doesReturnValue(){switch(this.op){case nt:return!1;case st:return!0;case it:return!0}}isSameComponent(t){return t instanceof $}};var Ar="HALT_OUT",y=class extends h{constructor(){super()}pretty(){return Ar}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==1)return;let[n]=e;if(n===Ar)return new y}doesReturnValue(){return!1}isSameComponent(t){return t instanceof y}};var qt=0,Xt=1,_e="0",ve="1",Mr="MUL";function Bn(r){switch(r){case _e:return qt;case ve:return Xt}}function Nn(r){switch(r){case qt:return _e;case Xt:return ve}}var G=class extends h{constructor(t){super(),this.op=t}pretty(){return`${Mr} ${Nn(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Mr&&(s===_e||s===ve))return new G(Bn(s))}doesReturnValue(){return!0}isSameComponent(t){return t instanceof G}};var kr="NOP",N=class extends h{constructor(){super()}pretty(){return kr}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==1)return;let[n]=e;if(n===kr)return new N}doesReturnValue(){return!0}isSameComponent(t){return t instanceof N}};var Hr="OUTPUT",z=class extends h{constructor(t){super(),this.digit=t}pretty(){return`${Hr} ${this.digit}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Hr&&s!==void 0)return new z(s)}doesReturnValue(){return!1}isSameComponent(t){return t instanceof z}};var yt=0,St=1,Et=2,Ie="A1",Re="B0",Be="B1",Ur="SUB";function Cn(r){switch(r){case yt:return Ie;case St:return Re;case Et:return Be}}function Ln(r){switch(r){case Ie:return yt;case Re:return St;case Be:return Et}}var V=class extends h{constructor(t){super(),this.op=t}pretty(){return`${Ur} ${Cn(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Ur&&(s===Ie||s===Re||s===Be))return new V(Ln(s))}doesReturnValue(){switch(this.op){case yt:return!1;case St:return!0;case Et:return!0}}isSameComponent(t){return t instanceof V}};var Tt=0,$t=1,wt=2,_t=3,vt=4,Ne="INC",Ce="DEC",Le="READ",De="SET",Ae="RESET";function Dn(r){switch(r){case Tt:return Ne;case $t:return Ce;case wt:return Le;case _t:return De;case vt:return Ae}}function An(r){switch(r){case Ne:return Tt;case Ce:return $t;case Le:return wt;case De:return _t;case Ae:return vt}}var v=class extends h{constructor(t,e){super(),this.op=t,this.regNumber=e}pretty(){return`${Dn(this.op)} T${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===Ne||n===Ce||n===Le||n===De||n===Ae)&&s.startsWith("T")){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new v(An(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case Tt:return!0;case $t:return!0;case wt:return!0;case _t:return!1;case vt:return!1}}isSameComponent(t){return t instanceof v?this.regNumber===t.regNumber:!1}};var Wt=class{constructor(){this.value=0}action(t){switch(t.op){case st:{let e=this.value,n=e%2;return this.value=[0,0,0,0,0,0,9,9,0,0,9,9,9,9,9,9][e]??l(),n}case it:{let e=this.value,n=1-e%2;return this.value=[0,0,0,0,9,9,0,0,9,9,0,0,9,9,9,9][e]??l(),n}case nt:{this.value=[5,4,7,6,1,0,3,2,13,12,15,14,9,8,11,10][this.value]??l();return}default:l()}}getValue(){return this.value}a1(){this.action(new $(nt))}b0(){let t=this.action(new $(st));return t===void 0&&l(),t}b1(){let t=this.action(new $(it));return t===void 0&&l(),t}toString(){return this.value.toString(2).padStart(4,"0")}toStringDetail(){let t=this.toString();return`${t.slice(0,3)} bit${t.slice(3)}`}};var Kt=class{constructor(){this.value=0}action(t){switch(t.op){case qt:return this.mul0();case Xt:return this.mul1();default:throw Error("MUL: action")}}getValue(){return this.value}mul0(){let t=this.value%2;return this.value=this.value>>1,t}mul1(){let t=this.value%2;return this.value<=21?this.value=(this.value>>1)+5:this.value=this.value-22>>1,t}toString(){return this.value.toString(2).padStart(5,"0")}};var Jt=class{constructor(){}action(){return 0}};var Qt=class{constructor(){this.string=""}action(t){this.output(t.digit)}getString(){return this.string}output(t){this.string+=t}};var te=class{constructor(){this.value=0}action(t){switch(t.op){case St:return this.b0();case yt:return this.a1();case Et:return this.b1();default:l()}}getValue(){return this.value}a1(){let e=[3,2,-1,-1,7,6,-1,-1,11,10,-1,-1,15,14,-1,-1,19,18,-1,-1,23,22,-1,-1,27,26,-1,-1,31,30,-1,-1][this.value]??l();if(e===-1)throw Error("SUB error: A1");this.value=e}b0(){let t=this.value%2,e=[0,0,0,0,17,17,0,0,0,0,0,0,0,0,17,17,17,17,0,0,17,17,17,17,0,0,17,17,17,17,17,17];return this.value=e[this.value]??l(),t}b1(){let t=1-this.value%2,e=[17,17,0,0,0,0,0,0,0,0,17,17,0,0,0,0,17,17,17,17,17,17,0,0,17,17,17,17,0,0,17,17];return this.value=e[this.value]??l(),t}toString(){return this.value.toString(2).padStart(5,"0")}toStringDetail(){let t=this.toString();return t.slice(0,3)+" stopper"+t.slice(3,4)+" bit"+t.slice(4)}};var ee=class{constructor(){this.pointer=0,this.bits=[0]}action(t){switch(t.op){case Tt:return this.inc();case wt:return this.read();case $t:return this.dec();case _t:return this.set();case vt:return this.reset();default:l()}}getPointer(){return this.pointer}getBits(){return this.bits}inc(){return this.pointer===this.bits.length-1?(this.bits.push(0),this.pointer++,0):(this.pointer++,1)}dec(){return this.pointer===0?0:(this.pointer--,1)}read(){let t=this.pointer,e=this.bits[t];if(e===0)return this.bits[t]=-1,0;if(e===1)return this.bits[t]=-1,1;if(e===-1)throw Error("Error: reading empty space of T register");l()}set(){if(this.bits[this.pointer]===-1)this.bits[this.pointer]=1;else throw Error("Error: SET to nonempty bit")}reset(){if(this.bits[this.pointer]===-1)this.bits[this.pointer]=0;else throw Error("Error: RESET to nonempty bit")}};function It(r,t){throw Error(`Register ${r}${t} is not found.`)}var re=class{constructor({unaryRegisterNumbers:t,binaryRegisterNumbers:e,legacyTRegisterNumbers:n}){this.uRegMap=new Map(t.map(s=>[s,new Mt])),this.bRegMap=new Map(e.map(s=>[s,new Ht])),this.legecyTRegMap=new Map(n.map(s=>[s,new ee])),this.add=new Wt,this.sub=new te,this.mul=new Kt,this.b2d=new At,this.output=new Qt,this.nop=new Jt}setByRegistersInit(t){for(let[e,n]of Object.entries(t))this.setKeyValue(e,n)}setCache(t){t instanceof m?t.registerCache=this.getBReg(t.regNumber):t instanceof g&&(t.registerCache=this.getUReg(t.regNumber))}setKeyValue(t,e){if(t.startsWith("U")){let n=parseInt(t.slice(1),10);isNaN(n)&&Me(t,e);let s=this.getUReg(n);if(s===void 0)throw Error(`Invalid #REGISTERS: U${n} isn't used in the program`);s.setByRegistersInit(t,e)}else if(t.startsWith("B")){let n=parseInt(t.slice(1),10);isNaN(n)&&Me(t,e);let s=this.getBReg(n);if(s===void 0)throw Error(`Invalid #REGISTERS: B${n} isn't used in the program`);s.setByRegistersInit(t,e)}else Me(t,e)}execAction(t){if(t instanceof m)return(t.registerCache??this.bRegMap.get(t.regNumber)??It("B",t.regNumber)).action(t);if(t instanceof g)return(t.registerCache??this.uRegMap.get(t.regNumber)??It("U",t.regNumber)).action(t);if(t instanceof $)return this.add.action(t);if(t instanceof N)return this.nop.action();if(t instanceof V)return this.sub.action(t);if(t instanceof G)return this.mul.action(t);if(t instanceof S)return this.b2d.action(t);if(t instanceof z)return this.output.action(t);if(t instanceof y)return-1;if(t instanceof v)return(this.legecyTRegMap.get(t.regNumber)??It("T",t.regNumber)).action(t);throw Error(`execAction: unknown action ${t.pretty()}`)}execActionN(t,e){if(t instanceof g)return(t.registerCache??this.uRegMap.get(t.regNumber)??It("U",t.regNumber)).actionN(t,e);if(t instanceof m)return(t.registerCache??this.bRegMap.get(t.regNumber)??It("B",t.regNumber)).actionN(t,e);if(t instanceof y)return-1;throw Error(`execActionN: ${t.pretty()}`)}getUReg(t){return this.uRegMap.get(t)}getBReg(t){return this.bRegMap.get(t)}};function Me(r,t){let e=`"${r}": ${JSON.stringify(t)}`;throw Error(`Invalid #REGISTERS ${e}`)}function ke(r){let t=[m.parse,g.parse,S.parse,N.parse,$.parse,G.parse,V.parse,z.parse,y.parse,v.parse];for(let e of t){let n=e(r);if(n!==void 0)return n}}var Rt="INITIAL",X=class{pretty(){return"unimplemented"}},C=class extends X{constructor(t){super(),this.content=t}static get key(){return"#COMPONENTS"}pretty(){return C.key+" "+this.content}},L=class extends X{constructor(t){super(),this.content=t}static get key(){return"#REGISTERS"}pretty(){return L.key+" "+this.content}},He=class extends X{constructor(t){super(),this.str=t}getString(){return this.str}pretty(){return this.getString()}},Ue=class extends X{constructor(){super()}pretty(){return""}};function Mn(r){switch(r){case"Z":return r;case"NZ":return r;case"ZZ":return r;case"*":return r;default:return}}var at=class extends X{constructor({state:t,input:e,nextState:n,actions:s,line:i}){super(),this.state=t,this.input=e,this.nextState=n,this.actions=s,this.line=i,this._string=`${this.state}; ${this.input}; ${this.nextState}; ${this.actions.map(o=>o.pretty()).join(", ")}`}pretty(){return this._string}};function ne(){throw Error("internal error")}function Or(r,t){let e=r.trim();if(e==="")return new Ue;if(e.startsWith("#"))return e.startsWith(C.key)?new C(e.slice(C.key.length).trim()):e.startsWith(L.key)?new L(e.slice(L.key.length).trim()):new He(r);let n=e.split(/\s*;\s*/u);if(n.length<4)return`Invalid line "${r}"${ot(t)}`;if(n.length>4)return n[4]===""?`Extraneous semicolon "${r}"${ot(t)}`:`Invalid line "${r}"${ot(t)}`;let s=n[0]??ne(),i=n[1]??ne(),o=n[2]??ne(),u=(n[3]??ne()).trim().split(/\s*,\s*/u).filter(E=>E!==""),p=[];for(let E of u){let R=ke(E);if(R===void 0)return`Unknown action "${E}" in "${r}"${ot(t)}`;p.push(R)}let d=Mn(i);return d===void 0?`Unknown input "${i}" in "${r}"${ot(t)}. Expect "Z", "NZ", "ZZ" or "*"`:new at({state:s,input:d,nextState:o,actions:p,line:t})}function ot(r){return r!=null?` at line ${r}`:""}function b(r){return ot(r.line)}function Gr(r){let t=r.actions;if(t.some(n=>n instanceof y))return;let e=t.filter(n=>n.doesReturnValue());if(e.length!==1)return e.length===0?`Does not produce the return value in "${r.pretty()}"${b(r)}`:`Does not contain exactly one action that produces a return value in "${r.pretty()}": Actions that produce value are ${e.map(n=>`"${n.pretty()}"`).join(", ")}${b(r)}`}function zr(r){if(r.nextState===Rt)return`Return to initial state in "${r.pretty()}"${b(r)}`}function Vr(r){let t=r.actions;if(t.length<=1)return;let e=t.map(n=>n.pretty());e.sort();for(let n=0;n<e.length-1;n++){let s=e[n],i=e[n+1];if(s===i)return`Duplicated actions "${s}" in "${r.pretty()}"${b(r)}`}}function Yr(){throw Error("internal error")}function Zr(r){if(r.actions.find(n=>n instanceof y)!==void 0)return;let t=r.actions,e=t.length;if(!(e<=1))for(let n=0;n<e;n++)for(let s=n+1;s<e;s++){let i=t[n]??Yr(),o=t[s]??Yr();if(i.isSameComponent(o))return`Actions "${i.pretty()}" and "${o.pretty()}" use same component in "${r.pretty()}"${b(r)}`}}function Fr(){throw Error("internal error")}function kn(r,t){return r.line!==void 0&&t?.line!==void 0?` at line ${r.line} and ${t.line}`:""}function jr(r){let t=(s,i)=>`Need Z line followed by NZ line in "${s.pretty()}"${kn(s,i)}`,e=r.length-1;for(let s=0;s<e;s++){let i=r[s]??Fr(),o=r[s+1]??Fr(),a=i.input,u=o.input;if(a==="Z"&&u!=="NZ")return[t(i,o)];if(u==="NZ"&&a!=="Z")return[t(i,o)];if(a==="Z"&&u==="NZ"&&i.state!==o.state)return[t(i,o)]}let n=r[r.length-1];if(n!==void 0&&n.input==="Z")return[t(n)]}var ct=class{constructor(t){this.array=t}getArray(){return this.array}pretty(){return this.array.map(t=>t.pretty()).join(`
`)}static parse(t){let n=t.split(/\r\n|\n|\r/u).map((o,a)=>Or(o,a+1)),s=n.flatMap(o=>typeof o=="string"?[o]:[]);if(s.length>0)return s.join(`
`);let i=n.flatMap(o=>typeof o!="string"?[o]:[]);return new ct(i)}};function Pr(r){let t=[],e=[Vr,Gr,Zr,zr];for(let s of r)for(let i of e){let o=i(s);typeof o=="string"&&t.push(o)}let n=[jr];for(let s of n){let i=s(r);i!==void 0&&(t=t.concat(i))}if(t.length>0)return t.join(`
`)}var Z=class{constructor({programLines:t}){let e=t.getArray();this.commands=e.flatMap(n=>n instanceof at?[n]:[]),this.componentsHeader=void 0;for(let n of e)if(n instanceof C){if(this.componentsHeader!==void 0)throw Error(`Multiple ${C.key}`);this.componentsHeader=n}this.registersHeader=void 0;for(let n of e)if(n instanceof L){if(this.registersHeader!==void 0)throw Error(`Multiple ${L.key}`);this.registersHeader=n}this.programLines=t}static parse(t){let e=ct.parse(t);if(typeof e=="string")return e;let n=[];for(let i of e.getArray())i instanceof at&&n.push(i);if(n.length===0)return"Program is empty";let s=Pr(n);if(typeof s=="string")return s;try{return new Z({programLines:e})}catch(i){return i instanceof Error?i.message:"Unknown error is occurred."}}extractRegisterNumbers(){let t=this.commands.flatMap(n=>n.actions),e=n=>Hn(t.flatMap(s=>s instanceof n?[s.regNumber]:[]));return{unary:e(g),binary:e(m),legacyT:e(v)}}pretty(){return this.programLines.pretty()}};function Hn(r){return[...new Set(r)].sort((t,e)=>t-e)}function Un(r){return r instanceof m&&r.op===H}function On(r){return r instanceof g&&r.op===k}function Gn(r){if(r.input==="NZ"&&r.state===r.nextState&&r.actions.every(t=>!(t instanceof y))&&r.actions.every(t=>t instanceof g||Un(t))){let t=r.actions.find(On);if(t&&t instanceof g)return{tdecU:t}}}function zn(r){if(r.input==="NZ"&&r.state===r.nextState&&r.actions.every(t=>!(t instanceof y))&&r.actions.length===1&&r.actions.every(t=>t instanceof m)){let t=r.actions.find(e=>e instanceof m&&e.op===U);if(t&&t instanceof m)return{tdecB:t}}}var ut=class{constructor(t,e){this.command=t,this.nextState=e,this.tdecuOptimize=Gn(t),this.tdecbOptimize=zn(t)}},Ge=class{constructor(t,e){this.z=t,this.nz=e}};function Oe(r,t){throw Error(`Duplicated command: "${r.pretty()}" and "${t.pretty()}"${b(t)}`)}function qr(r){let t=new Map,e=[],n=()=>{throw Error("commandsToLookupTable internal error")};for(let s of r)t.has(s.state)||(t.set(s.state,t.size),e.push(new Ge(void 0,void 0)));for(let s of r){let i=e[t.get(s.state)??n()]??n(),o=t.get(s.nextState);if(o===void 0)throw Error(`Unknown state: "${s.nextState}" at "${s.pretty()}"${b(s)}`);switch(s.input){case"Z":{i.z===void 0?i.z=new ut(s,o):Oe(i.z.command,s);break}case"NZ":{i.nz===void 0?i.nz=new ut(s,o):Oe(i.nz.command,s);break}case"ZZ":{if(i.nz!==void 0)throw Error(`Invalid input: ZZ with NZ or *: "${s.pretty()}" and "${i.nz.command.pretty()}"${b(s)}`);i.z===void 0?i.z=new ut(s,o):Oe(i.z.command,s);break}case"*":{if(i.nz!==void 0)throw Error(`Invalid input: * "${s.pretty()}" and "${i.nz.command.pretty()}"${b(s)}`);if(i.z!==void 0)throw Error(`Invalid input: * "${s.pretty()}" and "${i.z.command.pretty()}"${b(s)}`);{let a=new ut(s,o);i.z=a,i.nz=a}break}default:{let a=s.input;n()}}}return{states:[...t.keys()],stateMap:t,lookup:e}}function I(r="error"){throw Error(r)}var W=class{constructor(t){if(!(t instanceof Z))throw TypeError("program is not a Program");this.stepCount=0;let e=t.extractRegisterNumbers();this.actionExecutor=new re({binaryRegisterNumbers:e.binary,unaryRegisterNumbers:e.unary,legacyTRegisterNumbers:e.legacyT}),this.prevOutput=0,this.program=t;let{states:n,stateMap:s,lookup:i}=qr(t.commands);this.states=n,this.stateMap=s,this.lookup=i;for(let a of i){let u=(a.z?.command.actions??[]).concat(a.nz?.command.actions??[]);for(let p of u)this.actionExecutor.setCache(p)}this.currentStateIndex=s.get(Rt)??I(`${Rt} state is not present`),this.initialIndex=this.currentStateIndex,this.stateStatsArray=Array(i.length*2).fill(0).map(()=>0);let o=t.registersHeader;o&&this.#r(o)}static fromString(t){let e=Z.parse(t);if(typeof e=="string")throw Error(e);return new W(e)}getStateStats(){let t=this.stateStatsArray,e=t.length,n=[];for(let s=0;s<e;s+=2)n.push({z:t[s]??I(),nz:t[s+1]??I()});return n}#r(t){let e=t.content.replace(/'/ug,'"'),n={};try{n=JSON.parse(e)}catch{I(`Invalid #REGISTERS: is not a valid JSON: "${e}"`)}(n===null||typeof n!="object")&&I(`Invalid #REGISTERS: "${e}" is not an object`),this.actionExecutor.setByRegistersInit(n)}getCurrentState(){let t=this.states[this.currentStateIndex];return t===void 0&&I("State name is not found"),t}getStateMap(){return this.stateMap}getPreviousOutput(){return this.prevOutput===0?"Z":"NZ"}log(){let t=this.currentStateIndex,e=this.prevOutput;this.stateStatsArray[t*2+e]++}getNextCommand(){let t=this.currentStateIndex,e=this.lookup[t];if(e===void 0&&I(`Internal Error: Next command is not found: Current state index: ${t}`),this.prevOutput===0){let s=e.z;if(s!==void 0)return s}else{let s=e.nz;if(s!==void 0)return s}I("Next command is not found: Current state = "+this.getCurrentState()+", output = "+this.getPreviousOutput())}_internalExecActionN(t,e){try{let n=this.actionExecutor;for(let s of t.actions)n.execActionN(s,e)}catch(n){if(n instanceof Error)this.throwError(n);else throw n}this.stateStatsArray[this.currentStateIndex*2+this.prevOutput]+=e,this.stepCount+=e}exec(t,e,n,s){let i=n!==-1,o=performance.now();for(let a=0;a<t;a++){let u=this.getNextCommand();if(u.tdecuOptimize){let d=u.tdecuOptimize.tdecU.registerCache?.getValue();if(d!==void 0&&d!==0){d=Math.min(d,t-a),this._internalExecActionN(u.command,d),a+=d-1;continue}}else if(u.tdecbOptimize){let d=u.tdecbOptimize.tdecB.registerCache?.pointer;if(d!==void 0&&d!==0){d=Math.min(d,t-a),this._internalExecActionN(u.command,d),a+=d-1;continue}}try{if(this.execCommandFor(u)===-1)return"Halted"}catch(p){if(p instanceof Error)this.throwError(p);else throw p}if(i&&this.currentStateIndex===n&&(s===-1||s===this.prevOutput))return"Stop";if(e&&(a+1)%5e5===0&&performance.now()-o>=50)return}}throwError(t){let e=this.getNextCommand().command,n=b(e);I(t.message+` in "${e.pretty()}"`+n)}execCommandFor(t){this.stepCount+=1,this.log();let e=-1,n=this.actionExecutor,s=t.command;for(let o of s.actions){let a=n.execAction(o);if(a===-1)return-1;a!==void 0&&(e===-1?e=a:I(`Return value twice: line = ${s.pretty()}${b(s)}`))}e===-1&&I(`No return value: line = ${s.pretty()}${b(s)}`);let i=t.nextState;this.currentStateIndex=i,this.prevOutput=e}execCommand(){return this.execCommandFor(this.getNextCommand())}};var Vn=30,se=class{#r;#n="";#t;#c;#o=new kt(wr);#a=new Ut(_r);#i=new Ot(Nr,Cr);#s;#e="Initial";constructor(){this.stepConfig=1,this.#s=new Nt({frequency:Vn});let t=this;this.#s.addEventListener("emit",function(n){n instanceof pt&&t.run(n.value)})}setFrequency(t){this.#s.frequency=t,this.#u()}start(){switch(this.#e){case"Initial":{this.reset()&&(this.#e="Running");break}case"Stop":{this.#e="Running";break}default:throw Error("start: unreachable")}this.render()}stop(){this.#e="Stop",this.render()}#p(){this.#t===void 0?this.#o.clear():this.#o.initialize(this.#t.actionExecutor.uRegMap)}#f(){this.#t===void 0?this.#a.clear():this.#a.initialize(this.#t.actionExecutor.bRegMap)}#l(){this.#p(),this.#f(),this.#m(),er(Se,this.#t)}setInputAndReset(t){B.value=t,this.reset()}toggle(){this.#e==="Running"?this.stop():this.start()}doStep(){if(this.#e==="Running"&&this.stop(),this.stepConfig>=5e6){let t=Ye();t.style.position="absolute",_.append(t),be.style.color="transparent",_.disabled=!0,O.disabled=!0,w.disabled=!0,setTimeout(()=>{try{this.run(this.stepConfig)}finally{be.style.color="",t.remove()}},33)}else this.run(this.stepConfig)}reset(){this.#n="",this.#t=void 0,this.#s.reset();try{this.#t=W.fromString(B.value),this.#l(),this.#e="Stop"}catch(t){return this.#e="ParseError",this.#n=oe(t),this.render(),!1}return this.render(),!0}#u(){let t=this.#s.frequency;this.#c!==t&&(Tr.textContent=t.toLocaleString()),this.#c=t}#d(){try{let t=this.#t?.getNextCommand();$r.textContent=t?.command.pretty()??""}catch(t){console.error(t)}}renderB2D(){if(!mt.open)return;let t=this.#t;if(t===void 0){ht.x.textContent="0",ht.y.textContent="0",Vt.clearRect(0,0,zt.width,zt.height),Vt.resetTransform();return}let e=t.actionExecutor.b2d;ht.x.textContent=e.x.toString(),ht.y.textContent=e.y.toString();let n=performance.now();Xe(Vt,e,jt.checked,bt.checked),this.#e==="Running"&&performance.now()-n>=200&&(mt.open=!1)}renderUnary(){this.#t!==void 0&&Yt.open&&this.#o.render(this.#t.actionExecutor.uRegMap)}renderBinary(){this.#t!==void 0&&Zt.open&&this.#a.render(this.#t.actionExecutor.bRegMap,T.$hideBits.checked,T.$reverseBits.checked,T.$showBinaryValueInDecimal.checked,T.$showBinaryValueInHex.checked)}#h(){let t=this.#t?.actionExecutor.output.getString();cr(gr,t)}#m(){this.#t===void 0?this.#i.clear():this.#i.initialize(this.#t.getStateStats(),this.#t.states)}renderStats(){if(!!Pt.classList.contains("show")){if(this.#t===void 0){this.#i.clear();return}this.#i.render(this.#t.getStateStats(),this.#t.currentStateIndex)}}#g(){switch(this.#e){case"Initial":{ft(w),_.disabled=!1,O.disabled=!1,rt.disabled=!0;break}case"Stop":{ft(w),_.disabled=!1,O.disabled=!1,rt.disabled=!1;break}case"Running":{or(w),_.disabled=!0,O.disabled=!0,rt.disabled=!1;break}case"RuntimeError":case"ParseError":{ft(w),w.disabled=!0,_.disabled=!0,O.disabled=!1,rt.disabled=!0;break}case"Halted":{ft(w),w.disabled=!0,_.disabled=!0,O.disabled=!1,rt.disabled=!1;break}}}render(){let t=this.#e;this.#s.disabled=t!=="Running",(this.#r!==t||t==="Stop")&&(this.#g(),t==="ParseError"?B.classList.add("is-invalid"):B.classList.remove("is-invalid")),ar(mr,t,this.#n),this.#u();let e=this.#t;yr.textContent=e?.getCurrentState()??"",Sr.textContent=e?.getPreviousOutput()??"",xr.textContent=e?.stepCount.toLocaleString()??"",this.#d(),this.#h(),this.renderUnary(),this.renderBinary(),vr.textContent=ur(e?.actionExecutor),this.renderB2D(),this.renderStats(),this.#r=t}run(t){let e=this.#e;switch(e){case"Initial":if(!this.reset())return}if(t<=0||isNaN(t))return;let n=this.#t;if(n===void 0)return;let s=e==="Running",i=parseInt(Se.value,10),o=rr(Br);try{let a=n.exec(t,s,i,o);a!==void 0&&(this.#e=a)}catch(a){this.#e="RuntimeError",this.#n=oe(a)}finally{this.render()}}};var Yn="./frontend/data/",x=new se;O.addEventListener("click",()=>{x.reset()});w.addEventListener("click",()=>{x.toggle()});_.addEventListener("click",()=>{x.doStep()});Rr.forEach(r=>{r.addEventListener("click",async()=>{Ft.style.opacity="0.5";let t=r.dataset.src;try{let e=await fetch(Yn+t);if(!e.ok)throw"error";x.setInputAndReset(await e.text()),ze()}catch{console.error(`Fetch: ${t}`)}finally{Ft.style.opacity="1"}})});pr(Er,x);mt.addEventListener("toggle",()=>{x.renderB2D()});Zt.addEventListener("toggle",()=>{x.renderBinary()});Yt.addEventListener("toggle",()=>{x.renderUnary()});var ze=()=>{B.scrollTop=0};dr(Ir,r=>{x.setInputAndReset(r),ze()});gt.addEventListener("input",()=>{let r=Number(gt.value);isNaN(r)||r<=0||!Number.isInteger(r)?(fr(gt,"Enter a positive integer"),x.stepConfig=1):(lr(gt),x.stepConfig=r)});function Bt(r,t){r.addEventListener("change",()=>{x.render(),lt(t,r.checked.toString())})}var Xr="hide_binary";Bt(T.$hideBits,Xr);var Wr="reverse_binary";Bt(T.$reverseBits,Wr);var ie="show_binary_in_decimal";Bt(T.$showBinaryValueInDecimal,ie);var Kr="show_binary_in_hex";Bt(T.$showBinaryValueInHex,Kr);jt.addEventListener("change",()=>{x.renderB2D()});var Jr="b2d_flip_upside_down";Bt(bt,Jr);Pt.addEventListener("shown.bs.modal",()=>{x.renderStats()});Lr.addEventListener("click",()=>{B.value.length>=10**6||(lt("state-diagram-input",B.value),window.open("./labs/diagram/index.html",void 0,"noreferrer=yes,noopener=yes"))});var Qr="dark_mode";xt.addEventListener("change",()=>{let r=xt.checked?"on":"off";lt(Qr,r),document.body.setAttribute("apge_dark",r),Ee.textContent=xt.checked?"On":"Off";let t="animate-color-and-background-color";document.body.classList.add(t),ye.classList.add(t),setTimeout(()=>{document.body.classList.remove(t),ye.classList.remove(t)},500)});document.addEventListener("keydown",r=>{if(!(hr()||r.isComposing))switch(r.code){case"Enter":{x.toggle();break}case"Space":{_.disabled||(r.preventDefault(),x.doStep());break}}});B.addEventListener("drop",async r=>{r.preventDefault();let t=r.dataTransfer?.files.item(0);t!=null&&(x.setInputAndReset(await t.text()),ze())});Ft.disabled=!1;br.disabled=!1;x.render();Gt(()=>{let r="initial_code",t=dt(r);t!==null&&(localStorage.removeItem(r),x.setInputAndReset(t))});Gt(()=>{dt(ie)===null&&lt(ie,"true");let r=[{key:Jr,checkbox:bt},{key:Wr,checkbox:T.$reverseBits},{key:Xr,checkbox:T.$hideBits},{key:ie,checkbox:T.$showBinaryValueInDecimal},{key:Kr,checkbox:T.$showBinaryValueInHex}];for(let{key:t,checkbox:e}of r)dt(t)==="true"&&(e.checked=!0);dt(Qr)==="on"&&(document.body.setAttribute("apge_dark","on"),xt.checked=!0,Ee.textContent="On"),x.render()});"serviceWorker"in navigator&&Gt(async()=>{(await navigator.serviceWorker.getRegistrations()).map(t=>t.unregister())});
