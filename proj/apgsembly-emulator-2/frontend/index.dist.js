var c=(r,t)=>{let e=document.querySelector(r);if(e==null)throw Error(`can't found a element for "${r}"`);if(e instanceof t)return e;throw Error(`"${r}" is not a ${t.name}`)};function f(r,t=void 0){let e=document.createElement(r);if(typeof t=="string")e.textContent=t;else if(t!=null&&typeof t=="object"&&(t.text&&(e.textContent=t.text),t.classes&&e.classList.add(...t.classes),t.fn&&(t.fn(e),t.fn=void 0),t.children&&e.append(...t.children),t.style))for(let[n,s]of Object.entries(t.style))n in e.style?e.style[n]=s:e.style.setProperty(n,s);return e}var At=class{#e=0;#n=-1;constructor(t,{frequency:e,signal:n}){this._frequency=e,this._enabled=!1,this._id=0;let s=requestAnimationFrame,i=o=>{if(this._enabled&&this.#n!==-1){let a=o-this.#n,u=this.#e,p=u+a/1e3*this._frequency,l=Math.floor(p)-Math.floor(u);this.#e=p,t(l)}this.#n=o,this._id=s(i)};this._id=s(i),n?.addEventListener("abort",()=>{this.abort()})}abort(){this._id!==0&&cancelAnimationFrame(this._id)}get frequency(){return this._frequency}set frequency(t){this._frequency=t}get disabled(){return!this._enabled}set disabled(t){this._enabled=!t}reset(){this.#e=0}};var le=r=>r instanceof Error?r.message:"Unknown error is occurred.";function*Je(r,t){if(!Number.isInteger(t))throw RangeError("size is not an integer");let e=[];for(let n of r)e.push(n),t<=e.length&&(yield e,e=[]);e.length!==0&&(yield e)}var Qe=()=>{let r=document.createElement("span");return r.classList.add("spinner-border","spinner-border-sm"),r.setAttribute("role","status"),r.setAttribute("aria-hidden","true"),r};var d=()=>{throw Error("internal error")},m=class{pretty(){return""}doesReturnValue(){return!1}isSameComponent(t){return!0}};var Lt="INC",me="TDEC",Mt="READ",kt="SET",he="B2DX",ge="B2DY",xe="B2D",dn="DEC",tr="SQX",er="SQY",rr="SQ";function nr(r){switch(r){case Lt:return 0;case me:return 1;case Mt:return 2;case kt:return 3}}function ln(r){switch(r){case 0:return Lt;case 1:return me;case 2:return Mt;case 3:return kt}}function sr(r){switch(r){case he:return 4;case ge:return 5;case xe:return 6}}function mn(r){switch(r){case 4:return he;case 5:return ge;case 6:return xe}}var S=class extends m{constructor(t,e){super(),this.op=t,this.axis=e}pretty(){return`${ln(this.op)} ${mn(this.axis)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)){if(n===Lt||n===me){if(s===he||s===ge)return new S(nr(n),sr(s))}else if((n===Mt||n===kt)&&s===xe)return new S(nr(n),sr(s));switch(n){case Lt:switch(s){case tr:return new S(0,4);case er:return new S(0,5);default:return}case dn:switch(s){case tr:return new S(1,4);case er:return new S(1,5);default:return}case Mt:switch(s){case rr:return new S(2,6);default:return}case kt:switch(s){case rr:return new S(3,6);default:return}}}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0;case 3:return!1}}isSameComponent(t){if(t instanceof S){let e=this.axis,n=t.axis;return e===4&&n===5?!1:!(e===5&&n===4)}return!1}};function be(r,t){let e=[];for(let n=0;n<r;n++)e.push(t(n));return e}var Ut=class{constructor(t=0,e=0){if(t<0||e<0)throw RangeError("B2D constructor: negative");this.x=t,this.y=e,this.maxX=t,this.maxY=e,this.array=be(this.maxY+1,()=>be(this.maxX+1,()=>0))}getArray(){return this.array}getMaxX(){return this.maxX}getMaxY(){return this.maxY}action(t){switch(t.op){case 0:{switch(t.axis){case 4:return this.incB2DX();case 5:return this.incB2DY();case 6:d()}break}case 1:{switch(t.axis){case 4:return this.tdecB2DX();case 5:return this.tdecB2DY();case 6:d()}break}case 2:{switch(t.axis){case 6:return this.read();default:d()}break}case 3:{switch(t.axis){case 6:return this.set();default:d()}break}default:d()}}incB2DX(){if(this.x++,this.maxX<this.x){for(let t of this.array)t.push(0);this.maxX=this.x}}incB2DY(){this.y++,this.maxY<this.y&&(this.array.push(be(this.maxX+1,()=>0)),this.maxY=this.y)}tdecB2DX(){return this.x===0?0:(this.x--,1)}tdecB2DY(){return this.y===0?0:(this.y--,1)}read(){let t=this.array[this.y];t===void 0&&d();let e=t[this.x];return e===void 0&&d(),t[this.x]=0,e}set(){let t=this.array[this.y];if(t===void 0&&d(),t[this.x]===1)throw Error(`SET B2D: Tried to set when it was already 1. x = ${this.x}, y = ${this.y}`);t[this.x]=1}};var ir=(r,t,e,n)=>{let s=r.canvas.width,i=r.canvas.height;s!==i&&(r.canvas.height=s),r.clearRect(0,0,s,s),r.resetTransform(),r.beginPath();let o=t.getMaxX(),a=t.getMaxY(),u=Math.max(o,a)+1,p=s/u;n&&(r.scale(1,-1),r.translate(0,-s));let l=t.getArray();r.fillStyle="#212529";for(let _=0;_<=a;_++){let v=l[_];if(v===void 0)throw Error("renderB2D: internal error");let J=_*p;for(let Z=0;Z<=o;Z++)v[Z]===1&&r.rect(Z*p,J,p,p)}r.fill(),e||(r.strokeStyle="#03A9F4",r.lineWidth=4,r.strokeRect(t.x*p,t.y*p,p,p))};var ye="INC",Se="TDEC",or="U",hn="R";function gn(r){switch(r){case 0:return ye;case 1:return Se}}function xn(r){switch(r){case ye:return 0;case Se:return 1}}var x=class extends m{constructor(t,e){super(),this.op=t,this.regNumber=e,this.registerCache=void 0}pretty(){return`${gn(this.op)} ${or}${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===ye||n===Se)&&(s.startsWith(or)||s.startsWith(hn))){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new x(xn(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0}}isSameComponent(t){return t instanceof x?this.regNumber===t.regNumber:!1}};var Ht=class{constructor(){this.value=0}action(t){switch(t.op){case 1:return this.value===0?0:(this.value--,1);case 0:this.value++}}actionN(t,e){switch(t.op){case 1:{this.value-=e;break}case 0:{this.value+=e;break}}}getValue(){return this.value}setValue(t){this.value=t}inc(){this.action(new x(0,0))}tdec(){let t=this.action(new x(1,0));return t===void 0&&d(),t}setByRegistersInit(t,e){(typeof e!="number"||e<0||!Number.isInteger(e))&&bn(t,e),this.setValue(e)}};function bn(r,t){let e=`"${r}": ${JSON.stringify(t)}`;throw Error(`Invalid #REGISTERS ${e}`)}var yn=r=>{if(window.innerWidth<768)return 8+1===r?r:8;let e=12;return e+1<=r&&r<=e+2?r:e},Sn=r=>f("th",`U${r}`),En=(r,t)=>f("td",{text:t.getValue().toString(),fn:e=>{e.dataset.test=`U${r}`}}),_n=r=>{let t=[],e=[],n=yn(r.size);for(let i of Je(r,n)){let o=f("tr"),a=f("tr");for(let[u,p]of i){o.append(Sn(u));let l=En(u,p);t.push(l),a.append(l)}e.push({header:o,data:a})}let s=f("table");for(let i of e)s.append(i.header,i.data);return s.classList.add("table"),s.style.tableLayout="fixed",s.style.marginBottom="0",{table:s,cells:t}},zt=class{constructor(t){this.root=t,this.cells=[]}initialize(t){let{table:e,cells:n}=_n(t);this.root.replaceChildren(e),this.cells=n}clear(){this.cells=[],this.root.innerHTML=""}render(t){let e=0,n=this.cells;for(let s of t.values()){let i=n[e];if(i===void 0)throw Error("internal error");i.textContent=s.getValue().toString(),e++}}};var Ee="INC",_e="TDEC",$e="READ",Te="SET",ar="B";function $n(r){switch(r){case 0:return Ee;case 1:return _e;case 2:return $e;case 3:return Te}}function Tn(r){switch(r){case Ee:return 0;case _e:return 1;case $e:return 2;case Te:return 3}}var h=class extends m{constructor(t,e){super(),this.op=t,this.regNumber=e,this.registerCache=void 0}pretty(){return`${$n(this.op)} ${ar}${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===Ee||n===_e||n===$e||n===Te)&&s.startsWith(ar)){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new h(Tn(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0;case 3:return!1}}isSameComponent(t){return t instanceof h?this.regNumber===t.regNumber:!1}};function cr(r){return[...r].map(t=>{if(t==="0")return 0;if(t==="1")return 1;throw Error(`Invalid #REGISTERS: "${r}"`)})}var wn=typeof BigInt<"u";function Ot(r){let t="";for(let e=r.length-1;e>=0;e--)t+=r[e]===0?"0":"1";return t}function we(r){let t="",e=r.length;for(let n=0;n<e;n++)t+=r[n]===0?"0":"1";return t}var Gt=class{constructor(){this.pointer=0,this.bits=[0]}action(t){switch(t.op){case 1:return this.pointer===0?0:(this.pointer--,1);case 0:{this.pointer++;let e=this.bits;this.pointer===e.length&&e.push(0);break}case 2:{let e=this.pointer,n=this.bits;if(e<n.length){let s=n[e]??d();return n[e]=0,s}else return 0}case 3:{let e=this.bits,n=this.pointer;if(n>=e.length&&this.extend(),e[n]===1)throw Error(`The bit of the binary register B${t.regNumber} is already 1`);e[n]=1;break}default:throw Error("BReg action: "+t.op)}}actionN(t,e){switch(t.op){case 0:{this.pointer+=e,this.extend();break}case 1:{this.pointer-=e;break}default:throw Error("todo")}}getBits(){return this.bits}setBits(t){this.bits=t}inc(){let t=this.action(new h(0,0));return t!==void 0&&d(),t}tdec(){let t=this.action(new h(1,0));return t===void 0&&d(),t}read(){let t=this.action(new h(2,0));return t===void 0&&d(),t}set(){let t=this.action(new h(3,0));return t!==void 0&&d(),t}extend(){let t=this.pointer,e=this.bits,n=e.length;if(t>=n)if(t===n)e.push(0);else{let s=Array(t-n+1).fill(0).map(()=>0);this.bits=this.bits.concat(s)}}toNumberString(t=10){return(wn?BigInt:Number)("0b"+Ot(this.bits)).toString(t)}toObject(){this.extend();let t=this.bits,e=this.pointer;return{prefix:t.slice(0,e),head:t[e]??d(),suffix:t.slice(e+1)}}setByRegistersInit(t,e){let n=i=>{throw Error(`Invalid #REGISTERS ${i}`)},s=`"${t}": ${JSON.stringify(e)}`;if(typeof e=="number")this.setBits(cr(e.toString(2)).reverse()),this.extend();else if(!Array.isArray(e)||e.length!==2)n(s);else{let i=e[0],o=e[1];if(typeof i!="number"||typeof o!="string")n(s);else if(i<0||!Number.isInteger(i))n(s);else{let a=cr(o);this.pointer=i,this.setBits(a),this.extend()}}}};var Bn=()=>{throw Error("error")},In=()=>{let r=f("span",{classes:["decimal"]}),t=f("span",{classes:["hex"]}),e=f("span",{classes:["max_pointer"]}),n=f("span",{classes:["pointer"]});return{metaData:f("code",{classes:["binary_info","word-break-all"],children:[r,t,e,n]}),$decimal:r,$hex:t,$maxPointer:e,$pointer:n}},Rn=()=>{let r=f("span",{classes:["prefix"]}),t=f("span",{classes:["binary-head"]}),e=f("span",{classes:["suffix"]});return{binaryBits:f("code",{classes:["word-break-all"],children:[r,t,e]}),$prefix:r,$head:t,$suffix:e}},Vt=class{constructor(t){this.root=t,this.cells=[]}initialize(t){this.clear();let e=[],n=f("table");for(let s of t.keys()){let i=f("td");i.dataset.test=`B${s}`;let{metaData:o,$decimal:a,$hex:u,$maxPointer:p,$pointer:l}=In();i.append(o,f("br"));let{binaryBits:_,$prefix:v,$head:J,$suffix:Z}=Rn();i.append(_);let de=f("tr",{children:[f("th",`B${s}`),i]});n.append(de),e.push({$decimal:a,$hex:u,$maxPointer:p,$pointer:l,$prefix:v,$head:J,$suffix:Z})}this.root.append(n),this.cells=e}clear(){this.cells=[],this.root.innerHTML=""}render(t,e,n,s,i){let o=0,a=this.cells;for(let u of t.values()){let{$prefix:p,$head:l,$suffix:_,$decimal:v,$hex:J,$maxPointer:Z,$pointer:de}=a[o]??Bn();if(e)p.innerHTML="",l.innerHTML="",_.innerHTML="";else{let ft=u.toObject();p.textContent=n?Ot(ft.suffix):we(ft.prefix),l.textContent=ft.head.toString(),_.textContent=n?Ot(ft.prefix):we(ft.suffix)}s?v.textContent="value = "+u.toNumberString(10)+", ":v.innerHTML="",i?J.textContent="hex = "+u.toNumberString(16)+", ":J.innerHTML="",Z.textContent="max_pointer = "+(u.getBits().length-1)+", ",de.textContent="pointer = "+u.pointer.toString(),o++}}};var ur="stats_current_state",X=r=>r.toLocaleString(),vn=(r,{z:t,nz:e})=>{let n=f("td",{fn:p=>{p.colSpan=2},children:[f("code",r)]}),s="num",i=f("td",{text:X(t+e),classes:[s]}),o=f("td",{text:X(t),classes:[s]}),a=f("td",{text:X(e),classes:[s]});return{$tr:f("tr",{children:[n,i,o,a]}),$sum:i,$z:o,$nz:a}},Yt=class{#e;constructor(t,e){this.root=t,this.#e=e,this.cells=[]}initialize(t,e){this.#e.textContent=X(e.length),this.cells=[],this.root.innerHTML="";for(let[n,s]of t.entries()){let i=e[n]??"",{$tr:o,$sum:a,$z:u,$nz:p}=vn(i,s);this.root.append(o),this.cells.push({$sum:a,$z:u,$nz:p,$tr:o})}}clear(){this.#e.innerHTML="",this.cells=[],this.root.innerHTML=""}render(t,e){let n=t,s=this.cells,i=s.length;for(let o=0;o<i;o++){let a=s[o]??pr();e===o?a.$tr.classList.add(ur):a.$tr.classList.remove(ur);let{z:u,nz:p}=n[o]??pr();a.$sum.textContent=X(u+p),a.$z.textContent=X(u),a.$nz.textContent=X(p)}}};function pr(){throw Error("error")}function fr(r,t){if(r.innerHTML="",t===void 0)return;let e=f("option","None");e.value="-1",e.selected=!0,r.append(e);for(let[n,s]of t.getStateMap()){let i=f("option",n);i.value=s.toString(),r.append(i)}}function dr(r){switch(r.value){case"*":return-1;case"Z":return 0;default:return 1}}var Nn="Start",Cn="Stop",lr="btn-primary",mr="btn-danger",hr=r=>`<svg width="16" height="16" viewBox="0 0 16 16">${r}</svg>`,Dn=()=>{let r=f("div");return r.innerHTML=hr('<path stroke="currentColor" stroke-width="1" d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>')+Nn,r},An=Dn(),Ln=()=>{let r=f("div");return r.innerHTML=hr('<path stroke="currentColor" stroke-width="1" d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>')+Cn,r},Mn=Ln();function dt(r){r.disabled=!1,r.replaceChildren(An),r.classList.add(lr),r.classList.remove(mr)}function gr(r){r.disabled=!1,r.replaceChildren(Mn),r.classList.remove(lr),r.classList.add(mr)}function xr(r,t,e){if(r.replaceChildren(),t==="RuntimeError"||t==="ParseError"){let n=e.split(`
`);for(let s of n)r.append(f("span","- "+s),f("br"));r.classList.remove("d-none")}else r.classList.add("d-none")}var lt=40,Zt=window.innerWidth;Zt>=1200?lt=120:Zt>=992?lt=100:Zt>=768?lt=70:Zt>=576&&(lt=50);var br=(r,t)=>{if(t=t??"",r.value===t)return;r.value=t;let e=t.length,s=Math.min(6,Math.max(1,Math.ceil(e/lt)));r.rows=s};var kn=()=>{let r=[];for(let e=0;e<=6;e++)for(let n=1;n<=9;n++)r.push(n*10**e);return r.push(1e7,15e6),r};function yr(r,t){let e=kn();r.min="0",r.max=(e.length-1).toString(),r.addEventListener("input",()=>{let n=parseInt(r.value,10),s=e[n];if(s===void 0)throw Error("internal error");r.ariaValueText=`(${s.toString()}Hz)`,t.setFrequency(s)})}var Sr=(r,t)=>{r.setCustomValidity(t),r.reportValidity(),r.classList.add("is-invalid")},Er=r=>{r.setCustomValidity(""),r.reportValidity(),r.classList.remove("is-invalid")};function _r(r,t){r.addEventListener("input",()=>{let e=r.files?.item(0);e?.text().then(t)})}var Ft=window.requestIdleCallback??(r=>{setTimeout(()=>{r({didTimeout:!1,timeRemaining(){return 0}})},0)});function mt(r,t){try{localStorage.setItem(r,t)}catch{}}function Be(r){try{localStorage.removeItem(r)}catch{}}function ht(r){try{return localStorage.getItem(r)}catch{return null}}var Un=new Set(["textarea","input","summary","details","button","audio","video","select","option","a","area","modal"]),$r=()=>{let r=document.activeElement?.tagName.toLowerCase()??"";return Un.has(r)};var E=HTMLElement,Tr=c("#error",E),N=c("#input",HTMLTextAreaElement),wr=c("#output",HTMLTextAreaElement),Br=c("#steps",E),w=c("#toggle",HTMLButtonElement),G=c("#reset",HTMLButtonElement),B=c("#step",HTMLButtonElement),gt=c("#step-text",E),Ir=c("#config_button",HTMLButtonElement),nt=c("#stats_button",HTMLButtonElement),Rr=c("#current_state",E),vr=c("#previous_output",E),Nr=c("#frequency_input",HTMLInputElement),Cr=c("#frequency_output",E),Dr=c("#command",E),Pt=c("#canvas",HTMLCanvasElement),qt=Pt.getContext("2d")??(()=>{throw Error("context is null")})(),xt={x:c("#b2dx",E),y:c("#b2dy",E)},bt=c("#b2d_detail",HTMLDetailsElement),Ar=c("#unary_register",E),Xt=c("#unary_register_detail",HTMLDetailsElement),Lr=c("#binary_register",E),Wt=c("#binary_register_detail",HTMLDetailsElement),Mr=c("#add_sub_mul",E),kr=c("#import_file",HTMLInputElement),jt=c("#examples",HTMLButtonElement),Ur=document.querySelectorAll(".js_example"),Ie=c("#config_modal_content",E),yt=c("#step_input",HTMLInputElement),$={$hideBits:c("#hide_bits",HTMLInputElement),$reverseBits:c("#reverse_bits",HTMLInputElement),$showBinaryValueInDecimal:c("#show_binary_value_in_decimal",HTMLInputElement),$showBinaryValueInHex:c("#show_binary_value_in_hex",HTMLInputElement)},Re=c("#breakpoint_select",HTMLSelectElement),Hr=c("#breakpoint_input_select",HTMLSelectElement),St=c("#dark_mode",HTMLInputElement),ve=c("#dark_mode_label",E),Kt=c("#b2d_hide_pointer",HTMLInputElement),Et=c("#b2d_flip_upside_down",HTMLInputElement),Jt=c("#stats_modal",E),zr=c("#stats_body",HTMLTableSectionElement),Gr=c("#stats_number_of_states",E),Or=c("#view-state-diagram",HTMLButtonElement);var Ne="A1",Ce="B0",De="B1",Vr="ADD";function Hn(r){switch(r){case 0:return Ne;case 1:return Ce;case 2:return De}}function zn(r){switch(r){case Ne:return 0;case Ce:return 1;case De:return 2}}var T=class extends m{constructor(t){super(),this.op=t}pretty(){return`${Vr} ${Hn(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Vr&&(s===Ne||s===Ce||s===De))return new T(zn(s))}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0}}isSameComponent(t){return t instanceof T}};var Yr="HALT_OUT",y=class extends m{constructor(){super()}pretty(){return Yr}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==1)return;let[n]=e;if(n===Yr)return new y}doesReturnValue(){return!1}isSameComponent(t){return t instanceof y}};var Ae="0",Le="1",Zr="MUL";function Gn(r){switch(r){case Ae:return 0;case Le:return 1}}function On(r){switch(r){case 0:return Ae;case 1:return Le}}var O=class extends m{constructor(t){super(),this.op=t}pretty(){return`${Zr} ${On(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Zr&&(s===Ae||s===Le))return new O(Gn(s))}doesReturnValue(){return!0}isSameComponent(t){return t instanceof O}};var Fr="NOP",C=class extends m{constructor(){super()}pretty(){return Fr}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==1)return;let[n]=e;if(n===Fr)return new C}doesReturnValue(){return!0}isSameComponent(t){return t instanceof C}};var Pr="OUTPUT",V=class extends m{constructor(t){super(),this.digit=t}pretty(){return`${Pr} ${this.digit}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===Pr&&s!==void 0)return new V(s)}doesReturnValue(){return!1}isSameComponent(t){return t instanceof V}};var Me="A1",ke="B0",Ue="B1",qr="SUB";function Vn(r){switch(r){case 0:return Me;case 1:return ke;case 2:return Ue}}function Yn(r){switch(r){case Me:return 0;case ke:return 1;case Ue:return 2}}var Y=class extends m{constructor(t){super(),this.op=t}pretty(){return`${qr} ${Vn(this.op)}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(n===qr&&(s===Me||s===ke||s===Ue))return new Y(Yn(s))}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0}}isSameComponent(t){return t instanceof Y}};var He="INC",ze="DEC",Ge="READ",Oe="SET",Ve="RESET";function Zn(r){switch(r){case 0:return He;case 1:return ze;case 2:return Ge;case 3:return Oe;case 4:return Ve}}function Fn(r){switch(r){case He:return 0;case ze:return 1;case Ge:return 2;case Oe:return 3;case Ve:return 4}}var I=class extends m{constructor(t,e){super(),this.op=t,this.regNumber=e}pretty(){return`${Zn(this.op)} T${this.regNumber}`}static parse(t){let e=t.trim().split(/\s+/u);if(e.length!==2)return;let[n,s]=e;if(!(n===void 0||s===void 0)&&(n===He||n===ze||n===Ge||n===Oe||n===Ve)&&s.startsWith("T")){let i=s.slice(1);if(/^[0-9]+$/u.test(i))return new I(Fn(n),parseInt(i,10))}}doesReturnValue(){switch(this.op){case 0:return!0;case 1:return!0;case 2:return!0;case 3:return!1;case 4:return!1}}isSameComponent(t){return t instanceof I?this.regNumber===t.regNumber:!1}};var ee=class{constructor(){this.value=0}action(t){switch(t.op){case 1:{let e=this.value,n=e%2;return this.value=[0,0,0,0,0,0,9,9,0,0,9,9,9,9,9,9][e]??d(),n}case 2:{let e=this.value,n=1-e%2;return this.value=[0,0,0,0,9,9,0,0,9,9,0,0,9,9,9,9][e]??d(),n}case 0:{this.value=[5,4,7,6,1,0,3,2,13,12,15,14,9,8,11,10][this.value]??d();return}default:d()}}getValue(){return this.value}a1(){this.action(new T(0))}b0(){let t=this.action(new T(1));return t===void 0&&d(),t}b1(){let t=this.action(new T(2));return t===void 0&&d(),t}toString(){return this.value.toString(2).padStart(4,"0")}toStringDetail(){let t=this.toString();return`${t.slice(0,3)} bit${t.slice(3)}`}};var re=class{constructor(){this.value=0}action(t){switch(t.op){case 0:return this.mul0();case 1:return this.mul1();default:throw Error("MUL: action")}}getValue(){return this.value}mul0(){let t=this.value,e=t%2;return this.value=t>>1,e}mul1(){let t=this.value,e=t%2;return t<=21?this.value=(t>>1)+5:this.value=t-22>>1,e}toString(){return this.value.toString(2).padStart(5,"0")}};var ne=class{constructor(){}action(){return 0}};var se=class{#e="";constructor(){}action(t){this.output(t.digit)}getString(){return this.#e}output(t){this.#e+=t}};var ie=class{constructor(){this.value=0}action(t){switch(t.op){case 1:return this.b0();case 0:return this.a1();case 2:return this.b1();default:d()}}getValue(){return this.value}a1(){let e=[3,2,-1,-1,7,6,-1,-1,11,10,-1,-1,15,14,-1,-1,19,18,-1,-1,23,22,-1,-1,27,26,-1,-1,31,30,-1,-1][this.value]??d();if(e===-1)throw Error("SUB error: A1");this.value=e}b0(){let t=this.value%2,e=[0,0,0,0,17,17,0,0,0,0,0,0,0,0,17,17,17,17,0,0,17,17,17,17,0,0,17,17,17,17,17,17];return this.value=e[this.value]??d(),t}b1(){let t=1-this.value%2,e=[17,17,0,0,0,0,0,0,0,0,17,17,0,0,0,0,17,17,17,17,17,17,0,0,17,17,17,17,0,0,17,17];return this.value=e[this.value]??d(),t}toString(){return this.value.toString(2).padStart(5,"0")}toStringDetail(){let t=this.toString();return t.slice(0,3)+" stopper"+t.slice(3,4)+" bit"+t.slice(4)}};var oe=class{constructor(){this.pointer=0,this.bits=[0]}action(t){switch(t.op){case 0:return this.inc();case 2:return this.read();case 1:return this.dec();case 3:return this.set();case 4:return this.reset();default:d()}}getPointer(){return this.pointer}getBits(){return this.bits}inc(){let t=this.bits;return this.pointer===t.length-1?(t.push(0),this.pointer++,0):(this.pointer++,1)}dec(){return this.pointer===0?0:(this.pointer--,1)}read(){let t=this.pointer,e=this.bits[t];if(e===0)return this.bits[t]=-1,0;if(e===1)return this.bits[t]=-1,1;if(e===-1)throw Error("Error: reading empty space of T register");d()}set(){if(this.bits[this.pointer]===-1)this.bits[this.pointer]=1;else throw Error("Error: SET to nonempty bit")}reset(){if(this.bits[this.pointer]===-1)this.bits[this.pointer]=0;else throw Error("Error: RESET to nonempty bit")}};function Nt(r,t){throw Error(`Register ${r}${t} is not found.`)}var Xr=Number.parseInt,Wr=Number.isNaN,ae=class{constructor({unaryRegisterNumbers:t,binaryRegisterNumbers:e,legacyTRegisterNumbers:n}){this.uRegMap=new Map(t.map(s=>[s,new Ht])),this.bRegMap=new Map(e.map(s=>[s,new Gt])),this.legecyTRegMap=new Map(n.map(s=>[s,new oe])),this.add=new ee,this.sub=new ie,this.mul=new re,this.b2d=new Ut,this.output=new se,this.nop=new ne}setByRegistersInit(t){for(let[e,n]of Object.entries(t))this.#e(e,n)}setCache(t){t instanceof h?t.registerCache=this.getBReg(t.regNumber):t instanceof x&&(t.registerCache=this.getUReg(t.regNumber))}#e(t,e){if(t.startsWith("U")){let n=Xr(t.slice(1),10);Wr(n)&&Ye(t,e);let s=this.getUReg(n);if(s===void 0)throw Error(`Invalid #REGISTERS: U${n} isn't used in the program`);s.setByRegistersInit(t,e)}else if(t.startsWith("B")){let n=Xr(t.slice(1),10);Wr(n)&&Ye(t,e);let s=this.getBReg(n);if(s===void 0)throw Error(`Invalid #REGISTERS: B${n} isn't used in the program`);s.setByRegistersInit(t,e)}else Ye(t,e)}execAction(t){if(t instanceof h)return(t.registerCache??this.bRegMap.get(t.regNumber)??Nt("B",t.regNumber)).action(t);if(t instanceof x)return(t.registerCache??this.uRegMap.get(t.regNumber)??Nt("U",t.regNumber)).action(t);if(t instanceof T)return this.add.action(t);if(t instanceof C)return this.nop.action();if(t instanceof Y)return this.sub.action(t);if(t instanceof O)return this.mul.action(t);if(t instanceof S)return this.b2d.action(t);if(t instanceof V)return this.output.action(t);if(t instanceof y)return-1;if(t instanceof I)return(this.legecyTRegMap.get(t.regNumber)??Nt("T",t.regNumber)).action(t);throw Error(`execAction: unknown action ${t.pretty()}`)}execActionN(t,e){if(t instanceof x)return(t.registerCache??this.uRegMap.get(t.regNumber)??Nt("U",t.regNumber)).actionN(t,e);if(t instanceof h)return(t.registerCache??this.bRegMap.get(t.regNumber)??Nt("B",t.regNumber)).actionN(t,e);if(t instanceof y)return-1;throw Error(`execActionN: ${t.pretty()}`)}getUReg(t){return this.uRegMap.get(t)}getBReg(t){return this.bRegMap.get(t)}addSubMulToUIString(){return`
        ADD = ${this.add.toStringDetail()},
        SUB = ${this.sub.toStringDetail()},
        MUL = ${this.mul.toString()}
        `}};function Ye(r,t){let e=`"${r}": ${JSON.stringify(t)}`;throw Error(`Invalid #REGISTERS ${e}`)}function Ze(r){let t=[h.parse,x.parse,S.parse,C.parse,T.parse,O.parse,Y.parse,V.parse,y.parse,I.parse];for(let e of t){let n=e(r);if(n!==void 0)return n}}var Ct="INITIAL",W=class{pretty(){return""}},D=class extends W{constructor(t){super(),this.content=t}static get key(){return"#COMPONENTS"}pretty(){return D.key+" "+this.content}},A=class extends W{constructor(t){super(),this.content=t}static get key(){return"#REGISTERS"}pretty(){return A.key+" "+this.content}},Fe=class extends W{constructor(t){super(),this.str=t}getString(){return this.str}pretty(){return this.getString()}},Pe=class extends W{constructor(){super()}pretty(){return""}};function Pn(r){switch(r){case"Z":return r;case"NZ":return r;case"ZZ":return r;case"*":return r;default:return}}var ct=class extends W{constructor({state:t,input:e,nextState:n,actions:s,line:i}){super(),this.state=t,this.input=e,this.nextState=n,this.actions=s,this.line=i,this._string=`${this.state}; ${this.input}; ${this.nextState}; ${this.actions.map(o=>o.pretty()).join(", ")}`}pretty(){return this._string}};function ce(){throw Error("internal error")}function jr(r,t){let e=r.trim();if(e==="")return new Pe;if(e.startsWith("#"))return e.startsWith(D.key)?new D(e.slice(D.key.length).trim()):e.startsWith(A.key)?new A(e.slice(A.key.length).trim()):new Fe(r);let n=e.split(/\s*;\s*/u);if(n.length<4)return`Invalid line "${r}"${at(t)}`;if(n.length>4)return n[4]===""?`Extraneous semicolon "${r}"${at(t)}`:`Invalid line "${r}"${at(t)}`;let s=n[0]??ce(),i=n[1]??ce(),o=n[2]??ce(),u=(n[3]??ce()).trim().split(/\s*,\s*/u).filter(_=>_!==""),p=[];for(let _ of u){let v=Ze(_);if(v===void 0)return`Unknown action "${_}" in "${r}"${at(t)}`;p.push(v)}let l=Pn(i);return l===void 0?`Unknown input "${i}" in "${r}"${at(t)}. Expect "Z", "NZ", "ZZ" or "*"`:new ct({state:s,input:l,nextState:o,actions:p,line:t})}function at(r){return r!==void 0?` at line ${r}`:""}function b(r){return at(r.line)}function Kr(r){let t=r.actions;if(t.some(n=>n instanceof y))return;let e=t.filter(n=>n.doesReturnValue());if(e.length!==1)return e.length===0?`Does not produce the return value in "${r.pretty()}"${b(r)}`:`Does not contain exactly one action that produces a return value in "${r.pretty()}": Actions that produce value are ${e.map(n=>`"${n.pretty()}"`).join(", ")}${b(r)}`}var Jr=r=>{if(r.nextState===Ct)return`Return to initial state in "${r.pretty()}"${b(r)}`};function Qr(r){let t=r.actions;if(t.length<=1)return;let e=t.map(s=>s.pretty());e.sort();let n=e.length-1;for(let s=0;s<n;s++){let i=e[s],o=e[s+1];if(i===o)return`Duplicated actions "${i}" in "${r.pretty()}"${b(r)}`}}var tn=()=>{throw Error("internal error")};function en(r){let t=r.actions;if(t.find(n=>n instanceof y)!==void 0)return;let e=t.length;if(!(e<=1))for(let n=0;n<e;n++){let s=t[n]??tn();for(let i=n+1;i<e;i++){let o=t[i]??tn();if(s.isSameComponent(o))return`Actions "${s.pretty()}" and "${o.pretty()}" use same component in "${r.pretty()}"${b(r)}`}}}var rn=()=>{throw Error("internal error")},qn=(r,t)=>r.line!==void 0&&t?.line!==void 0?` at line ${r.line} and ${t.line}`:"",nn=r=>{if(r.length===0)return;let t=(s,i)=>`Need Z line followed by NZ line in "${s.pretty()}"${qn(s,i)}`,e=r.length-1;for(let s=0;s<e;s++){let i=r[s]??rn(),o=r[s+1]??rn(),a=i.input,u=o.input;if(a==="Z"&&u!=="NZ"||u==="NZ"&&a!=="Z"||a==="Z"&&u==="NZ"&&i.state!==o.state)return[t(i,o)]}let n=r[e];if(n?.input==="Z")return[t(n)]};var ut=class{constructor(t){this.array=t}getArray(){return this.array}pretty(){return this.array.map(t=>t.pretty()).join(`
`)}static parse(t){let n=t.split(/\r\n|\n|\r/u).map((o,a)=>jr(o,a+1)),s=n.flatMap(o=>typeof o=="string"?[o]:[]);if(s.length>0)return s.join(`
`);let i=n.flatMap(o=>typeof o!="string"?[o]:[]);return new ut(i)}};function sn(r){let t=[];{let e=[Qr,Kr,en,Jr];for(let n of r)for(let s of e){let i=s(n);typeof i=="string"&&t.push(i)}}{let e=[nn];for(let n of e){let s=n(r);s!==void 0&&(t=t.concat(s))}}if(t.length>0)return t.join(`
`)}var j=class{constructor({programLines:t}){let e=t.getArray();this.commands=e.flatMap(n=>n instanceof ct?[n]:[]),this.componentsHeader=void 0;for(let n of e)if(n instanceof D){if(this.componentsHeader!==void 0)throw Error(`Multiple ${D.key}`);this.componentsHeader=n}this.registersHeader=void 0;for(let n of e)if(n instanceof A){if(this.registersHeader!==void 0)throw Error(`Multiple ${A.key}`);this.registersHeader=n}this.programLines=t}static parse(t,{noValidate:e}={}){let n=ut.parse(t);if(typeof n=="string")return n;let s=[];for(let i of n.getArray())i instanceof ct&&s.push(i);if(!e){if(s.length===0)return"Program is empty";let i=sn(s);if(typeof i=="string")return i}try{return new j({programLines:n})}catch(i){return i instanceof Error?i.message:"Unknown error is occurred."}}pretty(){return this.programLines.pretty()}},Xn=r=>[...new Set(r)].sort((t,e)=>t-e),on=r=>{let t=r.commands.flatMap(n=>n.actions),e=n=>Xn(t.flatMap(s=>s instanceof n?[s.regNumber]:[]));return{unary:e(x),binary:e(h),legacyT:e(I)}};var Wn=r=>r instanceof h&&r.op===0,jn=r=>r instanceof x&&r.op===1,Kn=r=>{if(r.input==="NZ"&&r.state===r.nextState&&r.actions.every(t=>!(t instanceof y))&&r.actions.every(t=>t instanceof x||Wn(t))){let t=r.actions.find(jn);if(t&&t instanceof x)return{tdecU:t}}},Jn=r=>{if(r.input==="NZ"&&r.state===r.nextState&&r.actions.every(t=>!(t instanceof y))&&r.actions.length===1&&r.actions.every(t=>t instanceof h)){let t=r.actions.find(e=>e instanceof h&&e.op===1);if(t&&t instanceof h)return{tdecB:t}}},pt=class{constructor(t,e){this.command=t,this.nextState=e,this.tdecuOptimize=Kn(t),this.tdecbOptimize=Jn(t)}},Xe=class{constructor(t,e){this.z=t,this.nz=e}},qe=(r,t)=>{throw Error(`Duplicated command: "${r.pretty()}" and "${t.pretty()}"${b(t)}`)},an=r=>{let t=new Map,e=[];for(let n of r)t.has(n.state)||(t.set(n.state,t.size),e.push(new Xe(void 0,void 0)));for(let n of r){let s=e[t.get(n.state)??d()]??d(),i=t.get(n.nextState);if(i===void 0)throw Error(`Unknown state: "${n.nextState}" at "${n.pretty()}"${b(n)}`);switch(n.input){case"Z":{s.z===void 0?s.z=new pt(n,i):qe(s.z.command,n);break}case"NZ":{s.nz===void 0?s.nz=new pt(n,i):qe(s.nz.command,n);break}case"ZZ":{if(s.nz!==void 0)throw Error(`Invalid input: ZZ with NZ or *: "${n.pretty()}" and "${s.nz.command.pretty()}"${b(n)}`);s.z===void 0?s.z=new pt(n,i):qe(s.z.command,n);break}case"*":{if(s.nz!==void 0)throw Error(`Invalid input: * "${n.pretty()}" and "${s.nz.command.pretty()}"${b(n)}`);if(s.z!==void 0)throw Error(`Invalid input: * "${n.pretty()}" and "${s.z.command.pretty()}"${b(n)}`);{let o=new pt(n,i);s.z=o,s.nz=o}break}default:{let o=n.input;d()}}}return{states:[...t.keys()],stateMap:t,lookup:e}};var R=(r="error")=>{throw Error(r)},K=class{constructor(t){if(!(t instanceof j))throw TypeError("program is not a Program");this.stepCount=0;let e=on(t);this.actionExecutor=new ae({binaryRegisterNumbers:e.binary,unaryRegisterNumbers:e.unary,legacyTRegisterNumbers:e.legacyT}),this.prevOutput=0,this.program=t;let{states:n,stateMap:s,lookup:i}=an(t.commands);this.states=n,this.stateMap=s,this.lookup=i;for(let a of i){let u=(a.z?.command.actions??[]).concat(a.nz?.command.actions??[]);for(let p of u)this.actionExecutor.setCache(p)}this.currentStateIndex=s.get(Ct)??R(`${Ct} state is not present`),this.stateStatsArray=Array(i.length*2).map(()=>0).fill(0);let o=t.registersHeader;o&&this.#e(o)}static fromString(t){let e=j.parse(t);if(typeof e=="string")throw Error(e);return new K(e)}getStateStats(){let t=this.stateStatsArray,e=t.length,n=[];for(let s=0;s<e;s+=2)n.push({z:t[s]??R(),nz:t[s+1]??R()});return n}#e(t){let e=t.content.replace(/'/ug,'"'),n={};try{n=JSON.parse(e)}catch{R(`Invalid #REGISTERS: is not a valid JSON: "${e}"`)}(n===null||typeof n!="object")&&R(`Invalid #REGISTERS: "${e}" is not an object`),this.actionExecutor.setByRegistersInit(n)}getCurrentState(){let t=this.states[this.currentStateIndex];return t===void 0&&R("State name is not found"),t}getStateMap(){return this.stateMap}getPreviousOutput(){return this.prevOutput===0?"Z":"NZ"}getNextCommand(){let t=this.currentStateIndex,e=this.lookup[t];if(e===void 0&&R(`Internal Error: Next command is not found: Current state index: ${t}`),this.prevOutput===0){let s=e.z;if(s!==void 0)return s}else{let s=e.nz;if(s!==void 0)return s}R("Next command is not found: Current state = "+this.getCurrentState()+", output = "+this.getPreviousOutput())}_internalExecActionN(t,e){try{let n=this.actionExecutor;for(let s of t.actions)n.execActionN(s,e)}catch(n){if(n instanceof Error)this.#n(n);else throw n}this.stateStatsArray[this.currentStateIndex*2+this.prevOutput]+=e,this.stepCount+=e}exec(t,e,n,s){let i=n!==-1,o=performance.now();for(let a=0;a<t;a++){let u=this.getNextCommand();if(u.tdecuOptimize){let l=u.tdecuOptimize.tdecU.registerCache?.getValue();if(l!==void 0&&l!==0){l=Math.min(l,t-a),this._internalExecActionN(u.command,l),a+=l-1;continue}}else if(u.tdecbOptimize){let l=u.tdecbOptimize.tdecB.registerCache?.pointer;if(l!==void 0&&l!==0){l=Math.min(l,t-a),this._internalExecActionN(u.command,l),a+=l-1;continue}}try{if(this.execCommandFor(u)===-1)return"Halted"}catch(p){if(p instanceof Error)this.#n(p);else throw p}if(i&&this.currentStateIndex===n&&(s===-1||s===this.prevOutput))return"Stop";if(e&&(a+1)%5e5===0&&performance.now()-o>=50)return}}#n(t){let e=this.getNextCommand().command,n=b(e);return R(t.message+` in "${e.pretty()}"`+n)}execCommandFor(t){this.stepCount+=1;{let o=this.currentStateIndex,a=this.prevOutput;this.stateStatsArray[o*2+a]++}let e=-1,n=this.actionExecutor,s=t.command;for(let o of s.actions){let a=n.execAction(o);if(a===-1)return-1;a!==void 0&&(e===-1?e=a:R(`Return value twice: line = ${s.pretty()}${b(s)}`))}e===-1&&R(`No return value: line = ${s.pretty()}${b(s)}`);let i=t.nextState;this.currentStateIndex=i,this.prevOutput=e}execCommand(){return this.execCommandFor(this.getNextCommand())}};var Qn=30,ue=class{#e;#n="";#t;#c;#o=new zt(Ar);#a=new Vt(Lr);#i=new Yt(zr,Gr);#s;#r="Initial";constructor(){this.stepConfig=1,this.#s=new At(t=>{this.run(t)},{frequency:Qn})}setFrequency(t){this.#s.frequency=t,this.#u()}start(){switch(this.#r){case"Initial":{this.reset()&&(this.#r="Running");break}case"Stop":{this.#r="Running";break}default:throw Error("start: unreachable")}this.render()}stop(){this.#r="Stop",this.render()}toggle(){this.#r==="Running"?this.stop():this.start()}#p(){this.#t===void 0?this.#o.clear():this.#o.initialize(this.#t.actionExecutor.uRegMap)}#f(){this.#t===void 0?this.#a.clear():this.#a.initialize(this.#t.actionExecutor.bRegMap)}#d(){this.#p(),this.#f(),this.#h(),fr(Re,this.#t)}doStep(){if(this.#r==="Running"&&this.stop(),this.stepConfig>=5e6){let t=Qe();t.style.position="absolute",B.append(t),gt.style.color="transparent",B.disabled=!0,G.disabled=!0,w.disabled=!0,setTimeout(()=>{try{this.run(this.stepConfig)}finally{gt.style.color="",t.remove()}},33)}else this.run(this.stepConfig)}setInputAndReset(t){N.value=t,this.reset()}reset(){this.#n="",this.#t=void 0,this.#s.reset();try{this.#t=K.fromString(N.value),this.#d(),this.#r="Stop"}catch(t){return this.#r="ParseError",this.#n=le(t),this.render(),!1}return this.render(),!0}#u(){let t=this.#s.frequency;this.#c!==t&&(Cr.textContent=t.toLocaleString(),this.#c=t)}#l(){try{let t=this.#t?.getNextCommand();Dr.textContent=t?.command.pretty()??""}catch(t){console.error(t)}}renderB2D(){if(!bt.open)return;let t=this.#t;if(t===void 0){xt.x.textContent="0",xt.y.textContent="0",qt.clearRect(0,0,Pt.width,Pt.height),qt.resetTransform();return}let e=t.actionExecutor.b2d;xt.x.textContent=e.x.toString(),xt.y.textContent=e.y.toString();let n=performance.now();ir(qt,e,Kt.checked,Et.checked),this.#r==="Running"&&performance.now()-n>=200&&(bt.open=!1)}renderUnary(){this.#t!==void 0&&Xt.open&&this.#o.render(this.#t.actionExecutor.uRegMap)}renderBinary(){this.#t!==void 0&&Wt.open&&this.#a.render(this.#t.actionExecutor.bRegMap,$.$hideBits.checked,$.$reverseBits.checked,$.$showBinaryValueInDecimal.checked,$.$showBinaryValueInHex.checked)}#m(){let t=this.#t?.actionExecutor.output.getString();br(wr,t)}#h(){this.#t===void 0?this.#i.clear():this.#i.initialize(this.#t.getStateStats(),this.#t.states)}renderStats(){if(Jt.classList.contains("show")){if(this.#t===void 0){this.#i.clear();return}this.#i.render(this.#t.getStateStats(),this.#t.currentStateIndex)}}#g(){switch(this.#r){case"Initial":{dt(w),B.disabled=!1,G.disabled=!1,nt.disabled=!0;break}case"Stop":{dt(w),B.disabled=!1,G.disabled=!1,nt.disabled=!1;break}case"Running":{gr(w),B.disabled=!0,G.disabled=!0,nt.disabled=!1;break}case"RuntimeError":case"ParseError":{dt(w),w.disabled=!0,B.disabled=!0,G.disabled=!1,nt.disabled=!0;break}case"Halted":{dt(w),w.disabled=!0,B.disabled=!0,G.disabled=!1,nt.disabled=!1;break}}}render(){let t=this.#r;this.#s.disabled=t!=="Running",(this.#e!==t||t==="Stop")&&(this.#g(),t==="ParseError"?N.classList.add("is-invalid"):N.classList.remove("is-invalid")),xr(Tr,t,this.#n),this.#u();let e=this.#t;Rr.textContent=e?.getCurrentState()??"",vr.textContent=e?.getPreviousOutput()??"",Br.textContent=e?.stepCount.toLocaleString()??"",this.stepConfig===1?gt.textContent="Step":gt.textContent=`${this.stepConfig.toLocaleString()} Steps`,this.#l(),this.#m(),this.renderUnary(),this.renderBinary(),Mr.textContent=e?.actionExecutor.addSubMulToUIString()??"",this.renderB2D(),this.renderStats(),this.#e=t}run(t){switch(this.#r){case"Initial":if(!this.reset())return}if(t<=0||isNaN(t))return;let e=this.#t;if(e===void 0)return;let n=this.#r==="Running",s=parseInt(Re.value,10),i=dr(Hr);try{let o=e.exec(t,n,s,i);o!==void 0&&(this.#r=o)}catch(o){this.#r="RuntimeError",this.#n=le(o)}finally{this.render()}}};var ts="./frontend/data/",g=new ue;G.addEventListener("click",()=>{g.reset()});w.addEventListener("click",()=>{g.toggle()});B.addEventListener("click",()=>{g.doStep()});Ur.forEach(r=>{r.addEventListener("click",async()=>{jt.style.opacity="0.5";let t=r.dataset.src;try{let e=await fetch(ts+t);if(!e.ok)throw Error("error");g.setInputAndReset(await e.text()),Ke()}catch{console.error(`Fetch: ${t}`)}finally{jt.removeAttribute("style")}})});yr(Nr,g);bt.addEventListener("toggle",()=>{g.renderB2D()});Wt.addEventListener("toggle",()=>{g.renderBinary()});Xt.addEventListener("toggle",()=>{g.renderUnary()});var Ke=()=>{N.scrollTop=0};_r(kr,r=>{g.setInputAndReset(r),Ke()});yt.addEventListener("input",()=>{let r=Number(yt.value);isNaN(r)||r<=0||!Number.isInteger(r)?(Sr(yt,"Enter a positive integer"),g.stepConfig=1):(Er(yt),g.stepConfig=r),g.render()});var Dt=(r,t)=>{r.addEventListener("change",()=>{g.render(),mt(t,r.checked.toString())})},cn="hide_binary";Dt($.$hideBits,cn);var un="reverse_binary";Dt($.$reverseBits,un);var pe="show_binary_in_decimal";Dt($.$showBinaryValueInDecimal,pe);var pn="show_binary_in_hex";Dt($.$showBinaryValueInHex,pn);Kt.addEventListener("change",()=>{g.renderB2D()});var fn="b2d_flip_upside_down";Dt(Et,fn);Jt.addEventListener("shown.bs.modal",()=>{g.renderStats()});Or.addEventListener("click",()=>{N.value.length>=10**6||(mt("state-diagram-input",N.value),window.open("./tools/diagram/index.html",void 0,"noreferrer=yes,noopener=yes"))});var We="apge_dark",fe="on",je="dark_mode";St.addEventListener("change",()=>{St.checked?(mt(je,fe),document.body.setAttribute(We,fe)):(Be(je),document.body.removeAttribute(We)),ve.textContent=St.checked?"On":"Off";let r="animate-color-and-background-color";document.body.classList.add(r),Ie.classList.add(r),setTimeout(()=>{document.body.classList.remove(r),Ie.classList.remove(r)},500)});document.addEventListener("keydown",r=>{if(!($r()||r.isComposing||r.metaKey||r.shiftKey||r.ctrlKey))switch(r.code){case"Enter":{g.toggle();break}case"Space":{B.disabled||(r.preventDefault(),g.doStep());break}}});N.addEventListener("drop",async r=>{r.preventDefault();let t=r.dataTransfer?.files.item(0);t!=null&&(g.setInputAndReset(await t.text()),Ke())});jt.disabled=!1;Ir.disabled=!1;g.render();Ft(()=>{let r="initial_code",t=ht(r);t!==null&&(Be(r),g.setInputAndReset(t))});Ft(()=>{ht(pe)===null&&mt(pe,"true");let r=[{key:fn,checkbox:Et},{key:un,checkbox:$.$reverseBits},{key:cn,checkbox:$.$hideBits},{key:pe,checkbox:$.$showBinaryValueInDecimal},{key:pn,checkbox:$.$showBinaryValueInHex}];for(let{key:t,checkbox:e}of r)ht(t)==="true"&&(e.checked=!0);ht(je)===fe&&(document.body.setAttribute(We,fe),St.checked=!0,ve.textContent="On"),g.render()});"serviceWorker"in navigator&&Ft(async()=>{(await navigator.serviceWorker.getRegistrations()).map(t=>t.unregister())});
