<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

    <!-- critical path -->
    <script src="./src/exports.js" type="module"></script>

    <!-- main -->
    <script src="./frontend/index.js" type="module"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="./dark_mode.css">

    <link rel="icon" href="./favicon.svg" type="image/svg+xml">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APGsembly 2.0 Emulator</title>
    <meta name="description" content="An emulator for APGsembly 2.0">
    <meta name="keywords" content="Conway's Game of Life,Game of Life,GoL,APGsembly,General purpose calculator,GPC">

    <link rel="canonical" href="https://rei1024.github.io/proj/apgsembly-emulator-2/">

    <meta property="og:title" content="APGsembly 2.0 Emulator">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://rei1024.github.io/proj/apgsembly-emulator-2/">
    <meta property="og:image" content="https://rei1024.github.io/proj/apgsembly-emulator-2/favicon.svg">

    <meta property="og:description" content="An emulator for APGsembly 2.0" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:creator" content="@rei_1729" />

    <style>
        #state td, #state th {
            padding: 4px;
        }
        #state {
            /* 幅が変化しないようにする */
            table-layout: fixed;
        }
        #steps {
            color: black;
        }
        body[apge_dark_mode=on] #steps {
            color: var(--dark-mode-color);
        }
        .code-mono {
            font-family: var(--bs-font-monospace);
            font-size: .875em;
            word-wrap: break-word;
        }

        #stats_table td, #stats_table th {
            padding: 2px;
        }
    </style>
</head>
<body>
    <script>
        // Fix Dark mode flashing
        if (localStorage.getItem('dark_mode') === "on") {
            document.body.setAttribute('apge_dark_mode', "on");
        }
    </script>
    <header class="text-center">
        <h1>APGsembly 2.0 Emulator</h1>
    </header>
    <main class="container">
        <!-- インラインスタイルで指定 -->
        <div id="error" style="display: none;" class="alert alert-danger" role="alert"></div>
        <div class="mb-3">
            <label for="input" class="form-label">Input</label>
            <textarea class="code-mono form-control" name="input" id="input" cols="50" rows="8" placeholder="# Write APGsembly here!"></textarea>
        </div>
        <!-- Buttons -->
        <div data-test="control_buttons" class="btn-group" role="group" aria-label="Control">
            <!-- index.jsが読み込まれるまではdisabled -->
            <button id="reset" type="button" class="btn btn-primary" disabled>Reset</button>
            <button id="start" type="button" class="btn btn-primary" disabled>Start</button>
            <button id="stop" type="button" class="btn btn-primary" disabled>Stop</button>
            <button id="step" type="button" class="btn btn-primary" disabled>Step</button>
            <button id="config_button" disabled data-test="config_button" type="button" class="btn btn-primary"
                data-bs-toggle="modal" data-bs-target="#config_modal">
                Config
            </button>
            <button id="stats_button" disabled type="button" class="btn btn-primary"
                data-bs-toggle="modal" data-bs-target="#stats_modal">
                Stats
            </button>
            <button disabled type="button" class="btn btn-primary dropdown-toggle" id="samples" data-bs-toggle="dropdown" aria-expanded="false">Sample</button>
            <ul class="dropdown-menu" aria-labelledby="samples">
                <li>
                    <button class="dropdown-item js_sample" data-src="unary_multiply.apg">Unary register multiplication</button>
                    <button class="dropdown-item js_sample" data-src="binary_ruler.apg">Binary ruler</button>
                    <button class="dropdown-item js_sample" data-src="integers.apg">Integers</button>
                    <button class="dropdown-item js_sample" data-src="sqrt_log_t.apg">O(sqrt(log(t)))</button>
                    <button class="dropdown-item js_sample" data-src="rule110.apg">Rule 110</button>
                    <button class="dropdown-item js_sample" data-src="ant2.apg">Langton's ant</button>
                    <button class="dropdown-item js_sample" data-src="koch.apg">Koch snowfrake</button>
                    <button class="dropdown-item js_sample" data-src="pi_calc.apg">Pi Calculator</button>
                </li>
            </ul>
            <input id="import_file" type="file" class="d-none">
            <label for="import_file" class="btn btn-primary">Import</label>
        </div>
        <!-- End Buttons -->
        <div class="mt-1 mb-2">
            <!-- チラつき防止のためデフォルト値を設定 DEFUALT_FREQUENCYと同期すること -->
            <label for="frequency_input" class="form-label m-0">Speed <span id="frequency_output">30Hz</span></label>
            <!-- index.jsでminとmaxは設定するが、ジャンプを防ぐため手動でも設定する -->
            <input id="frequency_input" class="form-range" value="11" type="range" max="63">
        </div>
        <div>
            <table class="table" id="state">
                <thead>
                    <tr>
                        <th>Current state</th>
                        <th>Previous output</th>
                        <th>Steps</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pb-0">
                        <!-- CLSを防ぐため、レンダリングされた後の値と同じにする -->
                        <td class="code-mono" id="current_state">
                            <!-- INITIAL -->
                        </td>
                        <td class="code-mono" id="previous_output">
                            <!-- Z -->
                        </td>
                        <td><code id="steps">0</code></td>
                    </tr>
                </tbody>
            </table>
            <p class="mb-1">
                Command: <code id="command"></code>
            </p>
        </div>
        <div class="mb-2">
            <details open>
                <summary>
                    Output
                </summary>
                <textarea class="code-mono form-control" name="output" id="output" cols="50" rows="3"></textarea>
            </details>
        </div>
        <div class="mb-2">
            <details id="unary_register_detail" open>
                <summary>
                    Unary Registers
                </summary>
                <div id="unary_register"></div>
            </details>
        </div>
        <div class="mb-2">
            <details id="binary_register_detail" open>
                <summary>
                    Binary Registers
                </summary>
                <div id="binary_register"></div>
                <!-- <table>
                    <tr>
                        <th>B1</th>
                        <td>
                            <code style="color: black;">
                                <span class="decimal">value = 3432</span><span class="pointer">, pointer = 12</span>
                            </code>
                            <br>
                            <code style="word-break: break-all">
                                <span class="prefix">110011010</span><span class="head" style="border-bottom: 3px solid #0D47A1; color: #0D47A1;">1</span><span class="suffix">101101001</span>
                            </code>
                        </td>
                    </tr>
                </table> -->
            </details>
        </div>
        <div class="mb-2">
            <details id="add_sub_mul_detail" open>
                <summary>
                    ADD SUB MUL
                </summary>
                <code id="add_sub_mul"></code>
            </details>
        </div>
        <div class="mb-2">
            <details id="b2d_detail" open>
                <summary>
                    B2D
                </summary>
                <div class="code-mono">
                    <!-- 初期状態の値を入れておく -->
                    x = <span id="b2dx">0</span>,
                    y = <span id="b2dy">0</span>
                </div>
                <canvas id="canvas"></canvas>
            </details>
        </div>
    </main>
    <!-- Config Modal -->
    <div class="modal fade" id="config_modal" tabindex="-1" aria-labelledby="config_modal_label" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="config_modal_label">Config</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mt-0">
                    <label for="step_input" class="form-label">Step: The number of steps to run</label>
                    <input type="number" value="1" id="step_input" class="form-control">
                </div>
                <div class="mt-3">
                    <label for="breakpoint_select" class="form-label">Breakpoint state</label>
                    <select name="breakpoint_select" class="form-select" id="breakpoint_select">
                    </select>
                </div>
                <div>
                    <label for="breakpoint_input_select" class="form-label">Breakpoint input</label>
                    <select name="breakpoint_input_select" class="form-select" id="breakpoint_input_select">
                        <option value="-1" selected>*</option>
                        <option value="0">Z</option>
                        <option value="1">NZ</option>
                    </select>
                </div>
                <div class="mt-3">
                    <div>
                        Binary registers:
                    </div>
                    <div class="form-check">
                        <input type="checkbox" id="hide_binary" class="form-check-input">
                        <label for="hide_binary" class="form-check-label">Hide binary</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" id="reverse_binary" class="form-check-input">
                        <label for="reverse_binary" class="form-check-label">Reverse binary</label>
                    </div>
                </div>
                <div class="mt-3">
                    <div>
                        B2D:
                    </div>
                    <div class="form-check">
                        <input type="checkbox" id="b2d_flip_upside_down" class="form-check-input">
                        <label for="b2d_flip_upside_down" class="form-check-label">Flip upside down</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" id="b2d_hide_pointer" class="form-check-input">
                        <label for="b2d_hide_pointer" class="form-check-label">Hide pointer</label>
                    </div>
                </div>
                <div class="mt-3">
                    <div>
                        Dark mode
                    </div>
                    <div class="form-check">
                        <input type="checkbox" id="dark_mode" class="form-check-input">
                        <label for="dark_mode" class="form-check-label">Off</label>
                    </div>
                </div>
            </div>
            <!-- <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div> -->
        </div>
        </div>
    </div>
    <!-- End Config Modal -->
    <!-- Stats Modal -->
    <div class="modal fade" id="stats_modal" tabindex="-1" aria-labelledby="stats_modal_label" aria-hidden="true">
        <div style="max-width: 550px;" class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="stats_modal_label">Stats</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table id="stats_table" style="table-layout: fixed;" class="table">
                    <thead>
                        <tr>
                            <th colspan="2">State</th>
                            <th>Sum</th>
                            <th>Z</th>
                            <th>NZ</th>
                        </tr>
                    </thead>
                    <tbody id="stats_body">
                        <!-- <tr>
                            <td colspan="2">I</td>
                            <td>1</td>
                            <td>2</td>
                            <td>2</td>
                        </tr>
                        <tr>
                            <td colspan="2">I</td>
                            <td>1</td>
                            <td>2</td>
                            <td>2</td>
                        </tr>
                        <tr>
                            <td colspan="2">I</td>
                            <td>1</td>
                            <td>2</td>
                            <td>2</td>
                        </tr> -->
                    </tbody>
                </table>
            </div>
            <!-- <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div> -->
        </div>
        </div>
    </div>
    <!-- End Stats Modal -->

    <footer class="mt-3 container">
        <h2 class="fs-4">Shortcuts</h2>
        <table>
            <tr>
                <th><kbd>Space</kbd></th>
                <td>Step</td>
            </tr>
            <tr>
                <th><kbd>Enter</kbd></th>
                <td>Toggle start and stop</td>
            </tr>
        </table>
        <h2 class="fs-4 mt-3">Tools</h2>
        <ul>
            <li>
                <a href="./generator/index.html">
                    Code generator for elementary cellular automata
                </a>
            </li>
            <li>
                <a href="./turmites/index.html">
                    Code generator for turmites
                </a>
            </li>
            <li>
                <a href="./transpiler/index.html">
                    Transpiler for APGsembly 1.0 to APGsembly 2.0
                </a>
            </li>
            <li>
                <a href="./apgc.html">
                    APGC - Structured programming for APGsembly
                </a>
            </li>
            <li>
                <a href="./apgdsl/index.html">
                    APGDSL - EDSL for APGsembly
                </a>
            </li>
        </ul>
        <h2 class="fs-4 mt-3">Links</h2>
        <ul>
            <li>
                <a href="https://github.com/rei1024/rei1024.github.io/tree/main/proj/apgsembly-emulator-2">
                    Source code for APGsembly 2.0 Emulator - GitHub
                </a>
            </li>
            <li>
                <a href="https://www.conwaylife.com/wiki/APGsembly">
                    APGsembly - ConwayLife.com wiki
                </a>
            </li>
            <li>
                <a href="https://www.conwaylife.com/forums/viewtopic.php?f=2&t=4192">
                    Reverse engineering the phi and pi calculators - ConwayLife.com forums<!--
            --></a>
            </li>
            <li>
                <a href="https://www.conwaylife.com/forums/viewtopic.php?f=2&t=4196">
                    Smaller Pi Calculator Challenge - ConwayLife.com forums<!--
            --></a>
            </li>
        </ul>
    </footer>
</body>
</html>
