var kr=Object.defineProperty;var Fr=(t,e)=>{for(var r in e)kr(t,r,{get:e[r],enumerable:!0})};var p={};Fr(p,{Parser:()=>F,all:()=>Ze,choice:()=>jr,eof:()=>Ue,fail:()=>Wr,lazy:()=>Yr,location:()=>Qt,match:()=>Vr,ok:()=>yt,text:()=>Hr});var F=class xt{constructor(e){this.action=e}parse(e){let r={index:0,line:1,column:1},n=new qr({input:e,location:r}),o=this.skip(Ue).action(n);return o.type==="ActionOK"?{type:"ParseOK",value:o.value}:{type:"ParseFail",location:o.furthest,expected:o.expected}}tryParse(e){let r=this.parse(e);if(r.type==="ParseOK")return r.value;let{expected:n,location:o}=r,{line:s,column:i}=o,a=`parse error at line ${s} column ${i}: expected ${n.join(", ")}`;throw new Error(a)}and(e){return new xt(r=>{let n=this.action(r);if(n.type==="ActionFail")return n;r=r.moveTo(n.location);let o=r.merge(n,e.action(r));if(o.type==="ActionOK"){let s=[n.value,o.value];return r.merge(o,r.ok(o.location.index,s))}return o})}skip(e){return this.and(e).map(([r])=>r)}next(e){return this.and(e).map(([,r])=>r)}or(e){return new xt(r=>{let n=this.action(r);return n.type==="ActionOK"?n:r.merge(n,e.action(r))})}chain(e){return new xt(r=>{let n=this.action(r);if(n.type==="ActionFail")return n;let o=e(n.value);return r=r.moveTo(n.location),r.merge(n,o.action(r))})}map(e){return this.chain(r=>yt(e(r)))}thru(e){return e(this)}desc(e){return new xt(r=>{let n=this.action(r);return n.type==="ActionOK"?n:{type:"ActionFail",furthest:n.furthest,expected:e}})}wrap(e,r){return e.next(this).skip(r)}trim(e){return this.wrap(e,e)}repeat(e=0,r=1/0){if(!_e(e,r))throw new Error(`repeat: bad range (${e} to ${r})`);return e===0?this.repeat(1,r).or(yt([])):new xt(n=>{let o=[],s=this.action(n);if(s.type==="ActionFail")return s;for(;s.type==="ActionOK"&&o.length<r;){if(o.push(s.value),s.location.index===n.location.index)throw new Error("infinite loop detected; don't call .repeat() with parsers that can accept zero characters");n=n.moveTo(s.location),s=n.merge(s,this.action(n))}return s.type==="ActionFail"&&o.length<e?s:n.merge(s,n.ok(n.location.index,o))})}sepBy(e,r=0,n=1/0){if(!_e(r,n))throw new Error(`sepBy: bad range (${r} to ${n})`);return r===0?this.sepBy(e,1,n).or(yt([])):n===1?this.map(o=>[o]):this.chain(o=>e.next(this).repeat(r-1,n-1).map(s=>[o,...s]))}node(e){return Ze(Qt,this,Qt).map(([r,n,o])=>({type:"ParseNode",name:e,value:n,start:r,end:o}))}};function _e(t,e){return t<=e&&t>=0&&e>=0&&Number.isInteger(t)&&t!==1/0&&(Number.isInteger(e)||e===1/0)}var Qt=new F(t=>t.ok(t.location.index,t.location));function yt(t){return new F(e=>e.ok(e.location.index,t))}function Wr(t){return new F(e=>e.fail(e.location.index,t))}var Ue=new F(t=>t.location.index<t.input.length?t.fail(t.location.index,["<EOF>"]):t.ok(t.location.index,"<EOF>"));function Hr(t){return new F(e=>{let r=e.location.index,n=r+t.length;return e.input.slice(r,n)===t?e.ok(n,t):e.fail(r,[t])})}function Vr(t){for(let r of t.flags)switch(r){case"i":case"s":case"m":case"u":continue;default:throw new Error("only the regexp flags 'imsu' are supported")}let e=new RegExp(t.source,t.flags+"y");return new F(r=>{let n=r.location.index;e.lastIndex=n;let o=r.input.match(e);if(o){let s=n+o[0].length,i=r.input.slice(n,s);return r.ok(s,i)}return r.fail(n,[String(t)])})}function Ze(...t){return t.reduce((e,r)=>e.chain(n=>r.map(o=>[...n,o])),yt([]))}function jr(...t){return t.reduce((e,r)=>e.or(r))}function Yr(t){let e=new F(r=>(e.action=t().action,e.action(r)));return e}function Xr(t,e){return[...new Set([...t,...e])]}var qr=class ze{constructor(e){this.input=e.input,this.location=e.location}moveTo(e){return new ze({input:this.input,location:e})}_internal_move(e){if(e===this.location.index)return this.location;let r=this.location.index,n=e,o=this.input.slice(r,n),{line:s,column:i}=this.location;for(let a of o)a===`
`?(s++,i=1):i++;return{index:e,line:s,column:i}}ok(e,r){return{type:"ActionOK",value:r,location:this._internal_move(e),furthest:{index:-1,line:-1,column:-1},expected:[]}}fail(e,r){return{type:"ActionFail",furthest:this._internal_move(e),expected:r}}merge(e,r){if(r.furthest.index>e.furthest.index)return r;let n=r.furthest.index===e.furthest.index?Xr(e.expected,r.expected):e.expected;return r.type==="ActionOK"?{type:"ActionOK",location:r.location,value:r.value,furthest:e.furthest,expected:n}:{type:"ActionFail",furthest:e.furthest,expected:n}}};var h=class{pretty(){return""}doesReturnValue(){return!1}isSameComponent(e){return!0}};var te="A1",ee="B0",re="B1",ke="ADD",Kr=t=>{switch(t){case 0:return te;case 1:return ee;case 2:return re}},Jr=t=>{switch(t){case te:return 0;case ee:return 1;case re:return 2}},W=class t extends h{constructor(e){super(),this.op=e}pretty(){return`${ke} ${Kr(this.op)}`}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==2)return;let[n,o]=r;if(n===ke&&(o===te||o===ee||o===re))return new t(Jr(o))}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0}}isSameComponent(e){return e instanceof t}};var Ot="INC",ne="TDEC",Rt="READ",Ct="SET",oe="B2DX",se="B2DY",ie="B2D",Qr="DEC",Fe="SQX",We="SQY",He="SQ",Ve=t=>{switch(t){case Ot:return 0;case ne:return 1;case Rt:return 2;case Ct:return 3}},tn=t=>{switch(t){case 0:return Ot;case 1:return ne;case 2:return Rt;case 3:return Ct}},je=t=>{switch(t){case oe:return 4;case se:return 5;case ie:return 6}},en=t=>{switch(t){case 4:return oe;case 5:return se;case 6:return ie}},nt=class t extends h{constructor(e,r){super(),this.op=e,this.axis=r}pretty(){return`${tn(this.op)} ${en(this.axis)}`}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==2)return;let[n,o]=r;if(!(n===void 0||o===void 0)){if(n===Ot||n===ne){if(o===oe||o===se)return new t(Ve(n),je(o))}else if((n===Rt||n===Ct)&&o===ie)return new t(Ve(n),je(o));switch(n){case Ot:switch(o){case Fe:return new t(0,4);case We:return new t(0,5);default:return}case Qr:switch(o){case Fe:return new t(1,4);case We:return new t(1,5);default:return}case Rt:switch(o){case He:return new t(2,6);default:return}case Ct:switch(o){case He:return new t(3,6);default:return}}}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0;case 3:return!1}}isSameComponent(e){if(e instanceof t){let r=this.axis,n=e.axis;return r===4&&n===5?!1:!(r===5&&n===4)}return!1}};var ae="INC",ce="TDEC",pe="READ",ue="SET",Ye="B",rn=t=>{switch(t){case 0:return ae;case 1:return ce;case 2:return pe;case 3:return ue}},nn=t=>{switch(t){case ae:return 0;case ce:return 1;case pe:return 2;case ue:return 3}},v=class t extends h{constructor(e,r){super(),this.op=e,this.regNumber=r,this.registerCache=void 0}pretty(){return`${rn(this.op)} ${Ye}${this.regNumber}`}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==2)return;let[n,o]=r;if(!(n===void 0||o===void 0)&&(n===ae||n===ce||n===pe||n===ue)&&o.startsWith(Ye)){let s=o.slice(1);if(/^[0-9]+$/u.test(s))return new t(nn(n),parseInt(s,10))}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0;case 3:return!1}}isSameComponent(e){return e instanceof t?this.regNumber===e.regNumber:!1}};var Xe="HALT_OUT",qe="HALT",P=class t extends h{constructor(e=!0){super(),this.output=e}pretty(){return this.output?Xe:qe}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==1)return;let[n]=r;if(n===Xe)return new t(!0);if(n===qe)return new t(!1)}doesReturnValue(){return!1}isSameComponent(e){return e instanceof t}};var le="0",de="1",Ke="MUL",on=t=>{switch(t){case le:return 0;case de:return 1}},sn=t=>{switch(t){case 0:return le;case 1:return de}},ot=class t extends h{constructor(e){super(),this.op=e}pretty(){return`${Ke} ${sn(this.op)}`}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==2)return;let[n,o]=r;if(n===Ke&&(o===le||o===de))return new t(on(o))}doesReturnValue(){return!0}isSameComponent(e){return e instanceof t}};var Je="NOP",T=class t extends h{constructor(){super()}pretty(){return Je}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==1)return;let[n]=r;if(n===Je)return new t}doesReturnValue(){return!0}isSameComponent(e){return e instanceof t}};var Qe="OUTPUT",st=class t extends h{constructor(e){super(),this.digit=e}pretty(){return`${Qe} ${this.digit}`}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==2)return;let[n,o]=r;if(n===Qe&&o!==void 0)return new t(o)}doesReturnValue(){return!1}isSameComponent(e){return e instanceof t}};var he="A1",xe="B0",ge="B1",tr="SUB",an=t=>{switch(t){case 0:return he;case 1:return xe;case 2:return ge}},cn=t=>{switch(t){case he:return 0;case xe:return 1;case ge:return 2}},it=class t extends h{constructor(e){super(),this.op=e}pretty(){return`${tr} ${an(this.op)}`}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==2)return;let[n,o]=r;if(n===tr&&(o===he||o===xe||o===ge))return new t(cn(o))}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0;case 2:return!0}}isSameComponent(e){return e instanceof t}};var Ae="INC",be="TDEC",er="U",pn="R",un=t=>{switch(t){case 0:return Ae;case 1:return be}},mn=t=>{switch(t){case Ae:return 0;case be:return 1}},O=class t extends h{constructor(e,r){super(),this.op=e,this.regNumber=r,this.registerCache=void 0}pretty(){return`${un(this.op)} ${er}${this.regNumber}`}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==2)return;let[n,o]=r;if(!(n===void 0||o===void 0)&&(n===Ae||n===be)&&(o.startsWith(er)||o.startsWith(pn))){let s=o.slice(1);if(/^[0-9]+$/u.test(s))return new t(mn(n),parseInt(s,10))}}doesReturnValue(){switch(this.op){case 0:return!1;case 1:return!0}}isSameComponent(e){return e instanceof t?this.regNumber===e.regNumber:!1}};var Se="INC",Ee="DEC",ye="READ",Pe="SET",we="RESET",fn=t=>{switch(t){case 0:return Se;case 1:return Ee;case 2:return ye;case 3:return Pe;case 4:return we}},ln=t=>{switch(t){case Se:return 0;case Ee:return 1;case ye:return 2;case Pe:return 3;case we:return 4}},at=class t extends h{constructor(e,r){super(),this.op=e,this.regNumber=r}pretty(){return`${fn(this.op)} T${this.regNumber}`}static parse(e){let r=e.trim().split(/\s+/u);if(r.length!==2)return;let[n,o]=r;if(!(n===void 0||o===void 0)&&(n===Se||n===Ee||n===ye||n===Pe||n===we)&&o.startsWith("T")){let s=o.slice(1);if(/^[0-9]+$/u.test(s))return new t(ln(n),parseInt(s,10))}}doesReturnValue(){switch(this.op){case 0:return!0;case 1:return!0;case 2:return!0;case 3:return!1;case 4:return!1}}isSameComponent(e){return e instanceof t?this.regNumber===e.regNumber:!1}};var ct=t=>{let e=[v.parse,O.parse,nt.parse,T.parse,W.parse,ot.parse,it.parse,st.parse,P.parse,at.parse];for(let r of e){let n=r(t);if(n!==void 0)return n}};var m=()=>{throw Error("internal error")};var G=t=>t!==void 0?` at line ${t}`:"";function Ge(t,e,r,n){let o=t.trim();if(!o.startsWith("{"))return`Invalid line "${r}"${G(e)}. ${n} replacements does not start with "{"`;if(!o.endsWith("}"))return`Invalid line "${r}"${G(e)}. ${n} replacements does not end with "}"`;try{return t.slice(1,-1).slice().split(";").map(s=>{let i=s.trim().split("=").map(a=>a.trim());if(i.length!=2)throw new Error(`Invalid line "${t}"${G(e)}. #DEFINE invalid replacements`);return{needle:i[0]??m(),replacement:i[1]??m()}})}catch(s){return s instanceof Error?s.message:m()}}var Be="INITIAL",B=class{pretty(){return""}},pt=class t extends B{constructor(e){super(),this.content=e}static get key(){return"#COMPONENTS"}pretty(){return t.key+" "+this.content}},ut=class t extends B{constructor(e){super(),this.content=e}static get key(){return"#REGISTERS"}pretty(){return t.key+" "+this.content}};function rr(t){return"{ "+t.map(e=>e.needle+" = "+e.replacement).join("; ")+" }"}var mt=class t extends B{constructor(e,r){super(),this.name=e,this.defaultReplacements=r}static get key(){return"#DEFINE"}pretty(){return t.key+" "+this.name+(this.defaultReplacements.length===0?"":" "+rr(this.defaultReplacements))}},V=class t extends B{constructor(){super()}static get key(){return"#ENDDEF"}pretty(){return t.key}},H=class t extends B{constructor(e,r){super(),this.templateName=e,this.replacements=r}static get key(){return"#INSERT"}pretty(){return t.key+" "+this.templateName+(this.replacements.length===0?"":" "+rr(this.replacements))}},ft=class extends B{constructor(e){super(),this.filename=e}static get key(){return"#INCLUDE"}pretty(){return H.key+" "+this.filename}},Ne=class extends B{constructor(e){super(),this.str=e}getString(){return this.str}pretty(){return this.getString()}},Me=class extends B{constructor(){super()}pretty(){return""}},hn=t=>{switch(t){case"Z":return t;case"NZ":return t;case"ZZ":return t;case"*":return t;default:return}},j=class extends B{constructor({state:e,input:r,nextState:n,actions:o,line:s}){super(),this.state=e,this.input=r,this.nextState=n,this.actions=o,this.line=s,this._string=`${this.state}; ${this.input};${" ".repeat(2-this.input.length)} ${this.nextState}; ${this.actions.map(i=>i.pretty()).join(", ")}`}pretty(){return this._string}},Le=(t,e)=>{let r=t.trim();if(r==="")return new Me;if(r.startsWith("#")){if(r.startsWith(pt.key))return new pt(r.slice(pt.key.length).trim());if(r.startsWith(ut.key))return new ut(r.slice(ut.key.length).trim());if(r.startsWith(mt.key)){let f=r.slice(mt.key.length).trim();if(f.length===0)return`Invalid line "${t}"${G(e)}. #DEFINE needs a name.`;let M,y=[];if(f.includes("{")){M=f.slice(0,f.indexOf("{")).trim();let tt=Ge(f.slice(f.indexOf("{")),e,t,"#DEFINE");if(typeof tt=="string")return tt;y=tt}else M=f;return new mt(M,y??[])}else{if(r.startsWith(V.key))return new V;if(r.startsWith(H.key)){let f=r.slice(H.key.length).trim();if(f.length===0)return`Invalid line "${t}"${G(e)}. #INSERT needs a name.`;let M,y=[];if(f.includes("{")){M=f.slice(0,f.indexOf("{")).trim();let tt=Ge(f.slice(f.indexOf("{")),e,t,"#INSERT");if(typeof tt=="string")return tt;y=tt}else M=f;return new H(M,y)}else if(r.startsWith(ft.key)){let f=r.slice(ft.key.length).trim();return f===""?`Invalid line "${t}"${G(e)}. #INCLUDE needs filename.`:new ft(f)}}return new Ne(t)}let o=(r.split("#")[0]??"").split(/\s*;\s*/u);if(o.length<4)return`Invalid line "${t}"${G(e)}`;if(o.length>4)return o[4]===""?`Extraneous semicolon "${t}"${G(e)}`:`Invalid line "${t}"${G(e)}`;let s=o[0]??m(),i=o[1]??m(),a=o[2]??m(),u=(o[3]??m()).trim().split(/\s*,\s*/u).filter(f=>f!==""),x=[];for(let f of u){let M=ct(f);if(M===void 0)return`Unknown action "${f}" in "${t}"${G(e)}`;x.push(M)}let E=hn(i);return E===void 0?`Unknown input "${i}" in "${t}"${G(e)}. Expect "Z", "NZ", "ZZ" or "*"`:new j({state:s,input:E,nextState:a,actions:x,line:e})},Xt=t=>G(t.line),R=t=>`"${t.pretty()}"${Xt(t)}`;var nr=t=>{let e=t.actions;if(e.some(n=>n instanceof P))return;let r=e.filter(n=>n.doesReturnValue());if(r.length!==1)return r.length===0?`Does not return a value in ${R(t)}`:`Does not contain exactly one action that returns a value in "${t.pretty()}": Actions that produce value are ${r.map(n=>`"${n.pretty()}"`).join(", ")}${Xt(t)}`};var or=t=>{if(t.nextState===Be)return`Return to initial state in ${R(t)}`};var sr=t=>{let e=t.actions;if(e.length<=1)return;let r=e.map(o=>o.pretty());r.sort();let n=r.length-1;for(let o=0;o<n;o++){let s=r[o],i=r[o+1];if(s===i)return`Duplicated actions "${s}" in ${R(t)}`}};var ir=t=>{let e=t.actions;if(e.find(n=>n instanceof P)!==void 0)return;let r=e.length;if(!(r<=1))for(let n=0;n<r;n++){let o=e[n]??m();for(let s=n+1;s<r;s++){let i=e[s]??m();if(o.isSameComponent(i))return`Actions "${o.pretty()}" and "${i.pretty()}" use same component in ${R(t)}`}}};var xn=(t,e)=>t.line!==void 0&&e?.line!==void 0?` at line ${t.line} and ${e.line}`:"",ar=t=>{if(t.length===0)return;let e=(o,s)=>`Need Z line followed by NZ line in "${o.pretty()}"${xn(o,s)}`,r=t.length-1;for(let o=0;o<r;o++){let s=t[o]??m(),i=t[o+1]??m(),a=s.input,c=i.input;if(a==="Z"&&c!=="NZ"||c==="NZ"&&a!=="Z"||a==="Z"&&c==="NZ"&&s.state!==i.state)return[e(s,i)]}let n=t[r];if(n?.input==="Z")return[e(n)]};var Yi=Number.parseInt,Xi=Number.isNaN;var $=class t{constructor(e,r=new Map){this.templates=r,this.array=e}getArray(){return this.array}getTemplates(){return this.templates}pretty(){return this.array.map(e=>e.pretty()).join(`
`)}static parse(e){let r=e.split(/\r\n|\n|\r/u),n=[],o=[],s=new Map,i=null;for(let[a,c]of r.entries()){if(i!=null){if(c.trimStart().startsWith(V.key)&&Le(c,a+1)instanceof V){i=null;continue}let x=s.get(i);x==null&&m(),x.lines.push(c);continue}let u=Le(c,a+1);if(u instanceof mt){if(i!=null)return`#DEFINE needs #ENDDEF ${u.pretty()}`;if(i=u.name,s.has(i))return`#DEFINE duplicate template name ${u.pretty()}`;s.set(i,{defaultReplacements:u.defaultReplacements,lines:[]})}else{if(u instanceof V)return`#ENDDEF needs #DEFINE ${u.pretty()}`;u instanceof B?o.push(u):typeof u=="string"?n.push(u):m()}}return i!=null&&n.push(`#DEFINE needs #ENDDEF. "${i}"`),n.length>0?n.join(`
`):new t(o,s)}};function Te(t){let e=t.getArray(),r=e.flatMap(s=>s instanceof j?[s]:[]),n=r.reduce((s,i)=>Math.max(s,i.state.length),0),o=r.reduce((s,i)=>Math.max(s,i.nextState.length),0);return e.map(s=>{if(s instanceof j){let i=n-s.state.length,a=2-s.input.length,c=o-s.nextState.length;return`${s.state}; ${" ".repeat(i)}${s.input}; ${" ".repeat(a)}${s.nextState}; ${" ".repeat(c)}${s.actions.map(u=>u.pretty()).join(", ")}`}else return s.pretty()}).join(`
`)}var cr=t=>{let e=[];{let r=[sr,nr,ir,or];for(let n of t)for(let o of r){let s=o(n);typeof s=="string"&&e.push(s)}}{let r=[ar];for(let n of r){let o=n(t);o!==void 0&&(e=e.concat(o))}}if(e.length>0)return e.join(`
`)};function gn(t,e,r){let n=t;for(let o of r)n=n.replaceAll(o.needle,o.replacement);for(let o of e.defaultReplacements)n=n.replaceAll(o.needle,o.replacement);return n}function pr(t,e){let r=[],n=new Map(t.getTemplates().entries()),o=t.getArray().slice().reverse();function s(i){let a=i.getArray();for(let c=a.length-1;c>=0;c--)o.push(a[c]??m());for(let[c,u]of i.getTemplates()){if(n.get(c)!=null)throw new Error(`#DEFINE duplicate template name "${c}"`);n.set(c,u)}}for(;o.length>=1;){let i=o.pop();if(i instanceof j)r.push(i);else if(i instanceof ft){let a=e.find(c=>c.name===i.filename);if(a==null)throw new Error(`#INCLUDE file not found: "${i.filename}". Add a library file.`);s(a.programLines)}else if(i instanceof H){let a=n.get(i.templateName);if(a==null)throw new Error(`Undefined template: "${i.templateName}" at line "${i.pretty()}"`);let c=a.lines.map(x=>gn(x,a,i.replacements)).join(`
`),u=$.parse(c);if(typeof u=="string")throw new Error(u);s(u)}}return r}var bt=class t{constructor(e,r,n){this.commands=e,this.componentsHeader=r,this.registersHeader=n}static parse(e,{noValidate:r,libraryFiles:n}={}){let o=$.parse(e);if(typeof o=="string")return o;let s=[];for(let a of n??[]){let c=$.parse(a.content);if(typeof c=="string")return c;s.push({name:a.name,programLines:c})}let i=pr(o,s);if(!r){if(i.length===0)return"Program is empty";let a=cr(i);if(typeof a=="string")return a}return new t(i,o.getArray().flatMap(a=>a instanceof pt?[a]:[]),o.getArray().flatMap(a=>a instanceof ut?[a]:[]))}},An=t=>[...new Set(t)].sort((e,r)=>e-r),qt=t=>{let e=t.commands.flatMap(c=>c.actions),r=c=>An(e.flatMap(u=>u instanceof c?[u.regNumber]:[])),n=!1,o=!1,s=!1,i=!1,a=!1;for(let c of e)c instanceof W?n=!0:c instanceof it?o=!0:c instanceof ot?s=!0:c instanceof nt?i=!0:c instanceof st&&(a=!0);return{unary:r(O),binary:r(v),legacyT:r(at),hasAdd:n,hasSub:o,hasMul:s,hasB2D:i,hasOutput:a}};function ur(t){if(t.length===0)return[];let e=[],r=t[0],n=t[0]??m(),o=t.length;for(let s=1;s<o;s++){let i=t[s]??m();i===n+1||(e.push(r===n?`${r}`:`${r}-${n}`),r=i),n=i}return e.push(r===n?`${r}`:`${r}-${n}`),e}var De=t=>{let e=[];t.hasB2D&&e.push("B2D");let r=t.binary.slice().sort((o,s)=>o-s);e=e.concat(ur(r).map(o=>"B"+o));let n=t.unary.slice().sort((o,s)=>o-s);return e=e.concat(ur(n).map(o=>"U"+o)),t.hasAdd&&e.push("ADD"),t.hasSub&&e.push("SUB"),t.hasMul&&e.push("MUL"),t.hasOutput&&e.push("OUTPUT"),e.join(", ")};function mr(t){let e=$.parse(t);if(typeof e=="string")throw new Error(e);return Te(e)}function $e(t){let e=bt.parse(t);if(typeof e=="string")throw new Error(e);return De(qt(e))}var Sn=p.match(/[0-9]+/).desc(["number"]).map(t=>({raw:t,value:parseInt(t,10)})),En=p.match(/0x[a-fA-F0-9]+/).desc(["hexadecimal number"]).map(t=>({raw:t,value:parseInt(t,16)})),fr=En.or(Sn).desc(["number"]);var A=class{constructor(){}},l=class extends Error{constructor(r,n,o){super(r,o);this.apgmSpan=n}};function lr(t){return`line ${t.line} column ${t.column}`}function S(t){return t!==void 0?` at ${lr(t)}`:""}var C=class t extends A{constructor(r,n,o){super();this.name=r;this.args=n;this.span=o}transform(r){return r(new t(this.name,this.args.map(n=>n.transform(r)),this.span))}pretty(){return`${this.name}(${this.args.map(r=>r.pretty()).join(", ")})`}getSpan(){return this.span}};var _=class t extends A{constructor(r,n,o,s,i){super();this.modifier=r;this.cond=n;this.thenBody=o;this.elseBody=s;this.span=i}transform(r){return r(new t(this.modifier,this.cond.transform(r),this.thenBody.transform(r),this.elseBody!==void 0?this.elseBody.transform(r):void 0,this.span))}pretty(){let r=`if_${this.modifier==="Z"?"z":"nz"}`,n=this.cond.pretty(),o=this.elseBody===void 0?"":` else ${this.elseBody.pretty()}`;return`${r} (${n}) ${this.thenBody.pretty()}`+o}getSpan(){return this.span}};var U=class t extends A{constructor(r){super();this.body=r}transform(r){return r(new t(this.body.transform(r)))}pretty(){return`loop ${this.body.pretty()}`}getSpan(){}};var Lt=class{constructor(e,r,n,o){this.name=e;this.args=r;this.body=n;this.span=o}pretty(){return`macro ${this.name}(${this.args.map(e=>e.pretty()).join(", ")}) ${this.body.pretty()}`}};var Tt=class{constructor(e,r,n){this.macros=e;this.headers=r;this.seqExpr=n}pretty(){return[this.macros.map(e=>e.pretty()).join(`
`),this.headers.map(e=>e.toString()).join(`
`),this.seqExpr.prettyInner()].join(`
`)}};var Dt=class{constructor(e,r){this.name=e;this.content=r}toString(){let e=this.content.startsWith(" ")?"":" ";return`#${this.name}${e}${this.content}`}};var Z=class extends A{constructor(r,n,o){super();this.value=r;this.span=n;this.raw=o}transform(r){return r(this)}pretty(){return this.value.toString()}getSpan(){return this.span}};var Y=class extends A{constructor(r,n){super();this.value=r;this.span=n}transform(r){return r(this)}pretty(){return'"'+this.value+'"'}getSpan(){return this.span}};var X=class t extends A{constructor(r){super();this.exprs=r}transform(r){return r(new t(this.exprs.map(n=>n.transform(r))))}pretty(){return`{${this.prettyInner()}}`}prettyInner(){return this.exprs.map(r=>r instanceof _||r instanceof U||r instanceof z?r.pretty():r.pretty()+";").join(`
`)}getSpan(){}};var k=class extends A{constructor(r,n){super();this.name=r;this.span=n}transform(r){return r(this)}pretty(){return this.name}getSpan(){return this.span}};var z=class t extends A{constructor(r,n,o){super();this.modifier=r;this.cond=n;this.body=o}transform(r){return r(new t(this.modifier,this.cond.transform(r),this.body.transform(r)))}pretty(){return`while_${this.modifier==="Z"?"z":"nz"}(${this.cond.pretty()}) ${this.body.pretty()}`}getSpan(){}};function Kt(t,e,r){let n=t.split(/\r?\n/),o=n[e.line-2],s=n[e.line-1],i=n[e.line],a=" ".repeat(Math.max(0,e.column-1))+"^".repeat(r===void 0?1:Math.max(1,r.column-e.column)),c=o===void 0?[]:[o],u=i===void 0?[]:[i],x=" | ",E=e.line.toString(),f=" ".repeat(E.length);return[...c.map(y=>f+x+y),E+x+s,f+x+a,...u.map(y=>f+x+y)]}function yn(t,e){let r=Kt(e,t.location);return[`Error: Parse error at line ${t.location.line} column ${t.location.column}:`,`  expected ${t.expected.join(", ")}`,"",...r].join(`
`)}function dr(t,e){let r=t.parse(e);if(r.type==="ParseOK")return r.value;throw new l(yn(r,e),{start:r.location,end:r.location})}function q(t,e){let r=e.length;return{start:t,end:{index:t.index+r-1,line:t.line,column:t.column+r}}}var hr=p.location.chain(t=>p.text('"').next(p.match(/[^"]*/)).skip(p.text('"')).desc(["string"]).map(e=>({value:e,span:q(t,`"${e}"`)})));var Pn=p.match(/\/\*(\*(?!\/)|[^*])*\*\//s).desc([]),g=p.match(/\s*/).desc(["space"]).sepBy(Pn).map(()=>{}),wn=p.match(/\s+/).desc(["space"]),Gn=/[a-zA-Z_][a-zA-Z_0-9]*/u,Ar=p.match(Gn).desc(["identifier"]),Nn=Ar.wrap(g,g),Mn=g.chain(()=>p.location.chain(t=>Ar.skip(g).map(e=>[e,q(t,e)]))),Bn=/[a-zA-Z_][a-zA-Z_0-9]*!/u,br=p.match(Bn).wrap(g,g).desc(["macro name"]);function I(t){return p.text(t).wrap(g,g)}function xr(t){return p.location.chain(r=>p.text(t).map(n=>[n,q(r,t)])).wrap(g,g)}var Ln=I(",").desc(["`,`"]),Sr=I("(").desc(["`(`"]),Er=I(")").desc(["`)`"]),Tn=I(";").desc(["`;`"]),Dn=I("{").desc(["`{`"]),$n=I("}").desc(["`}`"]),yr=Mn.map(([t,e])=>new k(t,e));function Pr(t){return p.lazy(()=>t()).sepBy(Ln).wrap(Sr,Er)}function In(){return g.next(p.location).chain(t=>p.choice(br,Nn).chain(e=>Pr(()=>K()).map(r=>new C(e,r,q(t,e)))))}var vn=p.location.chain(t=>fr.map(e=>new Z(e.value,q(t,e.raw),e.raw))).wrap(g,g),On=hr.wrap(g,g).map(t=>new Y(t.value,t.span)),wr=p.lazy(()=>Wn()).repeat(),Rn=wr.wrap(Dn,$n).map(t=>new X(t)),Cn=p.choice(I("while_z"),I("while_nz")).map(t=>t==="while_z"?"Z":"NZ"),Gr=p.lazy(()=>K()).wrap(Sr,Er),Nr=Cn.chain(t=>Gr.chain(e=>K().map(r=>new z(t,e,r)))),Mr=I("loop").next(p.lazy(()=>K())).map(t=>new U(t)),_n=p.choice(xr("if_z"),xr("if_nz")).map(t=>t[0]==="if_z"?["Z",t[1]]:["NZ",t[1]]),Br=_n.chain(([t,e])=>Gr.chain(r=>p.lazy(()=>K()).chain(n=>p.choice(I("else").next(p.lazy(()=>K())),p.ok(void 0)).map(o=>new _(t,r,n,o,e))))),gr="macro",Un=g.chain(t=>p.location.chain(e=>p.text(gr).next(wn).map(r=>q(e,gr))));function Ie(){return Un.and(br).chain(([t,e])=>Pr(()=>yr).map(r=>({span:t,name:e,args:r})))}function Zn(){return Ie().chain(({span:t,name:e,args:r})=>p.lazy(()=>K()).map(n=>new Lt(e,r,n,t)))}var zn=p.match(/.*/),kn=p.text("#").next(p.match(/REGISTERS|COMPONENTS/)).desc(["#REGISTERS","#COMPONENTS"]).chain(t=>zn.map(e=>new Dt(t,e))),Fn=kn.wrap(g,g).repeat();function K(){return p.choice(Mr,Nr,Br,p.lazy(()=>In()),Rn,yr,vn,On)}function Wn(){return p.choice(Mr,Nr,Br,K().skip(Tn))}function Hn(){return Zn().repeat().chain(t=>Fn.chain(e=>wr.wrap(g,g).map(r=>new Tt(t,e,new X(r)))))}function Lr(t){return dr(Hn(),t)}var w=class{constructor(){}};var N=class extends w{constructor(r){super();this.actions=r}transform(r){return r(this)}};var b=class t extends w{constructor(r){super();this.exprs=r}transform(r){return r(new t(this.exprs.map(n=>n.transform(r))))}};function lt(t){return t instanceof b&&t.exprs.every(e=>lt(e))}function St(t){if(t instanceof N)return t;if(t instanceof b&&t.exprs.length===1){let e=t.exprs[0];return St(e)}}var J=class t extends w{constructor(r,n,o){super();this.cond=r;this.thenBody=n;this.elseBody=o}transform(r){return r(new t(this.cond.transform(r),this.thenBody.transform(r),this.elseBody.transform(r)))}};var dt=class t extends w{constructor(r){super();this.body=r}kind="loop";transform(r){return r(new t(this.body.transform(r)))}};var ht=class t extends w{constructor(r,n,o){super();this.modifier=r;this.cond=n;this.body=o}transform(r){return r(new t(this.modifier,this.cond.transform(r),this.body.transform(r)))}};var Q=class extends w{constructor(r,n){super();this.level=r;this.span=n}kind="break";transform(r){return r(this)}};var d=class t{static incU(e){return t.nonReturn(`INC U${e}`)}static incUMulti(...e){return new N([...e.map(r=>`INC U${r}`),"NOP"])}static tdecU(e){return t.single(`TDEC U${e}`)}static addA1(){return t.nonReturn("ADD A1")}static addB0(){return t.single("ADD B0")}static addB1(){return t.single("ADD B1")}static incB2DX(){return t.nonReturn("INC B2DX")}static tdecB2DX(){return t.single("TDEC B2DX")}static incB2DY(){return t.nonReturn("INC B2DY")}static tdecB2DY(){return t.single("TDEC B2DY")}static readB2D(){return t.single("READ B2D")}static setB2D(){return t.nonReturn("SET B2D")}static incB(e){return t.nonReturn(`INC B${e}`)}static tdecB(e){return t.single(`TDEC B${e}`)}static readB(e){return t.single(`READ B${e}`)}static setB(e){return t.nonReturn(`SET B${e}`)}static haltOUT(){return t.single("HALT_OUT")}static mul0(){return t.single("MUL 0")}static mul1(){return t.single("MUL 1")}static nop(){return t.single("NOP")}static output(e){return t.nonReturn(`OUTPUT ${e}`)}static subA1(){return t.nonReturn("SUB A1")}static subB0(){return t.single("SUB B0")}static subB1(){return t.single("SUB B1")}static nonReturn(e){return new N([e,"NOP"])}static single(e){return new N([e])}};function Vn(t,e){if(t.args.length!==0)throw new l(`"${t.name}" expects empty arguments${S(t.span?.start)}`,t.span);return e}function Tr(t,e){if(t.args.length!==1)throw new l(`number of arguments is not 1:"${t.name}"${S(t.span?.start)}`,t.span);let r=t.args[0];if(!(r instanceof Z))throw new l(`argument is not a number: "${t.name}"${S(t.span?.start)}`,r.getSpan()??t.span);return e(r.value)}function jn(t,e){if(t.args.length!==1)throw new l(`number of arguments is not 1: "${t.name}"${S(t.span?.start)}`,t.span);let r=t.args[0];if(!(r instanceof Y))throw new l(`argument is not a string: "${t.name}"${S(t.span?.start)}`,r.getSpan()??t.span);return e(r.value)}var Dr=new Map([["nop",d.nop()],["inc_b2dx",d.incB2DX()],["inc_b2dy",d.incB2DY()],["tdec_b2dx",d.tdecB2DX()],["tdec_b2dy",d.tdecB2DY()],["read_b2d",d.readB2D()],["set_b2d",d.setB2D()],["add_a1",d.addA1()],["add_b0",d.addB0()],["add_b1",d.addB1()],["sub_a1",d.subA1()],["sub_b0",d.subB0()],["sub_b1",d.subB1()],["mul_0",d.mul0()],["mul_1",d.mul1()],["halt_out",d.haltOUT()]]),$r=new Map([["inc_u",d.incU],["tdec_u",d.tdecU],["inc_b",d.incB],["tdec_b",d.tdecB],["read_b",d.readB],["set_b",d.setB]]),Ir=new Map([["output",d.output]]);function Yn(t){let e=Dr.get(t.name);if(e!==void 0)return Vn(t,e);let r=$r.get(t.name);if(r!==void 0)return Tr(t,r);let n=Ir.get(t.name);if(n!==void 0)return jn(t,n);switch(t.name){case"break":return t.args.length===0?new Q(void 0,t.span):Tr(t,o=>new Q(o,t.span));case"repeat":{if(t.args.length!==2)throw new l(`"repeat" takes two arguments${S(t.span?.start)}`,t.span);let o=t.args[0];if(!(o instanceof Z))throw new l(`first argument of "repeat" must be a number${S(t.span?.start)}`,o.getSpan()??t.span);let s=t.args[1];if(s===void 0)throw new Error("internal error");let i=Jt(s);return new b(Array(o.value).fill(0).map(()=>i))}}throw new l(`Unknown ${t.name.endsWith("!")?"macro":"function"}: "${t.name}"${S(t.span?.start)}`,t.span)}function Jt(t){let e=Jt;if(t instanceof C)return Yn(t);if(t instanceof _)return t.modifier==="Z"?new J(e(t.cond),e(t.thenBody),t.elseBody===void 0?new b([]):e(t.elseBody)):new J(e(t.cond),t.elseBody===void 0?new b([]):e(t.elseBody),e(t.thenBody));if(t instanceof U)return new dt(e(t.body));if(t instanceof Z)throw new l(`number is not allowed: ${t.raw??t.value}${S(t.span?.start)}`,t.span);if(t instanceof X)return new b(t.exprs.map(r=>e(r)));if(t instanceof Y)throw new l(`string is not allowed: ${t.pretty()}${S(t.span?.start)}`,t.span);if(t instanceof z)return new ht(t.modifier,e(t.cond),e(t.body));throw t instanceof k?new l(`macro variable is not allowed: variable "${t.name}"${S(t.span?.start)}`,t.span):Error("internal error")}function Xn(t){let e="",r=!1,n=0;for(;n<t.length;){let o=t[n],s=t[n+1];o==="/"&&s==="*"?(n+=2,r=!0):o==="*"&&s==="/"?(r=!1,n+=2):(r||(e+=o),n++)}return e}function qn(t){let e=[],r=/(macro\s+([a-zA-Z_][a-zA-Z_0-9]*?!)\s*\(.*?\))/gs,n=Xn(t).matchAll(r);for(let o of n){let s=Ie().parse(o[0]);s.type==="ParseOK"&&e.push({name:s.value.name,args:s.value.args.map(i=>i.name)})}return e}function vr(t){return t.transform(Kn)}function Kn(t){return t instanceof b?Qn(t):t}function Or(t,e){let r=Rr(ve(t),ve(e));return r===void 0?void 0:Cr(r)}var Jn=new T;function Rr(t,e){if(t.length===0)return e.slice();if(e.length===0)return t.slice();if(t.some(c=>c instanceof P)||e.some(c=>c instanceof P))return;let r=t.filter(c=>!(c instanceof T)),n=e.filter(c=>!(c instanceof T)),o=r.every(c=>!c.doesReturnValue()),s=n.every(c=>!c.doesReturnValue());if(!o&&!s||!r.every(c=>n.every(u=>!c.isSameComponent(u))))return;let a=r.concat(n);return o&&s&&a.push(Jn),a}function ve(t){return t.actions.flatMap(e=>{let r=ct(e);return r!==void 0?[r]:[]})}function Cr(t){return new N(t.map(e=>e.pretty()))}function Qn(t){let e=[],r=[],n=()=>{r.length!==0&&(e.push(Cr(r)),r=[])};for(let o of t.exprs)if(o instanceof N){let s=ve(o),i=Rr(r,s);i===void 0?(n(),r=s):r=i}else n(),e.push(o);return n(),new b(e)}var L=class{constructor(e,r,n){this.input=e;this.output=r;this.inputZNZ=n}};function to(t){let e=t.prevOutput,r=e;return(e==="*"||e==="Z")&&(r=" "+e),`${t.currentState}; ${r}; ${t.nextState}; ${t.actions.join(", ")}`}var D=class{constructor(e){this.inner=e;if(this.inner.actions.length===0)throw Error("actions must be nonempty")}},Oe=class{#i=0;#r=[];#n;#o;constructor(e={}){this.#n=e.prefix??"STATE_",this.#o=!(e.noOptimize??!1)}#e(){return this.#i++,`${this.#n}${this.#i}`}#s(e,r,n="*"){return new D({currentState:e,prevOutput:n,nextState:r,actions:["NOP"]})}transpile(e){let r="INITIAL",n=this.#e(),o=this.#s(r,n,"ZZ"),s=this.#n+"END",i=this.#t(new L(n,s,"*"),e),a=new D({currentState:s,prevOutput:"*",nextState:s,actions:["HALT_OUT"]});return[o,...i,a].map(c=>to(c.inner))}#t(e,r){if(r instanceof N)return[this.#c(e,r)];if(r instanceof b)return this.#u(e,r);if(r instanceof J)return this.#m(e,r);if(r instanceof dt)return this.#f(e,r);if(r instanceof ht)return this.#d(e,r);if(r instanceof Q)return this.#h(e,r);throw Error("unknown expr")}#c(e,r){return new D({currentState:e.input,prevOutput:e.inputZNZ,nextState:e.output,actions:r.actions})}#u(e,r){if(lt(r))return[this.#s(e.input,e.output,e.inputZNZ)];if(r.exprs.length===1){let i=r.exprs[0];if(i===void 0)throw new Error("internal error");return this.#t(e,i)}let n=[],o=e.input,s=r.exprs.length-1;for(let[i,a]of r.exprs.entries())if(i!==s){let c=this.#e();n=n.concat(this.#t(new L(o,c,i===0?e.inputZNZ:"*"),a)),o=c}else n=n.concat(this.#t(new L(o,e.output,"*"),a));return n}#m(e,r){if(this.#o&&lt(r.thenBody)&&lt(r.elseBody))return this.#t(e,r.cond);let n=this.#e(),o=this.#t(new L(e.input,n,e.inputZNZ),r.cond),[s,...i]=this.#t(new L(n,e.output,"Z"),r.thenBody),[a,...c]=this.#t(new L(n,e.output,"NZ"),r.elseBody);return[...o,s,a,...i,...c]}#f(e,r){let{startState:n,fromZOrNZ:o}=this.#a(e);this.#r.push(e.output);let s=this.#t(new L(n,n,"*"),r.body);return this.#r.pop(),[...o,...s]}#p(e,r,n,o){let{startState:s,fromZOrNZ:i}=this.#a(e),a=this.#e(),c=this.#c(new L(s,a,"*"),r),u=new D({currentState:a,prevOutput:"Z",nextState:o==="Z"?a:e.output,actions:o==="Z"?n.actions:["NOP"]}),x=new D({currentState:a,prevOutput:"NZ",nextState:o==="Z"?e.output:a,actions:o==="Z"?["NOP"]:n.actions});return[...i,c,u,x]}#l(e,r,n){let{startState:o,fromZOrNZ:s}=this.#a(e),i=this.#e(),a=this.#t(new L(o,i,"*"),r),c=new D({currentState:i,prevOutput:"Z",nextState:n==="Z"?o:e.output,actions:["NOP"]}),u=new D({currentState:i,prevOutput:"NZ",nextState:n==="Z"?e.output:o,actions:["NOP"]});return[...s,...a,c,u]}#d(e,r){let n=this.#o;if(n&&lt(r.body)){let y=St(r.cond);return y!==void 0?this.#p(e,y,y,r.modifier):this.#l(e,r.cond,r.modifier)}let o=St(r.body),s=St(r.cond);if(n&&s!==void 0&&o!==void 0){let y=Or(o,s);if(y!==void 0)return this.#p(e,s,y,r.modifier)}let{startState:i,fromZOrNZ:a}=this.#a(e),c=this.#e(),u=this.#t(new L(i,c,"*"),r.cond),x=this.#e()+"_WHILE_BODY",E=new D({currentState:c,prevOutput:"Z",nextState:r.modifier==="Z"?x:e.output,actions:["NOP"]}),f=new D({currentState:c,prevOutput:"NZ",nextState:r.modifier==="Z"?e.output:x,actions:["NOP"]});this.#r.push(e.output);let M=this.#t(new L(x,i,"*"),r.body);return this.#r.pop(),[...a,...u,E,f,...M]}#a(e){let r=e.inputZNZ==="*"?e.input:this.#e(),n=e.inputZNZ==="*"?[]:[this.#s(e.input,r,e.inputZNZ)];return{startState:r,fromZOrNZ:n}}#h(e,r){let n=r.level??1;if(n<1)throw new l("break level is less than 1",r.span);let o=this.#r[this.#r.length-n];if(o===void 0)throw n===1?new l("break outside while or loop",r.span):new l("break level is greater than number of nests of while or loop",r.span);return[this.#s(e.input,o,e.inputZNZ)]}};function Re(t,e={}){return new Oe(e).transpile(t)}function _r(t){let e=new Set,r=[];for(let n of t)e.has(n)?r.push(n):e.add(n);return r}function Ur(t){return`${t} argument${t===1?"":"s"}`}function eo(){throw new Error("internal error")}function ro(t,e){let r=e.args;if(r.length!==t.args.length)throw new l(`Error at "${t.name}": this macro takes ${Ur(t.args.length)} but ${Ur(r.length)} was supplied${S(e.span?.start)}`,e.span);let n=new Map(t.args.map((o,s)=>[o.name,r[s]??eo()]));return t.body.transform(o=>{if(o instanceof k){let s=n.get(o.name);if(s===void 0)throw new l(`Error: Unknown variable "${o.name}"${S(o.span?.start)}`,o.span);return s}else return o})}var no=1e5,Ce=class t{#i;#r=0;#n;constructor(e,r){this.#n=e,this.#i=r}static make(e){let r=new Map(e.macros.map(n=>[n.name,n]));if(r.size<e.macros.length){let o=_r(e.macros.map(a=>a.name))[0],s=e.macros.slice().reverse().find(a=>a.name===o)?.span,i=s?.start;throw new l(`There is a macro with the same name: "${o}"`+S(i),s)}return new t(e,r)}expand(){return this.#o(this.#n.seqExpr)}#o(e){if(no<this.#r)throw Error("too many macro expansion");return this.#r++,e.transform(r=>this.#e(r))}#e(e){return e instanceof C?this.#s(e):e}#s(e){let r=this.#i.get(e.name);if(r!==void 0){let n=ro(r,e);return this.#o(n)}else return e}};function Zr(t){return Ce.make(t).expand()}function zr(t){return t.transform(oo)}function oo(t){return t instanceof b?so(t):t}function so(t){let e=[];for(let r of t.exprs)r instanceof b?e=e.concat(r.exprs):e.push(r);return new b(e)}function Et(t=void 0,e,...r){t&&console.log(t+" Start",performance.now());let n=e(...r);return t&&console.log(t+" End",performance.now()),n}function io(t,{log:e,noOptimize:r}){if(r===!0)return t;let n=Et(e?"optimize apgl seq":void 0,zr,t);return Et(e?"optimize apgl action":void 0,vr,n)}function Mm(t,e={}){let r=e.log??!1,n=Et(r?"apgm parse":void 0,Lr,t);try{let o=Et(r?"apgm macro expand":void 0,Zr,n),s=Et(r?"apgm to apgl":void 0,Jt,o),i=io(s,{log:r,noOptimize:e.noOptimize}),a=Et(r?"apgl to apgsembly":void 0,Re,i,e),c=["# State    Input    Next state    Actions","# ---------------------------------------"],x=n.headers.map(E=>E.toString()).concat(c,a);if(n.headers.every(E=>E.name!=="COMPONENTS"))try{let E=$e(a.join(`
`));x.unshift("#COMPONENTS "+E)}catch(E){console.error(E)}return x}catch(o){throw o instanceof l&&o.apgmSpan?new l([o.message,...Kt(t,o.apgmSpan.start,o.apgmSpan.end)].join(`
`),o.apgmSpan,{cause:o.cause}):o}}export{qn as completionParser,Dr as emptyArgFuncs,mr as formatAPGsembly,Mm as integration,$r as numArgFuncs,Ir as strArgFuncs};
